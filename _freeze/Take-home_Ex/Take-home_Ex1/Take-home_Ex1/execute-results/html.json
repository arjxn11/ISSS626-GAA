{
  "hash": "1b0ea2305dee20a2af075c3b688735be",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 1: Geospatial Analytics for Social Good\"\nauthor: \"Arjun Singh\"\ndate: 2024-09-02\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  message: false\n  freeze: true\n  warning: false\nformat:\n  html:\n    css: styles.css  \n---\n\n\n\n# 1 Introduction\n\nAccording to the World Health Organisation (WHO), road traffic accidents cause approximately 1.19 million deaths annually and result in between 20 and 50 million people with being down with non-fatal injuries. Over half of all road traffic deaths occur among vulnerable road users, such as pedestrians, cyclists and motorcyclists.\n\nRoad traffic injuries are the leading cause of death for children and young adults aged 5–29 while two-thirds of road traffic fatalities occur among people of working age (18–59 years). 9 in 10 fatalities on the roads occur in low and middle-income countries, even though these countries have only around 60% of the world’s vehicles.\n\nIn addition to the human suffering caused by road traffic injuries, they also inflict a heavy economic burden on victims and their families, both through treatment costs for the injured and through loss of productivity of those killed or disabled. More broadly, road traffic injuries have a serious impact on national economies, costing countries 3% of their annual GDP.\n\nThailand’s roads are the deadliest in Southeast Asia and among the worst in the world, according to the World Health Organisation. About 20,000 people die in road accidents each year, or about 56 deaths a day (WHO).\n\nBetween 2014 and 2021, Thailand experienced a notable increase in accidents. Specifically, 19% of all accidents in Thailand occurred on the national highways, which constituted the primary public thoroughfares connecting various regions, provinces, districts, and significant locations within a comprehensive network.\n\nWithin the broader context of accidents across the country, there existed a considerable 66% likelihood of encountering accident-prone zones, often termed ‘**black spots**,’ distributed as follows: 66% on straight road segments, 13% at curves, 6% at median points of cross-shaped intersections, 5% at T-shaped intersections and Y-shaped intersections, 3% at cross-shaped intersections, 2% on bridges, and 2% on steep slopes, respectively.\n\n# 1.1 Objectives\n\nFor the most part, road accidents can be attributed to two key factors- behavioral factors. such as driving skill, and environmental factors, such as heavy rain.\n\nFor this exercise, we will implement Spatial and Spatio-Temporal Point Pattern Analysis methods to discover the underlying factors behind the accidents in the Bangkok Metropolitan Region.\n\n# 1.2 Data and Packages\n\nFor the purpose of this study, we will use the following three data-frames.\n\n-   [Thailand Road Accidents \\[2019-2022\\]](https://www.kaggle.com/datasets/thaweewatboy/thailand-road-accident-2019-2022), sourced from Kaggle.\n\n-   [Thailand Roads Open Street Map Export](https://data.humdata.org/dataset/hotosm_tha_roads), sourced from Humanitarian Data Exchange.\n\n-   [Thailand Subnational Administrative Boundaries](https://data.humdata.org/dataset/cod-ab-tha?) sourced from Humanitarian Data Exchange.\n\nYou can click the link embedded on each of these data-frames to learn more.\n\nWe will use the following R packages for our analysis:\n\n-   `sf`, a relatively new R package specially designed to import, manage and process vector-based geospatial data in R.\n\n-   `spatstat`, which has a wide range of useful functions for point pattern analysis. In this hands-on exercise, it will be used to perform 1st- and 2nd-order spatial point patterns analysis and derive kernel density estimation (KDE) layer.\n\n-   `raster`, which reads, writes, manipulates, analyses and model of gridded spatial data (i.e. raster). In this hands-on exercise, it will be used to convert image output generate by spatstat into raster format.\n\n-   `tidyverse` simplifies spatial analysis by offering a consistent and efficient framework that facilitates working with spatial data.\n\n-   `tmap` which provides functions for plotting cartographic quality static point patterns maps or interactive maps by using leaflet API.\n\n-   `spNetwork` which provides functions to perform Spatial Point Patterns Analysis such as kernel density estimation (KDE) and K-function on network. It also can be used to build spatial matrices (‘listw’ objects like in ‘spdep’ package) to conduct any kind of traditional spatial analysis with spatial weights based on reticular distances.\n\nWe import them into our environment using the code chunk below.\n\n<details>\n\n<summary>Click to show/hide code chunk</summary>\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, spatstat, raster, tidyverse, tmap, spNetwork)\n```\n:::\n\n\n\n</details>\n\n# 1.3 Importing the data\n\n## 1.3.1 Aspatial Data\n\nWe will first import the road accident data into our environment and prepare it to suit our analysis.\n\n::: panel-tabset\n## Importing the aspatial data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrdacc_sf=read_csv(\"data/thai_road_accident_2019_2022.csv\")%>%\n  filter(!is.na(longitude) & longitude != \"\",\n         !is.na(latitude) & latitude !=\"\")%>%\n  st_as_sf(coords=c(\n    \"longitude\", \"latitude\"), \n    crs=4326)%>%\n  st_transform(crs=32647)\n```\n:::\n\n\n\n## Features of the dataset\n\nWe now use the glimpse() function to have an overview of the features of the dataset.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(rdacc_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 81,376\nColumns: 17\n$ acc_code                    <dbl> 571905, 3790870, 599075, 571924, 599523, 5…\n$ incident_datetime           <dttm> 2019-01-01 00:00:00, 2019-01-01 00:03:00,…\n$ report_datetime             <dttm> 2019-01-02 06:11:00, 2020-02-20 13:48:00,…\n$ province_th                 <chr> \"ลพบุรี\", \"อุบลราชธานี\", \"ประจวบคีรีขันธ์\", \"เชียงใ…\n$ province_en                 <chr> \"Loburi\", \"Ubon Ratchathani\", \"Prachuap Kh…\n$ agency                      <chr> \"department of rural roads\", \"department o…\n$ route                       <chr> \"แยกทางหลวงหมายเลข 21 (กม.ที่ 31+000) - บ้านวั…\n$ vehicle_type                <chr> \"motorcycle\", \"private/passenger car\", \"mo…\n$ presumed_cause              <chr> \"driving under the influence of alcohol\", …\n$ accident_type               <chr> \"other\", \"rollover/fallen on straight road…\n$ number_of_vehicles_involved <dbl> 1, 1, 2, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 1, …\n$ number_of_fatalities        <dbl> 0, 0, 1, 0, 0, 0, 0, 1, 3, 0, 0, 1, 0, 0, …\n$ number_of_injuries          <dbl> 2, 2, 0, 1, 0, 2, 2, 0, 0, 1, 1, 0, 1, 1, …\n$ weather_condition           <chr> \"clear\", \"clear\", \"clear\", \"clear\", \"clear…\n$ road_description            <chr> \"straight road\", \"straight road\", \"wide cu…\n$ slope_description           <chr> \"no slope\", \"no slope\", \"slope area\", \"no …\n$ geometry                    <POINT [m]> POINT (701480.8 1654653), POINT (113…\n```\n\n\n:::\n:::\n\n\n\n## Checking for duplicates\n\nWe now check for duplicates using the group_by_all() function.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicate <- rdacc_sf %>% \n  group_by_all() %>% \n  filter(n()>1) %>% \n  ungroup()\n  \nduplicate\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 0 features and 16 fields\nBounding box:  xmin: NA ymin: NA xmax: NA ymax: NA\nProjected CRS: WGS 84 / UTM zone 47N\n# A tibble: 0 × 17\n# ℹ 17 variables: acc_code <dbl>, incident_datetime <dttm>,\n#   report_datetime <dttm>, province_th <chr>, province_en <chr>, agency <chr>,\n#   route <chr>, vehicle_type <chr>, presumed_cause <chr>, accident_type <chr>,\n#   number_of_vehicles_involved <dbl>, number_of_fatalities <dbl>,\n#   number_of_injuries <dbl>, weather_condition <chr>, road_description <chr>,\n#   slope_description <chr>, geometry <GEOMETRY [m]>\n```\n\n\n:::\n:::\n\n\n\nWe can confirm that there are zero duplicate rows across the data-frame.\n:::\n\n## 1.3.2 Geospatial Data\n\nWe will now import the Geospatial shapefiles into our environment using the **st_read()** function of the **sf** package.\n\n::: panel-tabset\n## Thailand Roads (Open Street Map Export)\n\nWe first import the Open Street Map export of the roads.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_sf <- st_read(dsn = \"data\", layer=\"hotosm_tha_roads_lines_shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `hotosm_tha_roads_lines_shp' from data source \n  `C:\\arjxn11\\ISSS626-GAA\\Take-home_Ex\\Take-home_Ex1\\data' using driver `ESRI Shapefile'\nSimple feature collection with 2792590 features and 14 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 97.34457 ymin: 5.643645 xmax: 105.6528 ymax: 20.47168\nCRS:           NA\n```\n\n\n:::\n:::\n\n\n\nWe notice that the CRS information is unavailable so we proceed to set the CRS using the **st_set_crs()** function of the **sf** package.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nroad_sf=st_set_crs(road_sf,32647)\n```\n:::\n\n\n\nGiven our area of focus is the Bangkok metropolitan we must narrow the data down to it.\n\n## Thailand Subnational Administrative Boundaries\n\nWe implement the st_read() function of the sf package to import the Administrative Boundaries into our environment.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_sf <- st_read(dsn = \"data\", layer=\"tha_admbnda_adm1_rtsd_20220121\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm1_rtsd_20220121' from data source \n  `C:\\arjxn11\\ISSS626-GAA\\Take-home_Ex\\Take-home_Ex1\\data' using driver `ESRI Shapefile'\nSimple feature collection with 77 features and 16 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n:::\n\nGiven our area of interest is the Bangkok Metropolitan Region, we further narrow down our data-frame `road_sf` for our study.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}