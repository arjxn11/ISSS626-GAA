<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arjun Singh">
<meta name="dcterms.date" content="2024-10-28">

<title>Take Home Exercise 3 – ISSS626-GAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1- Geospatial Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01b.html">
 <span class="dropdown-text">Hands-on Exercise 1 - Part 2- Choropleth Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02a.html">
 <span class="dropdown-text">Hands-on Exercise 2 - Part 1- 1st Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02b.html">
 <span class="dropdown-text">Hands-on Exercise 2 - Part 2- 2nd Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands On Exercise 3- Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands On Exercise 4- Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05a.html">
 <span class="dropdown-text">Hands On Exercise 5- Global Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05b.html">
 <span class="dropdown-text">Hands On Exercise 5- Part 2- Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands On Exercise 6- Geographical Segmentation with Spatially Constrained Clustering Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">Hands On Exercise 7- Geographically Weighted Explanatory Variables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08.html">
 <span class="dropdown-text">Hands On Exercise 8- Geographically Weighted Predictive Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09.html">
 <span class="dropdown-text">Hands On Exercise 9- Modelling Geographical Accessibility</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10a.html">
 <span class="dropdown-text">Hands On Exercise 10- Part 1- Processing and Visualising Flow Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10b.html">
 <span class="dropdown-text">Hands On Exercise 10- Part 2- Calibrating Spatial Interaction Models</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex01.html">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex02.html">
 <span class="dropdown-text">Take Home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex3/Take-home_Ex03.html">
 <span class="dropdown-text">Take Home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In Class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex2/In-class_Ex2.html">
 <span class="dropdown-text">In Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex3/In-class_Ex3.html">
 <span class="dropdown-text">In Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex4/In-class_Ex4.html">
 <span class="dropdown-text">In Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex5/In-class_Ex5.html">
 <span class="dropdown-text">In Class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex6/In-class_Ex6.html">
 <span class="dropdown-text">In Class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex7/In-class_Ex7.html">
 <span class="dropdown-text">In Class Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex8/In-class_Ex8.html">
 <span class="dropdown-text">In Class Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex9/In-class_Ex9.html">
 <span class="dropdown-text">In Class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex6/In-class_Ex10.html">
 <span class="dropdown-text">In Class Exercise 10</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">3 Introduction</a></li>
  <li><a href="#data-and-packages" id="toc-data-and-packages" class="nav-link" data-scroll-target="#data-and-packages">3.1 Data and Packages</a>
  <ul class="collapse">
  <li><a href="#importing-the-data" id="toc-importing-the-data" class="nav-link" data-scroll-target="#importing-the-data">3.1.2 Importing the data</a>
  <ul class="collapse">
  <li><a href="#aspatial-data" id="toc-aspatial-data" class="nav-link" data-scroll-target="#aspatial-data">3.1.2.1 Aspatial Data</a></li>
  <li><a href="#geospatial-data" id="toc-geospatial-data" class="nav-link" data-scroll-target="#geospatial-data">3.1.2.2 Geospatial Data</a></li>
  <li><a href="#locational-factors-geospatial" id="toc-locational-factors-geospatial" class="nav-link" data-scroll-target="#locational-factors-geospatial">3.1.2.2 Locational Factors (Geospatial)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-wrangling-and-manipulation" id="toc-data-wrangling-and-manipulation" class="nav-link" data-scroll-target="#data-wrangling-and-manipulation">3.2 Data Wrangling and Manipulation</a>
  <ul class="collapse">
  <li><a href="#combining-data-frames" id="toc-combining-data-frames" class="nav-link" data-scroll-target="#combining-data-frames">3.2.1 Combining Data-frames</a></li>
  <li><a href="#distance-matrix" id="toc-distance-matrix" class="nav-link" data-scroll-target="#distance-matrix">3.2.2 Distance Matrix</a></li>
  </ul></li>
  <li><a href="#data-overview" id="toc-data-overview" class="nav-link" data-scroll-target="#data-overview">3.3 Data Overview</a>
  <ul class="collapse">
  <li><a href="#popular-towns" id="toc-popular-towns" class="nav-link" data-scroll-target="#popular-towns">3.3.1 Popular Towns</a></li>
  <li><a href="#price-trends" id="toc-price-trends" class="nav-link" data-scroll-target="#price-trends">3.3.2 Price Trends</a></li>
  <li><a href="#does-the-level-at-which-the-apartment-is-on-impact-its-price" id="toc-does-the-level-at-which-the-apartment-is-on-impact-its-price" class="nav-link" data-scroll-target="#does-the-level-at-which-the-apartment-is-on-impact-its-price">3.3.3 Does the level at which the apartment is on impact its price?</a></li>
  </ul></li>
  <li><a href="#predictive-models" id="toc-predictive-models" class="nav-link" data-scroll-target="#predictive-models">3.4 Predictive Models</a>
  <ul class="collapse">
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation">3.4.1 Correlation</a></li>
  <li><a href="#hedonic-pricing-model" id="toc-hedonic-pricing-model" class="nav-link" data-scroll-target="#hedonic-pricing-model">3.4.2 Hedonic Pricing Model</a>
  <ul class="collapse">
  <li><a href="#spatial-autocorrelation" id="toc-spatial-autocorrelation" class="nav-link" data-scroll-target="#spatial-autocorrelation">3.4.1.1 Spatial Autocorrelation</a></li>
  <li><a href="#hedonic-pricing-model-using-gwmodel-adaptive-bandwidth-method" id="toc-hedonic-pricing-model-using-gwmodel-adaptive-bandwidth-method" class="nav-link" data-scroll-target="#hedonic-pricing-model-using-gwmodel-adaptive-bandwidth-method">3.4.2.1 Hedonic Pricing Model using GWModel (Adaptive Bandwidth Method)</a></li>
  </ul></li>
  <li><a href="#predictive-model--hedonic" id="toc-predictive-model--hedonic" class="nav-link" data-scroll-target="#predictive-model--hedonic">3.4.3 Predictive Model- Hedonic</a>
  <ul class="collapse">
  <li><a href="#data-sampling" id="toc-data-sampling" class="nav-link" data-scroll-target="#data-sampling">3.4.3.1 Data Sampling</a></li>
  <li><a href="#model-calibration" id="toc-model-calibration" class="nav-link" data-scroll-target="#model-calibration">3.4.3.2 Model Calibration</a></li>
  <li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction">3.4.3.3 Prediction</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#calibrating-geographical-random-forest-models" id="toc-calibrating-geographical-random-forest-models" class="nav-link" data-scroll-target="#calibrating-geographical-random-forest-models">3.4.5 Calibrating Geographical Random Forest Models</a>
  <ul class="collapse">
  <li><a href="#calibrating-using-training-data" id="toc-calibrating-using-training-data" class="nav-link" data-scroll-target="#calibrating-using-training-data">3.4.5.1 Calibrating using training data</a></li>
  </ul></li>
  <li><a href="#prediction-1" id="toc-prediction-1" class="nav-link" data-scroll-target="#prediction-1">3.5 Prediction</a>
  <ul class="collapse">
  <li><a href="#predicting-using-test-data" id="toc-predicting-using-test-data" class="nav-link" data-scroll-target="#predicting-using-test-data">3.5.1 Predicting using test data</a>
  <ul class="collapse">
  <li><a href="#converting-the-output-into-a-data-frame" id="toc-converting-the-output-into-a-data-frame" class="nav-link" data-scroll-target="#converting-the-output-into-a-data-frame">3.5.1.2 Converting the output into a data-frame</a></li>
  <li><a href="#root-mean-square-error-rmse" id="toc-root-mean-square-error-rmse" class="nav-link" data-scroll-target="#root-mean-square-error-rmse">3.5.1.3 Root Mean Square Error (RMSE)</a></li>
  <li><a href="#visualizing-the-predicted-values" id="toc-visualizing-the-predicted-values" class="nav-link" data-scroll-target="#visualizing-the-predicted-values">3.5.1.4 Visualizing the predicted values</a></li>
  </ul></li>
  <li><a href="#july-to-september-2024-data" id="toc-july-to-september-2024-data" class="nav-link" data-scroll-target="#july-to-september-2024-data">3.5.2 July to September 2024 Data</a>
  <ul class="collapse">
  <li><a href="#converting-the-output-into-a-data-frame-1" id="toc-converting-the-output-into-a-data-frame-1" class="nav-link" data-scroll-target="#converting-the-output-into-a-data-frame-1">3.5.2.2 Converting the output into a data-frame</a></li>
  <li><a href="#root-mean-square-error-rmse-1" id="toc-root-mean-square-error-rmse-1" class="nav-link" data-scroll-target="#root-mean-square-error-rmse-1">3.5.2.3 Root Mean Square Error (RMSE)</a></li>
  <li><a href="#visualizing-the-predicted-values-1" id="toc-visualizing-the-predicted-values-1" class="nav-link" data-scroll-target="#visualizing-the-predicted-values-1">3.5.2.4 Visualizing the predicted values</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison">3.6 Model Comparison</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arjun Singh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 28, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 10, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>3 Introduction</h1>
<p>Housing is a critical component of household wealth across the globe, and purchasing a home represents one of the most significant investments for many individuals. Housing prices are influenced by various factors, some of which are global—such as a country’s economic conditions and inflation rates—while others are specific to the properties themselves. These factors can be broadly categorized into structural and locational aspects.</p>
<p>Structural factors are attributes directly related to the property, such as its size, features, and ownership tenure. In contrast, locational factors pertain to the surrounding neighborhood and accessibility, including proximity to childcare centers, public transportation, and shopping facilities.</p>
<p>Traditionally, predictive models for housing resale prices have relied on the Ordinary Least Squares (OLS) method. However, OLS does not account for spatial autocorrelation and spatial heterogeneity—two common characteristics in geographical data like housing transactions. Ignoring spatial autocorrelation can lead to biased, inconsistent, or inefficient results in predictive housing pricing models (Anselin, 1998). To address this limitation, Geographically Weighted Models (GWMs) have been introduced, offering a more accurate approach to calibrating predictive models for housing resale prices by accounting for spatial variability.</p>
</section>
<section id="data-and-packages" class="level1">
<h1>3.1 Data and Packages</h1>
<p>For this exercise, we use <strong>HDB Resale Flat Prices</strong> provided by <a href="https://data.gov.sg/"><strong>Data.gov.sg</strong></a> should be used as the core data set. The study should focus on either three-room, four-room or five-room flat.</p>
<p><img src="images/clipboard-1921776033.png" class="img-fluid"></p>
<p>The following data-sets are used to incorporate locational factors:</p>
<ul>
<li><p>CHAS Clinics</p></li>
<li><p>Eldercare</p></li>
<li><p>Supermarkets</p></li>
<li><p>Hawkers</p></li>
<li><p>Kindergartens</p></li>
<li><p>Parks</p></li>
<li><p>Childcare</p></li>
</ul>
<p>All of the above have been acquired from <a href="https://data.gov.sg/">data.gov.sg</a>. The below have been acquired from <a href="https://datamall.lta.gov.sg/content/datamall/en.html">LTADataMall</a>.</p>
<ul>
<li><p>MRTs</p></li>
<li><p>Bus Stops</p></li>
</ul>
<p><img src="images/clipboard-2079193661.png" class="img-fluid"></p>
<p><img src="images/clipboard-3240590388.png" class="img-fluid"></p>
<p>All the above datasets are downloaded from two main data sources- <a href="https://data.gov.sg/">data.gov.sg</a> and <a href="https://datamall.lta.gov.sg/content/datamall/en.html">LTADataMall</a>.</p>
<p>We will use the following packages for our analysis:</p>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/sf/sf.pdf"><strong>sf</strong></a>: R package for handling, analyzing, and visualizing spatial data using simple features.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/spdep/spdep.pdf"><strong>spdep</strong></a>: R package for spatial dependence modeling, including spatial autocorrelation and regression analysis.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/GWmodel/GWmodel.pdf"><strong>GWmodel</strong></a>: R package for geographically weighted regression (GWR) and other localized spatial models.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/SpatialML/SpatialML.pdf"><strong>SpatialML</strong></a>: R package for spatial machine learning, offering tools for spatially explicit predictive modeling.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/tmap/tmap.pdf"><strong>tmap</strong></a>: R package for creating thematic maps, offering a flexible and layered approach for spatial visualization.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/rsample/rsample.pdf"><strong>rsample</strong></a>: R package for resampling datasets, facilitating model training and evaluation with various sampling methods.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/Metrics/Metrics.pdf"><strong>Metrics</strong></a>: R package for calculating common metrics for regression and classification models, such as RMSE and accuracy.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/tidyverse/tidyverse.pdf"><strong>tidyverse</strong></a>: A collection of R packages designed for data manipulation, analysis, and visualization in a consistent and coherent syntax.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/spatstat/spatstat.pdf"><strong>spatstat</strong></a>: A package for spatial data analysis, particularly focused on point pattern analysis. It provides tools for modeling, simulation, and visualization of spatial point patterns on various geometries.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/httr/httr.pdf"><strong>httr</strong></a>: A package for working with HTTP requests in R, facilitating interactions with web APIs by simplifying the process of sending requests (GET, POST, etc.), handling responses, and managing authentication.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/jsonlite/jsonlite.pdf"><strong>jsonlite</strong></a>: A package for parsing and generating JSON data in R, known for its simple, reliable conversion between R objects and JSON, making it essential for data exchange with web services.</p></li>
<li><p><a href="https://cran.r-project.org/web/packages/rvest/rvest.pdf"><strong>rvest</strong></a>: A web scraping package that allows users to easily harvest data from HTML web pages. It simplifies navigating, parsing, and extracting structured data from websites.</p></li>
</ul>
<p>Please click the link and refer to the documentation for any packages that you are interested to know more about.</p>
<p>We use the p_load() function of the pacman package to load these packages into our environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, GWmodel, SpatialML, tmap, rsample, Metrics, tidyverse, spatstat, httr, jsonlite, rvest)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="importing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data">3.1.2 Importing the data</h2>
<section id="aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="aspatial-data">3.1.2.1 Aspatial Data</h3>
<p>The aspatial data for this exercise is the HDB Flat Resale data that we acquired from data.gov.sg.</p>
<p>We implement the read_csv() function to import this data-set into our environment.</p>
<p>We filter our data down to the time of interest- January 2023 till September 2024.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>resale <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/resale.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">&gt;=</span> <span class="st">"2023-01"</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="st">"2024-09"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additionally, we are going to focus on 3/4/5 room flats for this study.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>rooms<span class="ot">=</span><span class="fu">c</span>(<span class="st">'3 ROOM'</span>, <span class="st">'4 ROOM'</span>, <span class="st">'5 ROOM'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>resale<span class="ot">=</span>resale<span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(flat_type <span class="sc">%in%</span> rooms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have over 43000 flats in our study.</p>
<p>The below code chunk tidies the data by combining the <code>block</code> and <code>street_name</code> columns to form the entire address.</p>
<p>Doing this will allow us to obtain the geographical coordinates accurately to facilitate the creation of our predictive model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>resale_tidy <span class="ot">&lt;-</span> resale <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">address =</span> <span class="fu">paste</span>(block,street_name)) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">remaining_lease_yr =</span> <span class="fu">as.integer</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(remaining_lease, <span class="dv">0</span>, <span class="dv">2</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">remaining_lease_mth =</span> <span class="fu">as.integer</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_sub</span>(remaining_lease, <span class="dv">9</span>, <span class="dv">11</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below creates a list of <strong>unique</strong> addresses in order to avoid having the same street and area being geocoded multiple times. Geocoding is usually ‘first come, first serve’, so sorting actually makes the code chunk more efficient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>address_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(resale_tidy<span class="sc">$</span>address))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below is used in order to acquire the postal codes of the required addresses with the help of geocoding. The jsonlite and rvest packages are important for this.</p>
<div class="insights-box">
<p>Geocoding is the process of converting a physical address or place name into geographic coordinates (latitude and longitude). This allows location data in address format to be mapped, visualized, and analyzed in spatial systems.</p>
<p>For example, if you have an address like “1600 Amphitheatre Parkway, Mountain View, CA,” geocoding will convert it into coordinates, such as <code>37.4220° N, 122.0841° W</code>.</p>
<p>Geocoding is applied for a multitude of reasons, such as:</p>
<ul>
<li><strong>Mapping and navigation services</strong>: To display locations on maps or provide directions.</li>
<li><strong>Location-based services</strong>: For ride-sharing, food delivery, and on-demand services, geocoding enables finding the user’s location.</li>
<li><strong>Data analysis</strong>: Geocoding addresses in datasets allows analysis based on geography, such as customer distribution, logistics, and demographic studies.</li>
</ul>
<p>Geocoding is typically done through APIs like Google Maps, OpenStreetMap, or <strong>OneMap in Singapore</strong> (which we will be using), which processes the address and returns the corresponding coordinates for our use.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Reverse Geocoding</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Obtain Coordinates and Postal Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>We start by defining a function <code>get_coords</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>get_coords <span class="ot">&lt;-</span> <span class="cf">function</span>(address_list){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to store all retrieved coordinates</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  postal_coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> add_list){</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(i)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">'https://www.onemap.gov.sg/api/common/elastic/search?'</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">query=</span><span class="fu">list</span>(<span class="at">searchVal=</span>i,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">returnGeom=</span><span class="st">'Y'</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">getAddrDetails=</span><span class="st">'Y'</span>))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(r<span class="sc">$</span>content))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    found <span class="ot">&lt;-</span> data<span class="sc">$</span>found</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> data<span class="sc">$</span>results</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a new data frame for each address</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If single result, append </span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (found <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      postal <span class="ot">&lt;-</span> res<span class="sc">$</span>POSTAL </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      lat <span class="ot">&lt;-</span> res<span class="sc">$</span>LATITUDE</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      lng <span class="ot">&lt;-</span> res<span class="sc">$</span>LONGITUDE</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> postal, </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> lat, </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> lng)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If multiple results, drop NIL and append top 1</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (found <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Remove those with NIL as postal</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>      res_sub <span class="ot">&lt;-</span> res[res<span class="sc">$</span>POSTAL <span class="sc">!=</span> <span class="st">"NIL"</span>, ]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Set as NA first if no Postal</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">nrow</span>(res_sub) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>          new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                                <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                                <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        top1 <span class="ot">&lt;-</span> <span class="fu">head</span>(res_sub, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        postal <span class="ot">&lt;-</span> top1<span class="sc">$</span>POSTAL </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        lat <span class="ot">&lt;-</span> top1<span class="sc">$</span>LATITUDE</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        lng <span class="ot">&lt;-</span> top1<span class="sc">$</span>LONGITUDE</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>                              <span class="at">postal =</span> postal, </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                              <span class="at">latitude =</span> lat, </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>                              <span class="at">longitude =</span> lng)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      new_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">address=</span> i, </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>                            <span class="at">postal =</span> <span class="cn">NA</span>, </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>                            <span class="at">latitude =</span> <span class="cn">NA</span>, </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>                            <span class="at">longitude =</span> <span class="cn">NA</span>)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the row</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    postal_coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(postal_coords, new_row)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(postal_coords)</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">get_coords</span>(address_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(coords, <span class="st">"data/rds/coords.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>coords<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/coords.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now that we have obtained the coordinates, we can create an sf object by using the st_as_sf() function of the sf package as shown in the code chunk below.</p>
<p>Converting it into an sf data-frame is necessary to conduct analysis and ensure consistent geometries. We first set the EPSG code to 4326 as it is undefined, and then convert it to the correct EPSG code of 3414 for Singapore. Skipping out on setting the initial CRS as 4326 will cause issues down the line as the geometries will not be accurate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>resale_sf<span class="ot">=</span><span class="fu">st_as_sf</span>(coords, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">'longitude'</span>, <span class="st">'latitude'</span>), <span class="at">crs=</span> <span class="dv">4326</span>, <span class="at">agr =</span> <span class="st">'constant'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now change a few columns in a way that can facilitate analysis.</p>
<p>We start off by changing storey ranges from bins to numeric values depicting a scale, such as floor 1-3 will be 1- which means its the lowest. We will do this for the <code>resale_tidy</code> data-frame generated earlier as this is what we will use to join with the prepared data-frame later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First determine all the unique ranges</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>unique_storey_ranges <span class="ot">&lt;-</span> <span class="fu">unique</span>(resale_tidy<span class="sc">$</span>storey_range)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_storey_ranges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "04 TO 06" "25 TO 27" "07 TO 09" "01 TO 03" "10 TO 12" "13 TO 15"
 [7] "16 TO 18" "22 TO 24" "19 TO 21" "34 TO 36" "28 TO 30" "37 TO 39"
[13] "31 TO 33" "40 TO 42" "43 TO 45" "46 TO 48" "49 TO 51"</code></pre>
</div>
</div>
<p>Now, we can generate numeric values instead. This is done in the below code chunk.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Verification</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>resale_tidy <span class="ot">&lt;-</span> resale_tidy <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_storey =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(storey_range, <span class="st">"^[0-9]+"</span>)),  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">storey_scale =</span> ((min_storey <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="dv">1</span>               </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>min_storey)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>We implement the head() function to verify if it has been created as intended.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 15
  month town  flat_type block street_name storey_range floor_area_sqm flat_model
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;     
1 2023… ANG … 3 ROOM    225   ANG MO KIO… 04 TO 06                 67 New Gener…
2 2023… ANG … 3 ROOM    310C  ANG MO KIO… 25 TO 27                 70 Model A   
3 2023… ANG … 3 ROOM    225   ANG MO KIO… 07 TO 09                 67 New Gener…
4 2023… ANG … 3 ROOM    319   ANG MO KIO… 04 TO 06                 73 New Gener…
5 2023… ANG … 3 ROOM    319   ANG MO KIO… 07 TO 09                 73 New Gener…
6 2023… ANG … 3 ROOM    220   ANG MO KIO… 04 TO 06                 67 New Gener…
# ℹ 7 more variables: lease_commence_date &lt;dbl&gt;, remaining_lease &lt;chr&gt;,
#   resale_price &lt;dbl&gt;, address &lt;chr&gt;, remaining_lease_yr &lt;int&gt;,
#   remaining_lease_mth &lt;int&gt;, storey_scale &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now, we want to create a column <code>total_remaining_lease</code> that shows the number of months remaining on the lease, where we combine the total remaining number of years and months into a singular column and show the total in months.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Data Cleaning</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Verification</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>We noticed quite a few values shown as NA, for example if exactly 94 years were left on the lease, then the month column would show NA. We need to fix this before proceeding else it causes issues.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resale_tidy <span class="ot">&lt;-</span> resale_tidy <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_mth =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(remaining_lease_mth), <span class="dv">0</span>, remaining_lease_mth),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">remaining_lease_yr =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(remaining_lease_yr), <span class="dv">0</span>, remaining_lease_yr)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine remaining_yr and remaining_mth into total_remaining in months</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>resale_tidy <span class="ot">&lt;-</span> resale_tidy <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_remaining_lease =</span> (remaining_lease_yr <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">+</span> remaining_lease_mth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 16
  month town  flat_type block street_name storey_range floor_area_sqm flat_model
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;     
1 2023… ANG … 3 ROOM    225   ANG MO KIO… 04 TO 06                 67 New Gener…
2 2023… ANG … 3 ROOM    310C  ANG MO KIO… 25 TO 27                 70 Model A   
3 2023… ANG … 3 ROOM    225   ANG MO KIO… 07 TO 09                 67 New Gener…
4 2023… ANG … 3 ROOM    319   ANG MO KIO… 04 TO 06                 73 New Gener…
5 2023… ANG … 3 ROOM    319   ANG MO KIO… 07 TO 09                 73 New Gener…
6 2023… ANG … 3 ROOM    220   ANG MO KIO… 04 TO 06                 67 New Gener…
# ℹ 8 more variables: lease_commence_date &lt;dbl&gt;, remaining_lease &lt;chr&gt;,
#   resale_price &lt;dbl&gt;, address &lt;chr&gt;, remaining_lease_yr &lt;int&gt;,
#   remaining_lease_mth &lt;dbl&gt;, storey_scale &lt;dbl&gt;, total_remaining_lease &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-data">3.1.2.2 Geospatial Data</h3>
<p>We first import the URA Master Plan data by implementing the st_read() function of the sf package.</p>
<p>Additionally, we ensure that the CRS information is consistent with that of Singapore to facilitate the creation of our predictive model. The st_transform() function of the sf package is implemented for this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mpsz<span class="ot">=</span><span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">'data/geospatial'</span>, <span class="at">layer=</span><span class="st">'MP14_SUBZONE_WEB_PL'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MP14_SUBZONE_WEB_PL' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 323 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21</code></pre>
</div>
</div>
<div class="note-box">
<p>The EPSG code of Singapore is 3414.</p>
</div>
<section id="extracting-the-cbd" class="level4">
<h4 class="anchored" data-anchor-id="extracting-the-cbd">3.1.2.2.1 Extracting the CBD</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">CBD Planning Areas</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">CBD Data</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>cbd_spots<span class="ot">=</span><span class="fu">c</span>(<span class="st">'ORCHARD'</span>, <span class="st">'SINGAPORE RIVER'</span>, <span class="st">'DOWNTOWN CORE'</span>, <span class="st">'MUSUEM'</span>, <span class="st">'RIVER VALLEY'</span>, <span class="st">'NEWTON'</span>, <span class="st">' ROCHOR'</span>, <span class="st">'OUTRAM'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>cbd<span class="ot">=</span>mpsz<span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PLN_AREA_N <span class="sc">%in%</span> cbd_spots)<span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We verify if it has been extracted as expected by plotting a highly cartographic map using the tmap package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(cbd)<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">'green'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="locational-factors-geospatial" class="level3">
<h3 class="anchored" data-anchor-id="locational-factors-geospatial">3.1.2.2 Locational Factors (Geospatial)</h3>
<p>We will now import a number of data-sets that carry the data necessary for us to measure the impact of proximity to these facilities on housing prices.</p>
<p>Additionally, we ensure that the CRS information is consistent with that of Singapore to facilitate the creation of our predictive model. The st_transform() function of the sf package is implemented for this.</p>
<div class="note-box">
<p>Note that some data-sets may have 3-dimensional geometry, that is Point Z. To convert this to point form, we use the st_zm() function and set the <code>drop</code> argument to TRUE.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Eldercare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">CHAS Clinics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Supermarkets</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">MRT</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false">Bus Stops</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-6" role="tab" aria-controls="tabset-5-6" aria-selected="false">Hawkers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-7" role="tab" aria-controls="tabset-5-7" aria-selected="false">Kindgergartens</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-8" role="tab" aria-controls="tabset-5-8" aria-selected="false">Parks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-9" role="tab" aria-controls="tabset-5-9" aria-selected="false">Childcare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-10" role="tab" aria-controls="tabset-5-10" aria-selected="false">Gyms</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>eldercare<span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">'data/locational_factors'</span>, <span class="at">layer=</span><span class="st">'ELDERCARE'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `ELDERCARE' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors' 
  using driver `ESRI Shapefile'
Simple feature collection with 133 features and 18 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 14481.92 ymin: 28218.43 xmax: 41665.14 ymax: 46804.9
Projected CRS: SVY21</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>CHAS<span class="ot">=</span><span class="fu">st_read</span>(<span class="st">'data/locational_factors/CHASClinics.kml'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `MOH_CHAS_CLINICS' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors\CHASClinics.kml' 
  using driver `KML'
Simple feature collection with 1193 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.5818 ymin: 1.016264 xmax: 103.9903 ymax: 1.456037
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>supermarket<span class="ot">=</span><span class="fu">st_read</span>(<span class="st">'data/locational_factors/SupermarketsKML.kml'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SUPERMARKETS' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors\SupermarketsKML.kml' 
  using driver `KML'
Simple feature collection with 526 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6258 ymin: 1.24715 xmax: 104.0036 ymax: 1.461526
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>supermarket <span class="ot">&lt;-</span> <span class="fu">st_zm</span>(supermarket, <span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mrt<span class="ot">=</span><span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">'data/locational_factors'</span>, <span class="at">layer=</span><span class="st">'RapidTransitSystemStation'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">OGR_GEOMETRY_ACCEPT_UNCLOSED_RING =</span> <span class="st">"NO"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>mrt <span class="ot">&lt;-</span> mrt[<span class="sc">!</span><span class="fu">st_is_empty</span>(mrt), ]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Polygon to Point</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>mrt <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(mrt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>Generally, GDAL (Geospatial Data Abstraction Library) might accept polygons with unclosed rings which may result in invalid geometries. These cause issues when conducting spatial analysis and operations on R. Setting the <code>OGR_GEOMETRY_ACCEPT_UNCLOSED_RING</code>=‘NO’ tells GDAL explicitly to reject these unclosed rings.</p>
</div>
<p>Given we have modified the mrt data, we will create an RDS file to facilitate computational efficiency. The write_rds() function is used to create and store the RDS file on the local system. The read_rds() function is used to import it into our environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(mrt, <span class="st">'data/rds/mrt.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mrt<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/mrt.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>bus<span class="ot">=</span><span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">'data/locational_factors'</span>, <span class="at">layer=</span><span class="st">'BusStop'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BusStop' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors' 
  using driver `ESRI Shapefile'
Simple feature collection with 5166 features and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48285.52 ymax: 52983.82
Projected CRS: SVY21</code></pre>
</div>
</div>
</div>
<div id="tabset-5-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>hawkers<span class="ot">=</span><span class="fu">st_read</span>(<span class="st">'data/locational_factors/HawkerCentresGEOJSON.geojson'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `HawkerCentresGEOJSON' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors\HawkerCentresGEOJSON.geojson' 
  using driver `GeoJSON'
Simple feature collection with 125 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6974 ymin: 1.272716 xmax: 103.9882 ymax: 1.449017
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-5-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>kindergartens<span class="ot">=</span><span class="fu">st_read</span>(<span class="st">'data/locational_factors/Kindergartens.geojson'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Kindergartens' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors\Kindergartens.geojson' 
  using driver `GeoJSON'
Simple feature collection with 448 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6887 ymin: 1.247759 xmax: 103.9717 ymax: 1.455452
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-5-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-8-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>parks<span class="ot">=</span><span class="fu">st_read</span>(<span class="st">'data/locational_factors/Parks.geojson'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `Parks' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors\Parks.geojson' 
  using driver `GeoJSON'
Simple feature collection with 430 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6929 ymin: 1.214491 xmax: 104.0538 ymax: 1.462094
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</div>
<div id="tabset-5-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-9-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>childcare<span class="ot">=</span><span class="fu">st_read</span>(<span class="at">dsn=</span><span class="st">'data/locational_factors'</span>, <span class="at">layer=</span><span class="st">'CHILDCARE'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `CHILDCARE' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors' 
  using driver `ESRI Shapefile'
Simple feature collection with 1885 features and 1 field
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 11226.55 ymin: 25523.51 xmax: 44936.07 ymax: 49308.17
Projected CRS: SVY21 / Singapore TM</code></pre>
</div>
</div>
</div>
<div id="tabset-5-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-10-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>gym<span class="ot">=</span><span class="fu">st_read</span>(<span class="st">'data/locational_factors/GymsSGGEOJSON.geojson'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `GymsSGGEOJSON' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex3\data\locational_factors\GymsSGGEOJSON.geojson' 
  using driver `GeoJSON'
Simple feature collection with 159 features and 2 fields
Geometry type: POINT
Dimension:     XYZ
Bounding box:  xmin: 103.6938 ymin: 1.262063 xmax: 103.9518 ymax: 1.435078
z_range:       zmin: 0 zmax: 0
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Dropping Z</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>gym<span class="ot">&lt;-</span> <span class="fu">st_zm</span>(gym, <span class="at">drop =</span> <span class="cn">TRUE</span>, <span class="at">what =</span> <span class="st">"ZM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now that we have imported relevant locational factors, we want to determine the proximity of flats to these factors. We will do so in the next section below.</p>
</section>
</section>
</section>
<section id="data-wrangling-and-manipulation" class="level1">
<h1>3.2 Data Wrangling and Manipulation</h1>
<p>We calculate the number of data points within a distance. We will use the st_buffer() function of the sf package for this.</p>
<div class="note-box">
<p>if we set the <code>dist</code> argument to 1000, we create a buffer of 1KM around each point in the resale data-set.This allows us to determine the number of data-points of other Points of Interest within this zone.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Defining Buffers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Creating Point Counts</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first create a buffer. Alter this based on the input data. (eg: 200m for bus stops, 1000m for medical and care facilities, schools, parks and supermarkets)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>buffer_200m<span class="ot">=</span><span class="fu">st_buffer</span>(resale_sf, <span class="at">dist=</span><span class="dv">200</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>buffer_500m<span class="ot">=</span><span class="fu">st_buffer</span>(resale_sf, <span class="at">dist=</span><span class="dv">500</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>buffer_1000m<span class="ot">=</span><span class="fu">st_buffer</span>(resale_sf, <span class="at">dist=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 200M</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>buffer_200m<span class="sc">$</span>bus_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_200m, bus)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>buffer_200m<span class="sc">$</span>chas_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_200m, CHAS)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>buffer_200m<span class="sc">$</span>eldercare_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_200m, eldercare)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co">#500m</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>buffer_500m<span class="sc">$</span>hawker_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_500m, hawkers)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>buffer_500m<span class="sc">$</span>supermarket_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_500m, supermarket)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>buffer_500m<span class="sc">$</span>childcare_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_500m, childcare)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 1000M</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>buffer_1000m<span class="sc">$</span>park_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_1000m, parks)</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>buffer_1000m<span class="sc">$</span>mrt_pts_count<span class="ot">=</span> <span class="fu">lengths</span>(</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_1000m, mrt)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>buffer_1000m<span class="sc">$</span>gym_pts_count<span class="ot">=</span><span class="fu">lengths</span>(</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersects</span>(buffer_1000m, gym)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="combining-data-frames" class="level2">
<h2 class="anchored" data-anchor-id="combining-data-frames">3.2.1 Combining Data-frames</h2>
<p>After creating the above data-frames (<code>buffer_200m</code>, <code>buffer_500m</code>, and <code>buffer_1000m</code>), we join all of these together to create one data-frame containing all relevant counts.</p>
<p>The steps are as follows:</p>
<ul>
<li><p>The first step is to drop the geometry for a data-frame to facilitate the join. As seen below, we do it first for <code>buffer_1000m</code> and then combine it with <code>buffer_200m</code>. We use the st_drop_geometry() function for this. We select the columns we want to extract from buffer_1000m using the select function as well.</p></li>
<li><p>Second, we use the left_join() function of dplyr and join <code>buffer_200m</code> with <code>buffer_1000m_no_geom</code> by using the common keys.</p></li>
</ul>
<div class="note-box">
<p>Do note that the bind_rows() simply stacks these data-frames.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop geometry from `y` and select only the necessary columns</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>buffer_1000m_no_geom <span class="ot">&lt;-</span> buffer_1000m <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address, postal, park_pts_count, gym_pts_count, mrt_pts_count)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a join on the common columns (address and postal)</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>combined_sf <span class="ot">&lt;-</span> buffer_200m <span class="sc">%&gt;%</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(buffer_1000m_no_geom, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"address"</span>, <span class="st">"postal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We repeat the above steps to join <code>buffer_500m</code>. We name the resulting data-frame <code>points_count</code> as it contains all relevant point counts that we generated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>buffer_500m_no_geom <span class="ot">&lt;-</span> buffer_500m <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address, postal, hawker_pts_count, supermarket_pts_count, childcare_pts_count)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a join on the common columns (address and postal)</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>points_count <span class="ot">&lt;-</span> combined_sf <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(buffer_500m_no_geom, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"address"</span>, <span class="st">"postal"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distance-matrix" class="level2">
<h2 class="anchored" data-anchor-id="distance-matrix">3.2.2 Distance Matrix</h2>
<p>The next step of our analysis is to determine the proximity of each location to the closest locational factor. The distance will denoted in metres, as Singapores coordinates are projected in SVY21.</p>
<p>The st_distance() function is applied to determines pairwise distances between points in the two data-frames. After that, we use the apply() function to obtain the minimum distance. This allows us to determine the closest facility to each respective house in our data-frame.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Eldercare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Childcare</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">MRT</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">Bus</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-5" role="tab" aria-controls="tabset-7-5" aria-selected="false">CBD</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-6" role="tab" aria-controls="tabset-7-6" aria-selected="false">CHAS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-7" role="tab" aria-controls="tabset-7-7" aria-selected="false">Parks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-8" role="tab" aria-controls="tabset-7-8" aria-selected="false">Supermarket</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-9" role="tab" aria-controls="tabset-7-9" aria-selected="false">Kindergartens</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-10" role="tab" aria-controls="tabset-7-10" aria-selected="false">Gym</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all eldercare facilities</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_eldercare <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, eldercare)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>min_distances_eldercare <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_eldercare, <span class="dv">1</span>, min)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_eldercare_dist <span class="ot">&lt;-</span> min_distances_eldercare</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_childcare <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, childcare)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>min_distances_childcare <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_childcare, <span class="dv">1</span>, min)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_childcare_dist <span class="ot">&lt;-</span> min_distances_childcare</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_mrt <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, mrt)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>min_distances_mrt <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_mrt, <span class="dv">1</span>, min)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_mrt_dist <span class="ot">&lt;-</span> min_distances_mrt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_bus<span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, bus)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>min_distances_bus <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_bus, <span class="dv">1</span>, min)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_bus_dist <span class="ot">&lt;-</span> min_distances_bus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_cbd <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, cbd)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>min_distances_cbd <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_cbd, <span class="dv">1</span>, min)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_cbd_dist <span class="ot">&lt;-</span> min_distances_cbd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_chas <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, CHAS)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>min_distances_chas <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_chas, <span class="dv">1</span>, min)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_chas_dist <span class="ot">&lt;-</span> min_distances_chas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_parks <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, parks)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>min_distances_parks <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_parks, <span class="dv">1</span>, min)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_park_dist <span class="ot">&lt;-</span> min_distances_parks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-8-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_supermarket <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, supermarket)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>min_distances_supermarket <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_supermarket, <span class="dv">1</span>, min)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_childcare_dist <span class="ot">&lt;-</span> min_distances_supermarket</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-9-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_kg <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, kindergartens)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>min_distances_kg <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_kg, <span class="dv">1</span>, min)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_kindergarten_dist <span class="ot">&lt;-</span> min_distances_kg</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-10-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distances between all houses and all childcare facilities</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>dist_matrix_gym <span class="ot">&lt;-</span> <span class="fu">st_distance</span>(points_count, gym)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimum distance for each house</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>min_distances_gym <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_matrix_gym, <span class="dv">1</span>, min)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>points_count<span class="sc">$</span>nearest_gym_dist <span class="ot">&lt;-</span> min_distances_gym</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We now create an RDS file using the write_rds() function to facilitate computational efficiency.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(points_count, <span class="st">'data/rds/points_count.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>points_count<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/points_count.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We now join <code>points_count</code> back with <code>resale_tidy</code> in order to have all the details consolidated. We use the left_join() function and join using the common key of address. We will only keep selected rows for our analysis. We name this data-frame <code>resale_data</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>resale_data<span class="ot">=</span> points_count <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(resale_tidy, <span class="at">by =</span> <span class="st">"address"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can check if the columns have been selected as intended by using the head() function as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resale_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 35 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 31267.83 ymin: 31578.89 xmax: 39373.81 ymax: 33878.86
Projected CRS: SVY21 / Singapore TM
            address postal bus_pts_count chas_pts_count eldercare_pts_count
1        1 BEACH RD 190001             3              1                   4
2        1 BEACH RD 190001             3              1                   4
3        1 BEACH RD 190001             3              1                   4
4        1 BEACH RD 190001             3              1                   4
5 1 BEDOK STH AVE 1 460001             1              1                   0
6 1 BEDOK STH AVE 1 460001             1              1                   0
  park_pts_count gym_pts_count mrt_pts_count hawker_pts_count
1              3             8             3                2
2              3             8             3                2
3              3             8             3                2
4              3             8             3                2
5              6             1             1                1
6              6             1             1                1
  supermarket_pts_count childcare_pts_count nearest_eldercare_dist
1                     1                   2                 0.0000
2                     1                   2                 0.0000
3                     1                   2                 0.0000
4                     1                   2                 0.0000
5                     2                   7               139.7537
6                     2                   7               139.7537
  nearest_childcare_dist nearest_mrt_dist nearest_bus_dist nearest_cbd_dist
1                      0         237.9981                0          506.204
2                      0         237.9981                0          506.204
3                      0         237.9981                0          506.204
4                      0         237.9981                0          506.204
5                      0         327.2657                0         8060.530
6                      0         327.2657                0         8060.530
  nearest_chas_dist nearest_park_dist nearest_kindergarten_dist
1                 0          13.57091                  217.3620
2                 0          13.57091                  217.3620
3                 0          13.57091                  217.3620
4                 0          13.57091                  217.3620
5                 0         239.50824                  221.8531
6                 0         239.50824                  221.8531
  nearest_gym_dist   month            town flat_type block     street_name
1         335.3991 2023-07 KALLANG/WHAMPOA    3 ROOM     1        BEACH RD
2         335.3991 2023-12 KALLANG/WHAMPOA    3 ROOM     1        BEACH RD
3         335.3991 2024-01 KALLANG/WHAMPOA    3 ROOM     1        BEACH RD
4         335.3991 2024-05 KALLANG/WHAMPOA    3 ROOM     1        BEACH RD
5         554.4620 2023-04           BEDOK    3 ROOM     1 BEDOK STH AVE 1
6         554.4620 2023-08           BEDOK    3 ROOM     1 BEDOK STH AVE 1
  storey_range floor_area_sqm flat_model lease_commence_date    remaining_lease
1     07 TO 09             74   Improved                1979 55 years 03 months
2     10 TO 12             68   Improved                1979 54 years 10 months
3     07 TO 09             68   Improved                1979 54 years 09 months
4     04 TO 06             68   Improved                1979 54 years 05 months
5     04 TO 06             59   Improved                1976 51 years 10 months
6     10 TO 12             59   Improved                1976 51 years 05 months
  resale_price remaining_lease_yr remaining_lease_mth storey_scale
1       440000                 55                   3            3
2       418000                 54                  10            4
3       440000                 54                   9            3
4       425000                 54                   5            2
5       335000                 51                  10            2
6       370000                 51                   5            4
  total_remaining_lease                       geometry
1                   663 POLYGON ((31667.83 31778.89...
2                   658 POLYGON ((31667.83 31778.89...
3                   657 POLYGON ((31667.83 31778.89...
4                   653 POLYGON ((31667.83 31778.89...
5                   622 POLYGON ((39373.81 33678.86...
6                   617 POLYGON ((39373.81 33678.86...</code></pre>
</div>
</div>
</section>
</section>
<section id="data-overview" class="level1">
<h1>3.3 Data Overview</h1>
<section id="popular-towns" class="level2">
<h2 class="anchored" data-anchor-id="popular-towns">3.3.1 Popular Towns</h2>
<p>To determine which region has the most the number of flats sold in our selected time period.</p>
<p>We must first compute the count, that is total sales, in each town. We do so using the group_by() and summarise() function of the dplyr package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>town_sales_count <span class="ot">&lt;-</span> resale_data <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sales_count =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To determine the top region we simply implement the filter() function as in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>top_region <span class="ot">&lt;-</span> town_sales_count <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sales_count <span class="sc">==</span> <span class="fu">max</span>(sales_count))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>(top_region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 2 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 34120.85 ymin: 41356.12 xmax: 37815.35 ymax: 44133.95
Projected CRS: SVY21 / Singapore TM
# A tibble: 1 × 3
  town    sales_count                                                   geometry
* &lt;chr&gt;         &lt;int&gt;                                              &lt;POLYGON [m]&gt;
1 PUNGGOL        3446 ((34342.41 42405.26, 34331.94 42405.54, 34321.5 42406.36,…</code></pre>
</div>
</div>
<p>Punggol appears the region with the most sales at just over 3400 sales in the selected time period.</p>
<p>We implement the <strong>tmap</strong> package to generate a map to help us visualize the sales count across all towns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(town_sales_count) <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"sales_count"</span>, </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Sales Count"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Reds"</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"jenks"</span>) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">"Sales Count by Town"</span>)<span class="sc">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Eastern Singapore, regions such as Punggol, Sengkang, and Tampines appear to have the most sales. The Central and Western Region are relatively mild compared to Northern and Eastern Singapore in terms of sales count.</p>
</section>
<section id="price-trends" class="level2">
<h2 class="anchored" data-anchor-id="price-trends">3.3.2 Price Trends</h2>
<p>We want to gain an idea of the price trends across the different regions across the nation.</p>
<p>To do this, an average must be computed. We do so by implementing the group_by() and summarise() functions of the dplyr package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>town_avg <span class="ot">&lt;-</span> resale_data <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_resale_price =</span> <span class="fu">mean</span>(resale_price, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that this has been computed, we can join it back with <code>resale_data</code> so that we can map it using the <strong>tmap</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(town_avg) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"avg_resale_price"</span>, </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Average Resale Price"</span>,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Blues"</span>,     </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"jenks"</span>) <span class="sc">+</span>  </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">"Average Resale Price by Town"</span>)<span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We infer from the above that the Western region, towns like Jurong West, in particular seems to relatively cheaper compared to the rest of the towns.</p>
<p>The central region in particular, unsurprisingly, seems to have the highest resale price on average. This could be due to a variety of factors such as its proximity to the CBD, national hospitals etc.</p>
<div class="note-box">
<p>Do note that we are focusing on 3/4/5 room flats and hence there are a few empty regions, as seen in the map above.</p>
</div>
</section>
<section id="does-the-level-at-which-the-apartment-is-on-impact-its-price" class="level2">
<h2 class="anchored" data-anchor-id="does-the-level-at-which-the-apartment-is-on-impact-its-price">3.3.3 Does the level at which the apartment is on impact its price?</h2>
<p>We are interested to determine whether or not the level impacts floor pricing, that is whether an apartment on level 13 is more expensive than an apartment on level 5.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resale_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(storey_scale), <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">outlier.color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Resale Price Variation by Storey Scale"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Storey Scale"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Resale Price"</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see a clear rise in flat prices they higher the level the flat is on, a pretty significant increase at every level.</p>
<p>We will keep an eye on this when creating the predictive model,</p>
</section>
</section>
<section id="predictive-models" class="level1">
<h1>3.4 Predictive Models</h1>
<section id="correlation" class="level2">
<h2 class="anchored" data-anchor-id="correlation">3.4.1 Correlation</h2>
<p>The key step that <strong>MUST</strong> be done before building a predictive model of any sort is to check for multicollinearity.</p>
<p>For this, we will also drop geometry using the st_drop_geometry() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>resale_nogeo <span class="ot">&lt;-</span> resale_data <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(resale_nogeo[, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">18</span>, <span class="dv">27</span>, <span class="dv">34</span><span class="sc">:</span><span class="dv">35</span>)]), </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">diag =</span> <span class="cn">FALSE</span>, </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">order =</span> <span class="st">"AOE"</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.pos =</span> <span class="st">"td"</span>, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tl.cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"number"</span>, </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">type =</span> <span class="st">"upper"</span>,</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">number.cex =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(resale_nogeo[, <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">18</span>, <span class="dv">27</span>, <span class="dv">34</span><span class="sc">:</span><span class="dv">35</span>)], class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         bus_pts_count         chas_pts_count    eldercare_pts_count 
             "integer"              "integer"              "integer" 
        park_pts_count          gym_pts_count          mrt_pts_count 
             "integer"              "integer"              "integer" 
      hawker_pts_count  supermarket_pts_count    childcare_pts_count 
             "integer"              "integer"              "integer" 
nearest_eldercare_dist nearest_childcare_dist       nearest_mrt_dist 
             "numeric"              "numeric"              "numeric" 
      nearest_bus_dist       nearest_cbd_dist      nearest_chas_dist 
             "numeric"              "numeric"              "numeric" 
     nearest_park_dist         floor_area_sqm           storey_scale 
             "numeric"              "numeric"              "numeric" 
 total_remaining_lease 
             "numeric" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(resale_nogeo[[<span class="dv">35</span>]]))  <span class="co"># Count of NA values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.infinite</span>(resale_nogeo[[<span class="dv">35</span>]]))  <span class="co"># Count of Inf values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>From the above, we infer that there is no collinearity issue that could impact our model negatively.</p>
<div class="insights-box">
<p>Despite there being a few values of magnitude &gt;0.5, this is not enough to make us drop the predictor. Generally, it is a matter of concern if the value is above 0.8.</p>
</div>
</section>
<section id="hedonic-pricing-model" class="level2">
<h2 class="anchored" data-anchor-id="hedonic-pricing-model">3.4.2 Hedonic Pricing Model</h2>
<p>Hedonic pricing modeling is an econometric technique used to estimate the value of a good or service by breaking down the price into its component attributes. Commonly applied in real estate, it involves analyzing how individual factors such as location, size, amenities, or proximity to schools influence the overall market price of a property. This model helps in understanding how much each characteristic contributes to the price, separating the effect of specific features from the overall value.</p>
<p>We implement the lm() function of base R to build hedonic pricing models for condominium resale units.</p>
<p>First and foremost, we noticed that the geometry is in polygon form. We will implement the st_centroid() function of the sf package to convert this into point form as shown in the below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>resale_data<span class="ot">=</span><span class="fu">st_centroid</span>(resale_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We start off by filtering the data to include only the relevant columns for our analysis, including filtering out all data for the year 2024 as we are to train the model using 2023 data.</p>
<p>We will change the order of columns in the resulting data-sets too to facilitate easier reading.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">2023</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">2024</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out 2024</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>resale_2023<span class="ot">=</span>resale_data<span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month<span class="sc">&lt;=</span><span class="st">"2023-12"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">27</span>,<span class="dv">31</span>, <span class="dv">34</span><span class="sc">:</span><span class="dv">35</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder Cols</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>resale_2023<span class="ot">=</span>resale_2023[, <span class="fu">c</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">23</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out 2023</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>resale_2024<span class="ot">=</span>resale_data<span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month<span class="sc">&gt;=</span><span class="st">"2024-07"</span> <span class="sc">&amp;</span> month<span class="sc">&lt;=</span><span class="st">"2024-09"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">27</span>,<span class="dv">31</span>, <span class="dv">34</span><span class="sc">:</span><span class="dv">35</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder Cols</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>resale_2024<span class="ot">=</span>resale_2024[, <span class="fu">c</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">1</span>,<span class="dv">23</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Now that we have checked for multicollinearity and created the required data-frame, we proceed with creating the predictive model.</p>
<p>To build a hedonic model, we simply apply the lm() function as mentioned earlier.</p>
<p>The below code chunk shows the implementation.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">MLR</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">OLS</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>hdb.mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm <span class="sc">+</span> nearest_gym_dist <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> childcare_pts_count <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>, </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>resale_2023)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hdb.mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = resale_price ~ total_remaining_lease + storey_scale + 
    floor_area_sqm + nearest_gym_dist + nearest_kindergarten_dist + 
    nearest_park_dist + nearest_chas_dist + nearest_cbd_dist + 
    nearest_bus_dist + nearest_mrt_dist + nearest_childcare_dist + 
    nearest_eldercare_dist + childcare_pts_count + supermarket_pts_count + 
    hawker_pts_count + mrt_pts_count + gym_pts_count + park_pts_count + 
    eldercare_pts_count + chas_pts_count + bus_pts_count, data = resale_2023)

Residuals:
    Min      1Q  Median      3Q     Max 
-369313  -42975   -5377   35844  495189 

Coefficients:
                            Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)               -2.044e+05  4.016e+03  -50.905  &lt; 2e-16 ***
total_remaining_lease      4.609e+02  2.929e+00  157.364  &lt; 2e-16 ***
storey_scale               1.567e+04  2.312e+02   67.760  &lt; 2e-16 ***
floor_area_sqm             5.334e+03  2.393e+01  222.915  &lt; 2e-16 ***
nearest_gym_dist          -1.127e+00  6.509e-01   -1.731  0.08345 .  
nearest_kindergarten_dist -2.628e+01  2.928e+00   -8.976  &lt; 2e-16 ***
nearest_park_dist         -1.640e+01  1.252e+00  -13.098  &lt; 2e-16 ***
nearest_chas_dist          4.224e+01  6.664e+00    6.339 2.36e-10 ***
nearest_cbd_dist          -1.740e+01  1.632e-01 -106.583  &lt; 2e-16 ***
nearest_bus_dist          -7.404e+01  3.278e+01   -2.259  0.02391 *  
nearest_mrt_dist          -5.559e+01  1.562e+00  -35.590  &lt; 2e-16 ***
nearest_childcare_dist     3.961e+01  3.760e+00   10.533  &lt; 2e-16 ***
nearest_eldercare_dist    -1.204e+01  8.543e-01  -14.089  &lt; 2e-16 ***
childcare_pts_count        8.917e+01  1.022e+02    0.872  0.38304    
supermarket_pts_count      8.133e+03  3.937e+02   20.657  &lt; 2e-16 ***
hawker_pts_count           3.005e+03  6.881e+02    4.366 1.27e-05 ***
mrt_pts_count             -8.003e+03  2.357e+02  -33.949  &lt; 2e-16 ***
gym_pts_count              6.371e+03  2.440e+02   26.116  &lt; 2e-16 ***
park_pts_count             9.779e+02  2.103e+02    4.649 3.35e-06 ***
eldercare_pts_count       -6.600e+03  1.048e+03   -6.297 3.09e-10 ***
chas_pts_count             4.053e+03  3.493e+02   11.602  &lt; 2e-16 ***
bus_pts_count             -9.146e+02  3.106e+02   -2.944  0.00324 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 65330 on 23533 degrees of freedom
Multiple R-squared:  0.8349,    Adjusted R-squared:  0.8347 
F-statistic:  5666 on 21 and 23533 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The above output must be analysed carefully as it provides a lot of details.</p>
<ul>
<li>This model accounts for just under 84% of total variation in resale price of HDB flats in 2023.</li>
<li>All but 2 variables are significant at the 5% significance level- <code>childcare_pts_count</code> and <code>nearest_gym_dist</code>.</li>
<li>The model is statistically significant.</li>
</ul>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p>We first remove out the two insignifcant variables.</p>
<p>Following that we create another model and then implement the ols_regress() function to produce a high quality output table to facilitate easier understanding.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>hdb.mlr1<span class="ot">=</span> <span class="fu">lm</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>, </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>resale_2023)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>olsrr<span class="sc">::</span><span class="fu">ols_regress</span>(hdb.mlr1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Model Summary                                
--------------------------------------------------------------------------
R                           0.914       RMSE                    65303.141 
R-Squared                   0.835       MSE                4268124214.448 
Adj. R-Squared              0.835       Coef. Var                  11.610 
Pred R-Squared              0.834       AIC                    589187.126 
MAE                     49424.028       SBC                    589356.535 
--------------------------------------------------------------------------
 RMSE: Root Mean Square Error 
 MSE: Mean Square Error 
 MAE: Mean Absolute Error 
 AIC: Akaike Information Criteria 
 SBC: Schwarz Bayesian Criteria 

                                     ANOVA                                       
--------------------------------------------------------------------------------
                    Sum of                                                      
                   Squares           DF       Mean Square       F          Sig. 
--------------------------------------------------------------------------------
Regression    5.078066e+14           19      2.672666e+13    6261.922    0.0000 
Residual      1.004503e+14        23535    4268124214.448                       
Total         6.082569e+14        23554                                         
--------------------------------------------------------------------------------

                                                  Parameter Estimates                                                   
-----------------------------------------------------------------------------------------------------------------------
                    model           Beta    Std. Error    Std. Beta       t         Sig           lower          upper 
-----------------------------------------------------------------------------------------------------------------------
              (Intercept)    -203597.900      3946.042                  -51.595    0.000    -211332.398    -195863.402 
    total_remaining_lease        459.308         2.812        0.525     163.355    0.000        453.797        464.819 
             storey_scale      15677.553       231.213        0.198      67.806    0.000      15224.362      16130.745 
           floor_area_sqm       5339.281        23.758        0.632     224.738    0.000       5292.714       5385.848 
nearest_kindergarten_dist        -26.958         2.881       -0.026      -9.357    0.000        -32.605        -21.311 
        nearest_park_dist        -16.227         1.249       -0.044     -12.993    0.000        -18.675        -13.779 
        nearest_chas_dist         42.466         6.663        0.021       6.374    0.000         29.407         55.526 
         nearest_cbd_dist        -17.437         0.158       -0.426    -110.551    0.000        -17.746        -17.128 
         nearest_bus_dist        -73.651        32.765       -0.006      -2.248    0.025       -137.872         -9.429 
         nearest_mrt_dist        -55.735         1.560       -0.121     -35.734    0.000        -58.792        -52.677 
   nearest_childcare_dist         39.643         3.759        0.036      10.547    0.000         32.276         47.010 
   nearest_eldercare_dist        -12.528         0.812       -0.048     -15.428    0.000        -14.120        -10.936 
    supermarket_pts_count       8076.802       386.798        0.065      20.881    0.000       7318.653       8834.952 
         hawker_pts_count       3054.745       687.479        0.015       4.443    0.000       1707.243       4402.248 
            mrt_pts_count      -8014.650       230.731       -0.122     -34.736    0.000      -8466.897      -7562.403 
            gym_pts_count       6464.555       234.936        0.083      27.516    0.000       6004.066       6925.044 
           park_pts_count        995.515       210.156        0.017       4.737    0.000        583.596       1407.434 
      eldercare_pts_count      -6761.275      1044.356       -0.019      -6.474    0.000      -8808.279      -4714.270 
           chas_pts_count       4085.661       348.576        0.035      11.721    0.000       3402.429       4768.893 
            bus_pts_count       -850.531       308.901       -0.008      -2.753    0.006      -1455.996       -245.065 
-----------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="insights-box">
<p>Another thing that the ols package lets you do is check the VIF, which is another way to check multicollinearity. <strong>If the VIF value is 10 or higher</strong>, that is when we must be concerned with regards to multicollinearity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>olsrr<span class="sc">::</span><span class="fu">ols_vif_tol</span>(hdb.mlr1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   Variables Tolerance      VIF
1      total_remaining_lease 0.6801054 1.470360
2               storey_scale 0.8264316 1.210022
3             floor_area_sqm 0.8863485 1.128224
4  nearest_kindergarten_dist 0.9395810 1.064304
5          nearest_park_dist 0.6156988 1.624171
6          nearest_chas_dist 0.6727964 1.486334
7           nearest_cbd_dist 0.4719791 2.118738
8           nearest_bus_dist 0.8479954 1.179252
9           nearest_mrt_dist 0.6105314 1.637917
10    nearest_childcare_dist 0.6082884 1.643957
11    nearest_eldercare_dist 0.7341674 1.362087
12     supermarket_pts_count 0.7272130 1.375113
13          hawker_pts_count 0.6531755 1.530982
14             mrt_pts_count 0.5682836 1.759685
15             gym_pts_count 0.7651070 1.307007
16            park_pts_count 0.5726813 1.746172
17       eldercare_pts_count 0.8578425 1.165715
18            chas_pts_count 0.7931092 1.260860
19             bus_pts_count 0.8151291 1.226799</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="spatial-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="spatial-autocorrelation">3.4.1.1 Spatial Autocorrelation</h3>
<p>The hedonic model we try to build are using geographically referenced attributes, hence it is also important for us to visual the residual of the hedonic pricing model.</p>
<p>In order to perform spatial autocorrelation test, we need to convert condo_resale.sf from sf data frame into a SpatialPointsDataFrame.</p>
<p>First, we will export the residual of the hedonic pricing model and save it as a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mlr.output <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(hdb.mlr1<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we will join the newly created data frame with <code>resale_data</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>hdb_resale.res.sf <span class="ot">&lt;-</span> <span class="fu">cbind</span>(resale_2023, </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>                        hdb.mlr1<span class="sc">$</span>residuals) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rename</span>(<span class="st">`</span><span class="at">MLR_RES</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">hdb.mlr1.residuals</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we will convert <code>hdb_resale.res.sf</code> from simple feature object into a SpatialPointsDataFrame because spdep package can only process sp conformed spatial data objects.</p>
<p>The code chunk below will be used to perform the data conversion process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>hdb_resale.sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(hdb_resale.res.sf)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>hdb_resale.sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatialPolygonsDataFrame 
features    : 23555 
extent      : 11397.31, 45392.3, 27897.64, 48941.06  (xmin, xmax, ymin, ymax)
crs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
variables   : 23
names       : total_remaining_lease, storey_scale, resale_price, floor_area_sqm, nearest_gym_dist, nearest_kindergarten_dist, nearest_park_dist, nearest_chas_dist, nearest_cbd_dist, nearest_bus_dist, nearest_mrt_dist, nearest_childcare_dist, nearest_eldercare_dist, childcare_pts_count, supermarket_pts_count, ... 
min values  :                   505,            1,       150000,             52,                0,                         0,                 0,                 0,                0,                0,                0,                      0,                      0,                   0,                     0, ... 
max values  :                  1154,           17,      1500000,            176,  4343.0405974637,          2967.56328554691,   2211.7822280043,  2512.20838763233, 17054.6103741159,  191.53318513933, 3292.27569241822,       3125.45180974505,       4567.54414612513,                  44,                    10, ... </code></pre>
</div>
</div>
<p>Next, we will use tmap package to display the distribution of the residuals on an interactive map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz)<span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale.res.sf) <span class="sc">+</span>  </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"MLR_RES"</span>,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">style=</span><span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">14</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There appears to be some clustering. In order to definitively determine whether there is spatial autocorrelation, we implement the Moran’s Test.</p>
<ul>
<li>H0: There is no signs of spatial autocorrelation. Observed patterns are due to complete spatial randomness.</li>
<li>H1: There are signs of spatial autocorrelation.</li>
</ul>
<p>First, we will compute the distance-based weight matrix by using dnearneigh() function of spdep.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">Read RDS Files</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(<span class="fu">coordinates</span>(hdb_resale.sp), <span class="dv">0</span>, <span class="dv">1500</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(nb, <span class="st">'data/rds/nb.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>nb<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/nb.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Next, the nb2listw() function of the spdep packge will be used to convert the output neighbours lists (i.e.&nbsp;nb) into a spatial weights.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Summary</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>nb_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(nb, <span class="at">style =</span> <span class="st">'W'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nb_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Next, lm.morantest() of spdep package will be used to perform Moran’s I test for residual spatial autocorrelation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.morantest</span>(hdb.mlr1, nb_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/Screenshot 2024-11-09 160250.png" class="img-fluid"></p>
<p>From the above output, we can infer that the spatial autocorrelation is statistically significant at the 5% significance level. We have sufficient evidence to reject the null hypothesis and conclude that there indeed signs of spatial clustering.</p>
<p>A value of 577.78 indicates that the observed pattern is very unlikely to be observed due to random chance.</p>
<p>The observed Moran I of approximately 0.2 indicates that there is <strong>weak to moderate</strong> positive spatial autocorrelation.</p>
</section>
<section id="hedonic-pricing-model-using-gwmodel-adaptive-bandwidth-method" class="level3">
<h3 class="anchored" data-anchor-id="hedonic-pricing-model-using-gwmodel-adaptive-bandwidth-method">3.4.2.1 Hedonic Pricing Model using GWModel (Adaptive Bandwidth Method)</h3>
<section id="computing-adaptive-bandwidth" class="level4">
<h4 class="anchored" data-anchor-id="computing-adaptive-bandwidth">3.4.2.1.1 Computing Adaptive Bandwidth</h4>
<p>In the code chunk below, the bw.gwr() function of the GWModel package is used to determine the bandwidth to use in the model.</p>
<div class="insights-box">
<p>Adopting the GWmodel approach provides is better for hedonic pricing models because it captures local variations, improves predictive accuracy, accommodates spatial non-stationarity, and offers rich spatial insights through visualization.</p>
<p>These benefits make it particularly suited for real estate markets, where location-specific attributes are crucial determinants of property prices, as in the study that we are conducting with regards to HDB flat resale prices in Singapore.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">Load RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>bw.adaptive<span class="ot">=</span><span class="fu">bw.gwr</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>hdb_resale.sp,</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">approach =</span> <span class="st">'CV'</span>,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bw.adaptive, <span class="st">'data/rds/bw_adaptive.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>bw.adaptive<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/bw_adaptive.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The adaptive bandwidth has been determined to be 92. We will use this value to calibrate the gwr-based hedonic pricing model.</p>
<p>Now, we can go ahead to calibrate the gwr-based hedonic pricing model by using adaptive bandwidth and gaussian kernel as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>gwr.adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>hdb_resale.sp, <span class="at">bw=</span>bw.adaptive, </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr.adaptive, <span class="st">'data/rds/gwr_adapt.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code chunk below can be used to display the model output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>gwr.adaptive<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/gwr_adapt.rds'</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>gwr.adaptive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ***********************************************************************
   *                       Package   GWmodel                             *
   ***********************************************************************
   Program starts at: 2024-11-08 08:33:13.835072 
   Call:
   gwr.basic(formula = resale_price ~ total_remaining_lease + storey_scale + 
    floor_area_sqm + nearest_kindergarten_dist + nearest_park_dist + 
    nearest_chas_dist + nearest_cbd_dist + nearest_bus_dist + 
    nearest_mrt_dist + nearest_childcare_dist + nearest_eldercare_dist + 
    supermarket_pts_count + hawker_pts_count + mrt_pts_count + 
    gym_pts_count + park_pts_count + eldercare_pts_count + chas_pts_count + 
    bus_pts_count, data = hdb_resale.sp, bw = bw.adaptive, kernel = "gaussian", 
    adaptive = TRUE, longlat = FALSE)

   Dependent (y) variable:  resale_price
   Independent variables:  total_remaining_lease storey_scale floor_area_sqm nearest_kindergarten_dist nearest_park_dist nearest_chas_dist nearest_cbd_dist nearest_bus_dist nearest_mrt_dist nearest_childcare_dist nearest_eldercare_dist supermarket_pts_count hawker_pts_count mrt_pts_count gym_pts_count park_pts_count eldercare_pts_count chas_pts_count bus_pts_count
   Number of data points: 23555
   ***********************************************************************
   *                    Results of Global Regression                     *
   ***********************************************************************

   Call:
    lm(formula = formula, data = data)

   Residuals:
    Min      1Q  Median      3Q     Max 
-368270  -42963   -5454   35907  495600 

   Coefficients:
                               Estimate Std. Error  t value Pr(&gt;|t|)    
   (Intercept)               -2.036e+05  3.946e+03  -51.595  &lt; 2e-16 ***
   total_remaining_lease      4.593e+02  2.812e+00  163.355  &lt; 2e-16 ***
   storey_scale               1.568e+04  2.312e+02   67.806  &lt; 2e-16 ***
   floor_area_sqm             5.339e+03  2.376e+01  224.738  &lt; 2e-16 ***
   nearest_kindergarten_dist -2.696e+01  2.881e+00   -9.357  &lt; 2e-16 ***
   nearest_park_dist         -1.623e+01  1.249e+00  -12.993  &lt; 2e-16 ***
   nearest_chas_dist          4.247e+01  6.663e+00    6.374 1.88e-10 ***
   nearest_cbd_dist          -1.744e+01  1.577e-01 -110.551  &lt; 2e-16 ***
   nearest_bus_dist          -7.365e+01  3.277e+01   -2.248   0.0246 *  
   nearest_mrt_dist          -5.573e+01  1.560e+00  -35.734  &lt; 2e-16 ***
   nearest_childcare_dist     3.964e+01  3.759e+00   10.547  &lt; 2e-16 ***
   nearest_eldercare_dist    -1.253e+01  8.120e-01  -15.428  &lt; 2e-16 ***
   supermarket_pts_count      8.077e+03  3.868e+02   20.881  &lt; 2e-16 ***
   hawker_pts_count           3.055e+03  6.875e+02    4.443 8.90e-06 ***
   mrt_pts_count             -8.015e+03  2.307e+02  -34.736  &lt; 2e-16 ***
   gym_pts_count              6.465e+03  2.349e+02   27.516  &lt; 2e-16 ***
   park_pts_count             9.955e+02  2.102e+02    4.737 2.18e-06 ***
   eldercare_pts_count       -6.761e+03  1.044e+03   -6.474 9.73e-11 ***
   chas_pts_count             4.086e+03  3.486e+02   11.721  &lt; 2e-16 ***
   bus_pts_count             -8.505e+02  3.089e+02   -2.753   0.0059 ** 

   ---Significance stars
   Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
   Residual standard error: 65330 on 23535 degrees of freedom
   Multiple R-squared: 0.8349
   Adjusted R-squared: 0.8347 
   F-statistic:  6262 on 19 and 23535 DF,  p-value: &lt; 2.2e-16 
   ***Extra Diagnostic information
   Residual sum of squares: 1.004503e+14
   Sigma(hat): 65305.91
   AIC:  589187.1
   AICc:  589187.2
   BIC:  566012.9
   ***********************************************************************
   *          Results of Geographically Weighted Regression              *
   ***********************************************************************

   *********************Model calibration information*********************
   Kernel function: gaussian 
   Adaptive bandwidth: 92 (number of nearest neighbours)
   Regression points: the same locations as observations are used.
   Distance metric: Euclidean distance metric is used.

   ****************Summary of GWR coefficient estimates:******************
                                    Min.     1st Qu.      Median     3rd Qu.
   Intercept                 -6.0447e+07 -5.7658e+05 -2.9193e+05  1.5385e+04
   total_remaining_lease     -2.1867e+03  3.1391e+02  4.3552e+02  5.7160e+02
   storey_scale               3.9638e+03  1.0427e+04  1.2493e+04  1.4685e+04
   floor_area_sqm             2.9550e+03  4.4388e+03  5.2097e+03  6.3082e+03
   nearest_kindergarten_dist -7.6004e+02 -3.4989e+01  1.1502e+01  5.9307e+01
   nearest_park_dist         -2.5185e+03 -5.4680e+01 -1.3168e+01  2.3976e+01
   nearest_chas_dist         -1.2685e+04 -1.0022e+02 -1.2491e+01  7.9737e+01
   nearest_cbd_dist          -1.8287e+03 -3.6244e+01 -8.0689e+00  2.1907e+01
   nearest_bus_dist          -5.2268e+04 -3.6632e+02 -4.7123e+01  3.2595e+02
   nearest_mrt_dist          -1.1221e+03 -8.7319e+01 -4.9292e+01 -5.1243e+00
   nearest_childcare_dist    -3.1126e+03 -7.2903e+01 -1.1614e+01  4.9044e+01
   nearest_eldercare_dist    -1.8161e+03 -4.1556e+01  1.3129e+00  4.2830e+01
   supermarket_pts_count     -3.9322e+04 -2.8775e+03  1.4265e+03  5.2768e+03
   hawker_pts_count          -8.3780e+06 -6.5949e+03  3.4557e+03  1.7893e+04
   mrt_pts_count             -2.7134e+05 -6.1669e+03  3.4766e+02  6.0372e+03
   gym_pts_count             -2.2739e+06 -3.3798e+03  6.6034e+03  1.8959e+04
   park_pts_count            -2.3557e+05 -6.9592e+03 -8.1926e+02  5.6725e+03
   eldercare_pts_count       -2.6027e+06 -1.3383e+04 -3.5345e+03  7.7470e+03
   chas_pts_count            -3.2301e+04 -1.5971e+03  9.4891e+02  3.4014e+03
   bus_pts_count             -6.3522e+04 -1.6689e+03  2.1774e+02  2.6510e+03
                                   Max.
   Intercept                 19242493.3
   total_remaining_lease         1197.3
   storey_scale                 24711.6
   floor_area_sqm               11560.4
   nearest_kindergarten_dist     1881.3
   nearest_park_dist             2452.5
   nearest_chas_dist             7087.8
   nearest_cbd_dist              6990.2
   nearest_bus_dist             89747.2
   nearest_mrt_dist              4035.8
   nearest_childcare_dist       14299.1
   nearest_eldercare_dist        1701.4
   supermarket_pts_count        90472.1
   hawker_pts_count           1257388.2
   mrt_pts_count               392945.6
   gym_pts_count              6811961.3
   park_pts_count              286344.4
   eldercare_pts_count        1494614.5
   chas_pts_count               99874.4
   bus_pts_count                28085.5
   ************************Diagnostic information*************************
   Number of data points: 23555 
   Effective number of parameters (2trace(S) - trace(S'S)): 2281.846 
   Effective degrees of freedom (n-2trace(S) + trace(S'S)): 21273.15 
   AICc (GWR book, Fotheringham, et al. 2002, p. 61, eq 2.33): 558552.4 
   AIC (GWR book, Fotheringham, et al. 2002,GWR p. 96, eq. 4.22): 556427 
   BIC (GWR book, Fotheringham, et al. 2002,GWR p. 61, eq. 2.34): 549360.9 
   Residual sum of squares: 2.318373e+13 
   R-square value:  0.961885 
   Adjusted R-square value:  0.9577964 

   ***********************************************************************
   Program stops at: 2024-11-08 08:46:54.422807 </code></pre>
</div>
</div>
</section>
<section id="visualizing-gwr-output" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-gwr-output">3.4.2.2 Visualizing GWR Output</h4>
<p>In addition to the regression residuals, the output feature class table provides several key metrics, including observed and predicted values, the condition number (cond), Local R², residuals, and the coefficients with their standard errors for the explanatory variables:</p>
<ul>
<li><p>Condition Number: This diagnostic assesses local collinearity. When strong local collinearity is present, model results become unstable. A condition number greater than 30 suggests that the results may be unreliable due to multicollinearity.</p></li>
<li><p>Local R²: Values range from 0.0 to 1.0 and indicate the goodness-of-fit of the local regression model. Low Local R² values signal poor model performance in those regions. Mapping these values can help identify areas where the Geographically Weighted Regression (GWR) model is performing well and where it is underperforming, potentially highlighting missing or unaccounted-for variables.</p></li>
<li><p>Predicted Values: These are the fitted y values estimated by the GWR model.</p></li>
<li><p>Residuals: Residuals are calculated by subtracting the fitted y values from the observed y values. Standardized residuals have a mean of zero and a standard deviation of one. A gradient map (cold-to-hot) of standardized residuals can be created to visualize areas of model under- or overestimation.</p></li>
<li><p>Coefficient Standard Errors: These values reflect the reliability of each coefficient estimate. Smaller standard errors relative to the actual coefficients indicate higher confidence in the estimates. Large standard errors, however, may suggest issues with local collinearity.</p></li>
</ul>
<p>All of these metrics are stored within a SpatialPointsDataFrame or SpatialPolygonsDataFrame object, integrated with the fit points, GWR coefficient estimates, observed and predicted y values, coefficient standard errors, and t-values in the “data” slot of an object called SDF within the output list.</p>
<p>To visualise the fields in SDF, we need to first covert it into sf data.frame by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>hdb_resale.sf.adaptive <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(gwr.adaptive<span class="sc">$</span>SDF) <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">3414</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>hdb_resale.sf.adaptive.svy21 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(hdb_resale.sf.adaptive, <span class="dv">3414</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>hdb_resale.sf.adaptive.svy21  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 23555 features and 66 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 11397.31 ymin: 27897.64 xmax: 45392.3 ymax: 48941.06
Projected CRS: SVY21 / Singapore TM
First 10 features:
    Intercept total_remaining_lease storey_scale floor_area_sqm
1  -553100.60              611.1439     16528.55       7039.609
2  -553100.60              611.1439     16528.55       7039.609
3   -97588.24              602.8097     13177.05       5746.557
4   -97588.24              602.8097     13177.05       5746.557
5  -738024.80              525.4686     10816.54       4788.974
6  -293788.18              468.0133     11290.74       4687.995
7  -293788.18              468.0133     11290.74       4687.995
8  -511883.91              490.0543     14610.28       8839.442
9  -511883.91              490.0543     14610.28       8839.442
10 -511883.91              490.0543     14610.28       8839.442
   nearest_kindergarten_dist nearest_park_dist nearest_chas_dist
1                 -62.793028         37.329660         373.80842
2                 -62.793028         37.329660         373.80842
3                  -3.561761         30.057517          50.12696
4                  -3.561761         30.057517          50.12696
5                  11.086781         44.895188        -213.86965
6                  -3.300683          6.976281          41.21432
7                  -3.300683          6.976281          41.21432
8                 252.971732       -102.994175        -217.84419
9                 252.971732       -102.994175        -217.84419
10                252.971732       -102.994175        -217.84419
   nearest_cbd_dist nearest_bus_dist nearest_mrt_dist nearest_childcare_dist
1         -5.551977        -64.24159       -140.57783             -123.04808
2         -5.551977        -64.24159       -140.57783             -123.04808
3        -43.833519        133.70031        -64.21593              -93.20306
4        -43.833519        133.70031        -64.21593              -93.20306
5         49.950660         54.10010        -70.22580             -113.69326
6         -4.356659        -95.23313        -56.52733               17.48012
7         -4.356659        -95.23313        -56.52733               17.48012
8        -62.953835        630.03227        -28.06152              -50.72489
9        -62.953835        630.03227        -28.06152              -50.72489
10       -62.953835        630.03227        -28.06152              -50.72489
   nearest_eldercare_dist supermarket_pts_count hawker_pts_count mrt_pts_count
1               15.552703             -3685.119        13749.049     -2256.093
2               15.552703             -3685.119        13749.049     -2256.093
3               39.412804             -6401.161         1228.572     13554.838
4               39.412804             -6401.161         1228.572     13554.838
5               12.306568              4460.402       -15935.464     26482.072
6                1.465535              4054.291        27610.985     -9804.357
7                1.465535              4054.291        27610.985     -9804.357
8              -64.075280              1672.093         7084.041     -6009.851
9              -64.075280              1672.093         7084.041     -6009.851
10             -64.075280              1672.093         7084.041     -6009.851
   gym_pts_count park_pts_count eldercare_pts_count chas_pts_count
1      2463.1645     11519.3488         -7900.60200       1311.954
2      2463.1645     11519.3488         -7900.60200       1311.954
3     31287.7213       905.5127         14847.12897      -3505.091
4     31287.7213       905.5127         14847.12897      -3505.091
5    -15692.3884      4250.2360         17866.31069      -8240.146
6     14551.3298      5332.2934            79.49318       5587.964
7     14551.3298      5332.2934            79.49318       5587.964
8       408.1617      1653.0821        -11085.20901       1051.745
9       408.1617      1653.0821        -11085.20901       1051.745
10      408.1617      1653.0821        -11085.20901       1051.745
   bus_pts_count      y     yhat   residual CV_Score Stud_residual Intercept_SE
1      8083.8068 440000 438463.7   1536.325        0    0.04888348    12690.500
2      8083.8068 418000 409698.8   8301.155        0    0.26397059    12690.500
3     -3902.9116 335000 311634.1  23365.942        0    0.74300559    84141.838
4     -3902.9116 370000 334974.1  35025.900        0    1.11921027    84141.838
5      -589.0293 637000 708169.4 -71169.399        0   -2.50213106   159720.262
6      2901.6799 315000 305554.2   9445.808        0    0.32084739     6776.685
7      2901.6799 358000 354782.1   3217.930        0    0.10929477     6776.685
8     20150.3385 860000 890362.3 -30362.267        0   -0.98274551    22062.520
9     20150.3385 988000 990184.0  -2183.980        0   -0.07195425    22062.520
10    20150.3385 938000 902032.2  35967.776        0    1.16235362    22062.520
   total_remaining_lease_SE storey_scale_SE floor_area_sqm_SE
1                  7.811053        572.9566          71.35533
2                  7.811053        572.9566          71.35533
3                 15.243877       1239.7483         113.17417
4                 15.243877       1239.7483         113.17417
5                 21.876627       1859.1527         141.45594
6                  4.464208        408.4014          32.87683
7                  4.464208        408.4014          32.87683
8                 12.631774        719.2308         100.67053
9                 12.631774        719.2308         100.67053
10                12.631774        719.2308         100.67053
   nearest_kindergarten_dist_SE nearest_park_dist_SE nearest_chas_dist_SE
1                     10.540209             7.947029            35.254242
2                     10.540209             7.947029            35.254242
3                     25.642343            17.373349            64.479705
4                     25.642343            17.373349            64.479705
5                     29.577383            16.742884            97.852704
6                      4.252736             2.414521             9.307702
7                      4.252736             2.414521             9.307702
8                     24.202820            11.431423            52.430171
9                     24.202820            11.431423            52.430171
10                    24.202820            11.431423            52.430171
   nearest_cbd_dist_SE nearest_bus_dist_SE nearest_mrt_dist_SE
1            2.0253650           114.48248            5.687046
2            2.0253650           114.48248            5.687046
3            9.3520394           137.14370           12.993674
4            9.3520394           137.14370           12.993674
5           19.2253880           265.51436           20.068963
6            0.4098527            37.08575            2.371249
7            0.4098527            37.08575            2.371249
8           11.5589827           228.89004           13.045566
9           11.5589827           228.89004           13.045566
10          11.5589827           228.89004           13.045566
   nearest_childcare_dist_SE nearest_eldercare_dist_SE supermarket_pts_count_SE
1                  14.090197                  3.933301                 1301.525
2                  14.090197                  3.933301                 1301.525
3                  29.215758                 16.123411                 2880.312
4                  29.215758                 16.123411                 2880.312
5                  40.596640                 21.683112                 3150.926
6                   5.840977                  1.411733                  520.767
7                   5.840977                  1.411733                  520.767
8                  36.456165                 34.236870                 2564.355
9                  36.456165                 34.236870                 2564.355
10                 36.456165                 34.236870                 2564.355
   hawker_pts_count_SE mrt_pts_count_SE gym_pts_count_SE park_pts_count_SE
1             2018.307        1034.2588         662.6568          925.3280
2             2018.307        1034.2588         662.6568          925.3280
3             3782.428        3365.4376        6439.1582          988.5184
4             3782.428        3365.4376        6439.1582          988.5184
5             5849.089        6196.6864        6848.9591         2491.7655
6             1267.753         279.1408         536.2942          327.2380
7             1267.753         279.1408         536.2942          327.2380
8             2803.455        3058.3860         947.1786         3336.1993
9             2803.455        3058.3860         947.1786         3336.1993
10            2803.455        3058.3860         947.1786         3336.1993
   eldercare_pts_count_SE chas_pts_count_SE bus_pts_count_SE Intercept_TV
1                2256.121          863.1553        1159.1979   -43.583831
2                2256.121          863.1553        1159.1979   -43.583831
3                7202.088         1735.1308        1588.6310    -1.159806
4                7202.088         1735.1308        1588.6310    -1.159806
5                8169.242         2396.6246        1861.6468    -4.620734
6                1776.533          502.6136         428.4428   -43.352785
7                1776.533          502.6136         428.4428   -43.352785
8                2765.543         1550.1835        2031.8621   -23.201516
9                2765.543         1550.1835        2031.8621   -23.201516
10               2765.543         1550.1835        2031.8621   -23.201516
   total_remaining_lease_TV storey_scale_TV floor_area_sqm_TV
1                  78.24092       28.847815          98.65569
2                  78.24092       28.847815          98.65569
3                  39.54438       10.628807          50.77622
4                  39.54438       10.628807          50.77622
5                  24.01964        5.817994          33.85488
6                 104.83680       27.646178         142.59268
7                 104.83680       27.646178         142.59268
8                  38.79537       20.313763          87.80566
9                  38.79537       20.313763          87.80566
10                 38.79537       20.313763          87.80566
   nearest_kindergarten_dist_TV nearest_park_dist_TV nearest_chas_dist_TV
1                    -5.9574747             4.697310           10.6032184
2                    -5.9574747             4.697310           10.6032184
3                    -0.1389015             1.730093            0.7774067
4                    -0.1389015             1.730093            0.7774067
5                     0.3748398             2.681449           -2.1856285
6                    -0.7761317             2.889302            4.4279799
7                    -0.7761317             2.889302            4.4279799
8                    10.4521594            -9.009742           -4.1549395
9                    10.4521594            -9.009742           -4.1549395
10                   10.4521594            -9.009742           -4.1549395
   nearest_cbd_dist_TV nearest_bus_dist_TV nearest_mrt_dist_TV
1            -2.741223          -0.5611478          -24.718956
2            -2.741223          -0.5611478          -24.718956
3            -4.687055           0.9748921           -4.942092
4            -4.687055           0.9748921           -4.942092
5             2.598161           0.2037558           -3.499224
6           -10.629816          -2.5679166          -23.838632
7           -10.629816          -2.5679166          -23.838632
8            -5.446313           2.7525543           -2.151039
9            -5.446313           2.7525543           -2.151039
10           -5.446313           2.7525543           -2.151039
   nearest_childcare_dist_TV nearest_eldercare_dist_TV supermarket_pts_count_TV
1                  -8.732886                 3.9541098               -2.8313865
2                  -8.732886                 3.9541098               -2.8313865
3                  -3.190164                 2.4444457               -2.2223846
4                  -3.190164                 2.4444457               -2.2223846
5                  -2.800558                 0.5675647                1.4155844
6                   2.992670                 1.0381109                7.7852300
7                   2.992670                 1.0381109                7.7852300
8                  -1.391394                -1.8715286                0.6520522
9                  -1.391394                -1.8715286                0.6520522
10                 -1.391394                -1.8715286                0.6520522
   hawker_pts_count_TV mrt_pts_count_TV gym_pts_count_TV park_pts_count_TV
1            6.8121700        -2.181362        3.7171044        12.4489354
2            6.8121700        -2.181362        3.7171044        12.4489354
3            0.3248104         4.027660        4.8589769         0.9160302
4            0.3248104         4.027660        4.8589769         0.9160302
5           -2.7244352         4.273586       -2.2912078         1.7057127
6           21.7794749       -35.123339       27.1331111        16.2948464
7           21.7794749       -35.123339       27.1331111        16.2948464
8            2.5268961        -1.965040        0.4309237         0.4954986
9            2.5268961        -1.965040        0.4309237         0.4954986
10           2.5268961        -1.965040        0.4309237         0.4954986
   eldercare_pts_count_TV chas_pts_count_TV bus_pts_count_TV  Local_R2
1             -3.50185240         1.5199517        6.9736211 0.9644450
2             -3.50185240         1.5199517        6.9736211 0.9644450
3              2.06150343        -2.0200730       -2.4567766 0.9685204
4              2.06150343        -2.0200730       -2.4567766 0.9685204
5              2.18702180        -3.4382297       -0.3164023 0.9629397
6              0.04474624        11.1178134        6.7726185 0.9404046
7              0.04474624        11.1178134        6.7726185 0.9404046
8             -4.00833063         0.6784648        9.9171782 0.9679198
9             -4.00833063         0.6784648        9.9171782 0.9679198
10            -4.00833063         0.6784648        9.9171782 0.9679198
                         geometry
1  POLYGON ((31667.83 31778.89...
2  POLYGON ((31667.83 31778.89...
3  POLYGON ((39373.81 33678.86...
4  POLYGON ((39373.81 33678.86...
5  POLYGON ((38149.03 34465.74...
6  POLYGON ((45392.3 41164.5, ...
7  POLYGON ((45392.3 41164.5, ...
8  POLYGON ((27673.09 30496.64...
9  POLYGON ((27673.09 30496.64...
10 POLYGON ((27673.09 30496.64...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>gwr.adaptive.output <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(gwr.adaptive<span class="sc">$</span>SDF)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>hdb_resale.sf.adaptive <span class="ot">&lt;-</span> <span class="fu">cbind</span>(hdb_resale.res.sf, <span class="fu">as.matrix</span>(gwr.adaptive.output))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we use the glimpse() function is used to display the content and summary of condo_resale.sf.adaptive sf data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(hdb_resale.sf.adaptive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 23,555
Columns: 90
$ total_remaining_lease        &lt;dbl&gt; 663, 658, 622, 617, 714, 675, 670, 709, 7…
$ storey_scale                 &lt;dbl&gt; 3, 4, 2, 4, 4, 1, 1, 2, 9, 3, 2, 4, 2, 1,…
$ resale_price                 &lt;dbl&gt; 440000, 418000, 335000, 370000, 637000, 3…
$ floor_area_sqm               &lt;dbl&gt; 74, 68, 59, 59, 133, 66, 77, 119, 119, 11…
$ nearest_gym_dist             &lt;dbl&gt; 335.39906, 335.39906, 554.46197, 554.4619…
$ nearest_kindergarten_dist    &lt;dbl&gt; 217.3620, 217.3620, 221.8531, 221.8531, 1…
$ nearest_park_dist            &lt;dbl&gt; 13.57091, 13.57091, 239.50824, 239.50824,…
$ nearest_chas_dist            &lt;dbl&gt; 0.00000, 0.00000, 0.00000, 0.00000, 0.000…
$ nearest_cbd_dist             &lt;dbl&gt; 506.2040, 506.2040, 8060.5303, 8060.5303,…
$ nearest_bus_dist             &lt;dbl&gt; 0.00000, 0.00000, 0.00000, 0.00000, 0.000…
$ nearest_mrt_dist             &lt;dbl&gt; 237.9981, 237.9981, 327.2657, 327.2657, 7…
$ nearest_childcare_dist       &lt;dbl&gt; 0.00000, 0.00000, 0.00000, 0.00000, 199.7…
$ nearest_eldercare_dist       &lt;dbl&gt; 0.0000, 0.0000, 139.7537, 139.7537, 117.8…
$ childcare_pts_count          &lt;int&gt; 2, 2, 7, 7, 6, 0, 0, 10, 10, 10, 2, 2, 2,…
$ supermarket_pts_count        &lt;int&gt; 1, 1, 2, 2, 4, 0, 0, 5, 5, 5, 1, 1, 1, 1,…
$ hawker_pts_count             &lt;int&gt; 2, 2, 1, 1, 1, 1, 1, 3, 3, 3, 0, 0, 0, 0,…
$ mrt_pts_count                &lt;int&gt; 3, 3, 1, 1, 2, 0, 0, 3, 3, 3, 3, 3, 3, 3,…
$ gym_pts_count                &lt;int&gt; 8, 8, 1, 1, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2,…
$ park_pts_count               &lt;int&gt; 3, 3, 6, 6, 9, 5, 5, 5, 5, 5, 1, 1, 1, 1,…
$ eldercare_pts_count          &lt;int&gt; 4, 4, 0, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0,…
$ chas_pts_count               &lt;int&gt; 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ bus_pts_count                &lt;int&gt; 3, 3, 1, 1, 2, 4, 4, 1, 1, 1, 1, 1, 1, 1,…
$ MLR_RES                      &lt;dbl&gt; -94225.891, -97571.217, 50079.695, 56021.…
$ Intercept                    &lt;dbl&gt; -553100.60, -553100.60, -97588.24, -97588…
$ total_remaining_lease.1      &lt;dbl&gt; 611.1439, 611.1439, 602.8097, 602.8097, 5…
$ storey_scale.1               &lt;dbl&gt; 16528.55, 16528.55, 13177.05, 13177.05, 1…
$ floor_area_sqm.1             &lt;dbl&gt; 7039.609, 7039.609, 5746.557, 5746.557, 4…
$ nearest_kindergarten_dist.1  &lt;dbl&gt; -62.793028, -62.793028, -3.561761, -3.561…
$ nearest_park_dist.1          &lt;dbl&gt; 37.329660, 37.329660, 30.057517, 30.05751…
$ nearest_chas_dist.1          &lt;dbl&gt; 373.80842, 373.80842, 50.12696, 50.12696,…
$ nearest_cbd_dist.1           &lt;dbl&gt; -5.551977, -5.551977, -43.833519, -43.833…
$ nearest_bus_dist.1           &lt;dbl&gt; -64.24159, -64.24159, 133.70031, 133.7003…
$ nearest_mrt_dist.1           &lt;dbl&gt; -140.57783, -140.57783, -64.21593, -64.21…
$ nearest_childcare_dist.1     &lt;dbl&gt; -123.04808, -123.04808, -93.20306, -93.20…
$ nearest_eldercare_dist.1     &lt;dbl&gt; 15.552703, 15.552703, 39.412804, 39.41280…
$ supermarket_pts_count.1      &lt;dbl&gt; -3685.119, -3685.119, -6401.161, -6401.16…
$ hawker_pts_count.1           &lt;dbl&gt; 13749.049, 13749.049, 1228.572, 1228.572,…
$ mrt_pts_count.1              &lt;dbl&gt; -2256.0933, -2256.0933, 13554.8383, 13554…
$ gym_pts_count.1              &lt;dbl&gt; 2463.1645, 2463.1645, 31287.7213, 31287.7…
$ park_pts_count.1             &lt;dbl&gt; 11519.3488, 11519.3488, 905.5127, 905.512…
$ eldercare_pts_count.1        &lt;dbl&gt; -7900.60200, -7900.60200, 14847.12897, 14…
$ chas_pts_count.1             &lt;dbl&gt; 1311.954, 1311.954, -3505.091, -3505.091,…
$ bus_pts_count.1              &lt;dbl&gt; 8083.8068, 8083.8068, -3902.9116, -3902.9…
$ y                            &lt;dbl&gt; 440000, 418000, 335000, 370000, 637000, 3…
$ yhat                         &lt;dbl&gt; 438463.7, 409698.8, 311634.1, 334974.1, 7…
$ residual                     &lt;dbl&gt; 1536.325, 8301.155, 23365.942, 35025.900,…
$ CV_Score                     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ Stud_residual                &lt;dbl&gt; 0.04888348, 0.26397059, 0.74300559, 1.119…
$ Intercept_SE                 &lt;dbl&gt; 12690.500, 12690.500, 84141.838, 84141.83…
$ total_remaining_lease_SE     &lt;dbl&gt; 7.811053, 7.811053, 15.243877, 15.243877,…
$ storey_scale_SE              &lt;dbl&gt; 572.9566, 572.9566, 1239.7483, 1239.7483,…
$ floor_area_sqm_SE            &lt;dbl&gt; 71.35533, 71.35533, 113.17417, 113.17417,…
$ nearest_kindergarten_dist_SE &lt;dbl&gt; 10.540209, 10.540209, 25.642343, 25.64234…
$ nearest_park_dist_SE         &lt;dbl&gt; 7.947029, 7.947029, 17.373349, 17.373349,…
$ nearest_chas_dist_SE         &lt;dbl&gt; 35.254242, 35.254242, 64.479705, 64.47970…
$ nearest_cbd_dist_SE          &lt;dbl&gt; 2.0253650, 2.0253650, 9.3520394, 9.352039…
$ nearest_bus_dist_SE          &lt;dbl&gt; 114.48248, 114.48248, 137.14370, 137.1437…
$ nearest_mrt_dist_SE          &lt;dbl&gt; 5.687046, 5.687046, 12.993674, 12.993674,…
$ nearest_childcare_dist_SE    &lt;dbl&gt; 14.090197, 14.090197, 29.215758, 29.21575…
$ nearest_eldercare_dist_SE    &lt;dbl&gt; 3.933301, 3.933301, 16.123411, 16.123411,…
$ supermarket_pts_count_SE     &lt;dbl&gt; 1301.525, 1301.525, 2880.312, 2880.312, 3…
$ hawker_pts_count_SE          &lt;dbl&gt; 2018.307, 2018.307, 3782.428, 3782.428, 5…
$ mrt_pts_count_SE             &lt;dbl&gt; 1034.2588, 1034.2588, 3365.4376, 3365.437…
$ gym_pts_count_SE             &lt;dbl&gt; 662.6568, 662.6568, 6439.1582, 6439.1582,…
$ park_pts_count_SE            &lt;dbl&gt; 925.3280, 925.3280, 988.5184, 988.5184, 2…
$ eldercare_pts_count_SE       &lt;dbl&gt; 2256.121, 2256.121, 7202.088, 7202.088, 8…
$ chas_pts_count_SE            &lt;dbl&gt; 863.1553, 863.1553, 1735.1308, 1735.1308,…
$ bus_pts_count_SE             &lt;dbl&gt; 1159.1979, 1159.1979, 1588.6310, 1588.631…
$ Intercept_TV                 &lt;dbl&gt; -43.583831, -43.583831, -1.159806, -1.159…
$ total_remaining_lease_TV     &lt;dbl&gt; 78.24092, 78.24092, 39.54438, 39.54438, 2…
$ storey_scale_TV              &lt;dbl&gt; 28.847815, 28.847815, 10.628807, 10.62880…
$ floor_area_sqm_TV            &lt;dbl&gt; 98.65569, 98.65569, 50.77622, 50.77622, 3…
$ nearest_kindergarten_dist_TV &lt;dbl&gt; -5.9574747, -5.9574747, -0.1389015, -0.13…
$ nearest_park_dist_TV         &lt;dbl&gt; 4.697310, 4.697310, 1.730093, 1.730093, 2…
$ nearest_chas_dist_TV         &lt;dbl&gt; 10.60321839, 10.60321839, 0.77740674, 0.7…
$ nearest_cbd_dist_TV          &lt;dbl&gt; -2.7412227, -2.7412227, -4.6870546, -4.68…
$ nearest_bus_dist_TV          &lt;dbl&gt; -0.5611478, -0.5611478, 0.9748921, 0.9748…
$ nearest_mrt_dist_TV          &lt;dbl&gt; -24.7189559, -24.7189559, -4.9420917, -4.…
$ nearest_childcare_dist_TV    &lt;dbl&gt; -8.7328859, -8.7328859, -3.1901640, -3.19…
$ nearest_eldercare_dist_TV    &lt;dbl&gt; 3.9541098, 3.9541098, 2.4444457, 2.444445…
$ supermarket_pts_count_TV     &lt;dbl&gt; -2.8313865, -2.8313865, -2.2223846, -2.22…
$ hawker_pts_count_TV          &lt;dbl&gt; 6.8121700, 6.8121700, 0.3248104, 0.324810…
$ mrt_pts_count_TV             &lt;dbl&gt; -2.1813624, -2.1813624, 4.0276600, 4.0276…
$ gym_pts_count_TV             &lt;dbl&gt; 3.7171044, 3.7171044, 4.8589769, 4.858976…
$ park_pts_count_TV            &lt;dbl&gt; 12.4489354, 12.4489354, 0.9160302, 0.9160…
$ eldercare_pts_count_TV       &lt;dbl&gt; -3.50185240, -3.50185240, 2.06150343, 2.0…
$ chas_pts_count_TV            &lt;dbl&gt; 1.5199517, 1.5199517, -2.0200730, -2.0200…
$ bus_pts_count_TV             &lt;dbl&gt; 6.9736211, 6.9736211, -2.4567766, -2.4567…
$ Local_R2                     &lt;dbl&gt; 0.9644450, 0.9644450, 0.9685204, 0.968520…
$ geometry                     &lt;POLYGON [m]&gt; POLYGON ((31667.83 31778.89..., P…</code></pre>
</div>
</div>
<p>We now visualize Local R2 by URA planning regions from the <code>mpsz</code> data-frame as per the Urban Redevelopment Auuthority Master Plan.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Central Region</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">West Region</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false">East Region</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false">North-Eastern Region</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-5" role="tab" aria-controls="tabset-14-5" aria-selected="false">North Region</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'plot'</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz[mpsz<span class="sc">$</span>REGION_N<span class="sc">==</span><span class="st">"CENTRAL REGION"</span>, ])<span class="sc">+</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale.sf.adaptive) <span class="sc">+</span> </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"Local_R2"</span>,</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.15</span>,</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.col =</span> <span class="st">"gray60"</span>,</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz[mpsz<span class="sc">$</span>REGION_N<span class="sc">==</span><span class="st">"WEST REGION"</span>, ])<span class="sc">+</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale.sf.adaptive) <span class="sc">+</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"Local_R2"</span>,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.15</span>,</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.col =</span> <span class="st">"gray60"</span>,</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz[mpsz<span class="sc">$</span>REGION_N<span class="sc">==</span><span class="st">"EAST REGION"</span>, ])<span class="sc">+</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale.sf.adaptive) <span class="sc">+</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"Local_R2"</span>,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.15</span>,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.col =</span> <span class="st">"gray60"</span>,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz[mpsz<span class="sc">$</span>REGION_N<span class="sc">==</span><span class="st">"NORTH-EAST REGION"</span>, ])<span class="sc">+</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale.sf.adaptive) <span class="sc">+</span> </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"Local_R2"</span>,</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.15</span>,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.col =</span> <span class="st">"gray60"</span>,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-14-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(mpsz[mpsz<span class="sc">$</span>REGION_N<span class="sc">==</span><span class="st">"NORTH REGION"</span>, ])<span class="sc">+</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()<span class="sc">+</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(hdb_resale.sf.adaptive) <span class="sc">+</span> </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="at">col =</span> <span class="st">"Local_R2"</span>,</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fl">0.15</span>,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.col =</span> <span class="st">"gray60"</span>,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">border.lwd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="insights-box">
<p>Local R²: Values range from 0.0 to 1.0 and indicate the goodness-of-fit of the local regression model. Low Local R² values signal poor model performance in those regions. Mapping these values can help identify areas where the Geographically Weighted Regression (GWR) model is performing well and where it is underperforming, potentially highlighting missing or unaccounted-for variables.</p>
</div>
</section>
</section>
</section>
<section id="predictive-model--hedonic" class="level2">
<h2 class="anchored" data-anchor-id="predictive-model--hedonic">3.4.3 Predictive Model- Hedonic</h2>
<p>Choosing to calibrate a random forest can be beneficial for several reasons.</p>
<p><strong>Random Forest</strong> models are often better than a <strong>hedonic pricing model</strong> for predictive tasks because it:</p>
<ol type="1">
<li><strong>Captures non-linear relationships</strong> and <strong>complex interactions</strong> without assuming linearity.</li>
<li><strong>Handles high-dimensional data</strong> effectively, making use of many predictors without requiring extensive variable selection.</li>
<li><strong>Resists outliers and noise</strong>, offering more robust predictions.</li>
<li><strong>Provides higher predictive accuracy</strong> by adapting to varied patterns across data.</li>
<li><strong>Offers feature importance insights</strong>, helping identify key factors influencing prices.</li>
</ol>
<p>Random Forest excels in accuracy and flexibility, making it well-suited for complex real estate pricing predictions, like the one we are attempting to do now.</p>
<section id="data-sampling" class="level3">
<h3 class="anchored" data-anchor-id="data-sampling">3.4.3.1 Data Sampling</h3>
<p>The entire data-set is split into training and test data sets with 65% and 35% respectively by using the initial_split() function of the rsample package.</p>
<p>The first step is to ensure that there are no overlapping point features. To do this we first implement the st_jitter() function of the sf package. The st_centroid() function is used to convert the polygon geometries to point form.</p>
<p>After splitting the data, we will store them as RDS files. We use the write_rds() function to create the RDS file and the read_rds() function to load the RDS file into our environment. This facilitates computational efficiency.</p>
<p>Additionally, we implement the sample_n() function of the dplyr package to take a sample of 3000 observations for the training data and 1500 observations for test data. This is done as having too many observations can result in hours, sometimes more, of time taken for every computation.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">Data Sampling</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-3" role="tab" aria-controls="tabset-15-3" aria-selected="false">Reading RDS Files</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 2023</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>resale_2023<span class="ot">=</span>resale_2023<span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_jitter</span>(<span class="at">amount=</span><span class="dv">10</span>)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2024</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>resale_2024<span class="ot">=</span>resale_2024<span class="sc">%&gt;%</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_jitter</span>(<span class="at">amount=</span><span class="dv">10</span>)</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating traing and test splits to calibrate models</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>resale_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(resale_2023, </span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prop =</span> <span class="fl">6.5</span><span class="sc">/</span><span class="dv">10</span>,)</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(resale_split)<span class="sc">%&gt;%</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">3000</span>)</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(resale_split)<span class="sc">%&gt;%</span></span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">1500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(train_data, <span class="st">"data/train_data.rds"</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(test_data, <span class="st">"data/test_data.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-15-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>train_data<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/train_data.rds'</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>test_data<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/test_data.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="model-calibration" class="level3">
<h3 class="anchored" data-anchor-id="model-calibration">3.4.3.2 Model Calibration</h3>
<p>We start off by converting <code>train_data</code> to a Spatial object by using the as_Spatial() function of the sf package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>train_data_sp <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(train_data)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>train_data_sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatialPointsDataFrame 
features    : 3000 
extent      : 11806.39, 45091.62, 28105.89, 48685.26  (xmin, xmax, ymin, ymax)
crs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
variables   : 22
names       : total_remaining_lease, storey_scale, resale_price, floor_area_sqm, nearest_gym_dist, nearest_kindergarten_dist, nearest_park_dist, nearest_chas_dist, nearest_cbd_dist, nearest_bus_dist, nearest_mrt_dist, nearest_childcare_dist, nearest_eldercare_dist, childcare_pts_count, supermarket_pts_count, ... 
min values  :                   505,            1,       280000,             52,                0,                         0,                 0,                 0,                0,                0,                0,                      0,                      0,                   0,                     0, ... 
max values  :                  1145,           16,      1420000,            149, 4274.65530320218,          2936.75322689975,   2211.7822280043,  2460.60405424514, 16990.5482125422,  174.19136717161, 3292.27569241822,       3044.64644345737,       4512.50732134225,                  43,                     8, ... </code></pre>
</div>
</div>
<p>As earlier, we will now compute the <strong>adaptive</strong> bandwidth using the bw.gwr() function.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive<span class="ot">=</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>train_data_sp,</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">approach =</span> <span class="st">'CV'</span>,</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">kernel =</span> <span class="st">'gaussian'</span>,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">adaptive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Create RDS File</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bw_adaptive, <span class="st">'data/rds/bw_adapt_rf.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>bw_adaptive<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/bw_adapt_rf.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>From the above, we infer that the optimal bandwidth that we must use to create this model is 61.</p>
<div class="insights-box">
<p><code>The bw.gwr()</code> function aims to find the best bandwidth that minimizes a specified criterion, such as AIC or CV, balancing the model’s bias and variance.</p>
<p>The bandwidth controls how much data around each location is included in its local model, impacting the “localized” nature of GWR.</p>
</div>
<p>We repeat the same step for <code>test_data</code>, in that we convert it to a spatial object as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>test_data_sp <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_Spatial</span>()</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>test_data_sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatialPointsDataFrame 
features    : 1500 
extent      : 11808.88, 42477.98, 28249.29, 48666.74  (xmin, xmax, ymin, ymax)
crs         : +proj=tmerc +lat_0=1.36666666666667 +lon_0=103.833333333333 +k=1 +x_0=28001.642 +y_0=38744.572 +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs 
variables   : 22
names       : total_remaining_lease, storey_scale, resale_price, floor_area_sqm, nearest_gym_dist, nearest_kindergarten_dist, nearest_park_dist, nearest_chas_dist, nearest_cbd_dist, nearest_bus_dist, nearest_mrt_dist, nearest_childcare_dist, nearest_eldercare_dist, childcare_pts_count, supermarket_pts_count, ... 
min values  :                   509,            1,       267000,             55,                0,                         0,                 0,                 0,                0,                0,                0,                      0,                      0,                   0,                     0, ... 
max values  :                  1143,           14,      1450000,            150, 4145.60222154281,          879.662705184524,  2188.63830813697,  608.340264684751, 15332.7372563399, 177.451358774972, 1952.48652213867,       970.401743304144,       3061.57003199835,                  43,                     7, ... </code></pre>
</div>
</div>
<p>Now that we have done the above steps, we can calibrate the model.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">Training Data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Test data</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-3" role="tab" aria-controls="tabset-17-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive <span class="ot">&lt;-</span> <span class="fu">gwr.basic</span>(<span class="at">formula =</span>resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">data=</span>train_data_sp,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">bw=</span>bw_adaptive, </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr_adaptive, <span class="st">'data/rds/gwr_adapt_hed.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-17-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>gwr_adaptive<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/gwr_adapt_hed.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-3" role="tab" aria-controls="tabset-18-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>gwr_bw_test_adaptive <span class="ot">&lt;-</span> <span class="fu">bw.gwr</span>(resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>test_data_sp,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">approach=</span><span class="st">"CV"</span>,</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">kernel=</span><span class="st">"gaussian"</span>,</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">adaptive=</span><span class="cn">TRUE</span>,</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">longlat=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr_bw_test_adaptive, <span class="st">'data/rds/gwr_bw_test_hed.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-18-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>gwr_bw_test_adaptive<span class="ot">=</span> <span class="fu">read_rds</span>(<span class="st">'data/rds/gwr_bw_test_hed.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="prediction" class="level3">
<h3 class="anchored" data-anchor-id="prediction">3.4.3.3 Prediction</h3>
<p>To compute the predicted values using <code>test_data</code>, we implement the gwr.predict() function.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-3" role="tab" aria-controls="tabset-20-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>gwr_pred <span class="ot">&lt;-</span> <span class="fu">gwr.predict</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data=</span>train_data_sp, </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">predictdata =</span> test_data_sp, </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">bw=</span> <span class="dv">50</span>, </span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">kernel =</span> <span class="st">'gaussian'</span>, </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">adaptive=</span><span class="cn">TRUE</span>, </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">longlat =</span> <span class="cn">FALSE</span>,</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">theta =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwr_pred, <span class="st">'data/gwr_pred.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-20-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>gwr_pred<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/gwr_pred.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>We can view the model output using the below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>gwr_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ***********************************************************************
   *                       Package   GWmodel                             *
   ***********************************************************************
   Program starts at: 2024-11-09 14:33:17.721381 
   Call:
   gwr.predict(formula = resale_price ~ total_remaining_lease + 
    storey_scale + floor_area_sqm + nearest_kindergarten_dist + 
    nearest_park_dist + nearest_chas_dist + nearest_cbd_dist + 
    nearest_mrt_dist + nearest_bus_dist + nearest_childcare_dist + 
    nearest_eldercare_dist + supermarket_pts_count + hawker_pts_count + 
    mrt_pts_count + gym_pts_count + park_pts_count + eldercare_pts_count + 
    chas_pts_count + bus_pts_count, data = train_data_sp, predictdata = test_data_sp, 
    bw = 50, kernel = "gaussian", adaptive = TRUE, theta = 0, 
    longlat = FALSE)

   Dependent (y) variable for prediction:  resale_price
   Independent variables:  total_remaining_lease storey_scale floor_area_sqm nearest_kindergarten_dist nearest_park_dist nearest_chas_dist nearest_cbd_dist nearest_mrt_dist nearest_bus_dist nearest_childcare_dist nearest_eldercare_dist supermarket_pts_count hawker_pts_count mrt_pts_count gym_pts_count park_pts_count eldercare_pts_count chas_pts_count bus_pts_count
   Number of data points: 3000
   ***********************************************************************
   *     Results of Geographically Weighted Regression for prediction    *
   ***********************************************************************

   *********************Model calibration information*********************
   Kernel function: gaussian 
   Adaptive bandwidth: 50 (number of nearest neighbours)
   Distance metric: Euclidean distance metric is used.

   ****************Summary of GWR coefficient estimates:******************
                                         Min.     1st Qu.      Median
   Intercept_coef                 -2.0919e+06 -4.1781e+05 -2.8612e+05
   total_remaining_lease_coef      1.9939e+02  3.6976e+02  5.0112e+02
   storey_scale_coef               6.4057e+03  1.0227e+04  1.1919e+04
   floor_area_sqm_coef             3.3364e+03  4.5187e+03  5.0988e+03
   nearest_kindergarten_dist_coef -1.8542e+02 -3.5129e+01 -1.0025e+01
   nearest_park_dist_coef         -1.0631e+02 -3.2758e+01 -1.3571e+01
   nearest_chas_dist_coef         -4.6494e+02 -1.0122e+02 -2.2447e+01
   nearest_cbd_dist_coef          -1.1246e+02 -2.4402e+01 -1.1158e+01
   nearest_mrt_dist_coef          -2.2663e+02 -7.7898e+01 -4.9734e+01
   nearest_bus_dist_coef          -1.6966e+03 -2.1588e+02  5.1462e+01
   nearest_childcare_dist_coef    -2.4118e+02 -6.6242e+01 -1.5857e+01
   nearest_eldercare_dist_coef    -2.1010e+02 -2.3819e+01 -5.4262e+00
   supermarket_pts_count_coef     -1.5590e+04  1.1165e+02  3.5320e+03
   hawker_pts_count_coef          -3.7589e+04 -8.7825e+03  3.2213e+03
   mrt_pts_count_coef             -3.1371e+04 -3.1349e+03  1.8799e+03
   gym_pts_count_coef             -3.0872e+05 -3.3369e+03  4.7611e+03
   park_pts_count_coef            -2.0606e+04 -6.4313e+03 -2.6895e+03
   eldercare_pts_count_coef       -1.2556e+05 -1.2930e+04 -6.3623e+03
   chas_pts_count_coef            -1.2793e+04 -1.7865e+03  8.9321e+02
   bus_pts_count_coef             -7.9513e+03 -2.1269e+03  9.6054e+02
                                      3rd Qu.       Max.
   Intercept_coef                 -1.1792e+05 972747.375
   total_remaining_lease_coef      5.7667e+02    852.718
   storey_scale_coef               1.5032e+04  20810.001
   floor_area_sqm_coef             5.8987e+03   8081.898
   nearest_kindergarten_dist_coef  2.8120e+01    267.923
   nearest_park_dist_coef          1.2963e+01    138.520
   nearest_chas_dist_coef          8.7678e+01    608.332
   nearest_cbd_dist_coef          -1.1986e+00    103.184
   nearest_mrt_dist_coef          -2.3066e+01    178.262
   nearest_bus_dist_coef           3.1404e+02   4918.695
   nearest_childcare_dist_coef     2.6772e+01    180.473
   nearest_eldercare_dist_coef     1.1830e+01     79.032
   supermarket_pts_count_coef      8.8940e+03  23814.318
   hawker_pts_count_coef           1.4400e+04  60109.243
   mrt_pts_count_coef              5.9215e+03  28640.367
   gym_pts_count_coef              1.4091e+04  64320.818
   park_pts_count_coef             1.3492e+03  52536.323
   eldercare_pts_count_coef        1.8413e+03  41289.547
   chas_pts_count_coef             2.8521e+03   8746.064
   bus_pts_count_coef              3.5408e+03  21753.955

   ****************       Results of GW prediction       ******************
                        Min.    1st Qu.     Median    3rd Qu.       Max.
   prediction         243929     452382     557431     641486    1226903
   prediction_var 1655578859 1764276309 1818832214 1898710132 8982735994

   ***********************************************************************
   Program stops at: 2024-11-09 15:01:43.846285 </code></pre>
</div>
</div>
<p>The above output allows us to make several inferences.</p>
<p>We can infer each variable’s influence on resale price how it varies geographically, as shown by the range of the coefficient values.</p>
<ul>
<li>total_remaining_lease_coef: Positive across locations, suggesting that higher remaining lease durations consistently increase resale prices.</li>
<li>storey_scale_coef and floor_area_sqm_coef: Positive across all observations, indicating that higher floors and larger areas increase resale prices.</li>
<li>Distance to facilities and parks (e.g., kindergarten, park, MRT) often shows both positive and negative coefficients. For instance, nearest_mrt_dist_coef tends to be negative, implying that closer proximity to MRT stations generally increases property values, but there are locations where it has a positive coefficient as well.</li>
<li>Points of Interest (POI) Counts: Some POIs (e.g., supermarkets, hawkers, MRT stations) show mixed impacts, likely indicating that their effect on price varies with local context (positive in some areas and negative in others).</li>
</ul>
<p>The model predicts that the price would range between a minimum of SGD 243,929 SGD 1,226,903. The median price is just over SGD 550,000.</p>
<section id="calibrating-random-forest-model" class="level4">
<h4 class="anchored" data-anchor-id="calibrating-random-forest-model">3.4.4.3.1 Calibrating Random Forest Model</h4>
<p>We extract the coordinates for each of the following four data-frames: resale_2023, resale_2024, train_data, test_data.</p>
<p>The st_coordinates() function is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>coords_2023 <span class="ot">=</span> <span class="fu">st_coordinates</span>(resale_2023)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>coords_2024<span class="ot">=</span><span class="fu">st_coordinates</span>(resale_2024)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>coords_train <span class="ot">=</span> <span class="fu">st_coordinates</span>(train_data)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>coords_test <span class="ot">=</span> <span class="fu">st_coordinates</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After extracting the coordinates, we drop the geometry field from <code>train_data</code> first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will use the <a href="https://cran.r-project.org/web/packages/ranger/index.html"><strong>ranger</strong></a> package to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">ranger</span>(resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>train_data)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger(resale_price ~ total_remaining_lease + storey_scale +      floor_area_sqm + nearest_kindergarten_dist + nearest_park_dist +      nearest_chas_dist + nearest_cbd_dist + nearest_bus_dist +      nearest_mrt_dist + nearest_childcare_dist + nearest_eldercare_dist +      supermarket_pts_count + hawker_pts_count + mrt_pts_count +      gym_pts_count + park_pts_count + eldercare_pts_count + chas_pts_count +      bus_pts_count, data = train_data) 

Type:                             Regression 
Number of trees:                  500 
Sample size:                      3000 
Number of independent variables:  19 
Mtry:                             4 
Target node size:                 5 
Variable importance mode:         none 
Splitrule:                        variance 
OOB prediction error (MSE):       2639526031 
R squared (OOB):                  0.9029382 </code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="calibrating-geographical-random-forest-models" class="level1">
<h1>3.4.5 Calibrating Geographical Random Forest Models</h1>
<p>We now use the <a href="https://cran.r-project.org/web/packages/SpatialML/index.html">SpatialML</a>package to create a model that will allow us to calibrate a model to predict HDB resale price. Please follow the embedded link to learn more about the SpatialML package.</p>
<section id="calibrating-using-training-data" class="level2">
<h2 class="anchored" data-anchor-id="calibrating-using-training-data">3.4.5.1 Calibrating using training data</h2>
<p>The code chunk below is used to calibrate a geographic rand om forest model by using the&nbsp;<code>grf()</code>&nbsp;function of&nbsp;the <strong>SpatialML</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive <span class="ot">&lt;-</span> <span class="fu">grf</span>(<span class="at">formula =</span> resale_price <span class="sc">~</span> total_remaining_lease <span class="sc">+</span> storey_scale <span class="sc">+</span> floor_area_sqm  <span class="sc">+</span> nearest_kindergarten_dist <span class="sc">+</span> nearest_park_dist <span class="sc">+</span> nearest_chas_dist <span class="sc">+</span> nearest_cbd_dist <span class="sc">+</span> nearest_bus_dist <span class="sc">+</span> nearest_mrt_dist <span class="sc">+</span> nearest_childcare_dist <span class="sc">+</span> nearest_eldercare_dist <span class="sc">+</span> supermarket_pts_count <span class="sc">+</span> hawker_pts_count <span class="sc">+</span> mrt_pts_count <span class="sc">+</span> gym_pts_count <span class="sc">+</span> park_pts_count <span class="sc">+</span> eldercare_pts_count <span class="sc">+</span> chas_pts_count <span class="sc">+</span> bus_pts_count,</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">dframe=</span>train_data, </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">bw=</span><span class="dv">40</span>,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kernel=</span><span class="st">"adaptive"</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">coords=</span>coords_train)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_adaptive, <span class="st">"data/gwRF_adaptive.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>gwRF_adaptive<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/gwRF_adaptive.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="prediction-1" class="level1">
<h1>3.5 Prediction</h1>
<section id="predicting-using-test-data" class="level2">
<h2 class="anchored" data-anchor-id="predicting-using-test-data">3.5.1 Predicting using test data</h2>
<p>The code chunk below will be used to combine the test data with its corresponding coordinates data, and drop the geometry using the st_drop_geometry() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, coords_test) <span class="sc">%&gt;%</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now implement the&nbsp;<code>predict.grf()</code>&nbsp;function of the spatialML package to predict the resale value by using the test data and gwRF_adaptive model calibrated earlier.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true">Calibration</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-3" role="tab" aria-controls="tabset-21-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>gwRF_pred <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive, </span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>                           test_data, </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">local.w=</span><span class="dv">1</span>,</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">global.w=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_pred, <span class="st">"data/GRF_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-21-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>GRF_pred <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/GRF_pred.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="converting-the-output-into-a-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="converting-the-output-into-a-data-frame">3.5.1.2 Converting the output into a data-frame</h3>
<p>We implement the as.data.frame() function to convert <code>GRF_pred</code> to a data-frame as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>GRF_pred_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(GRF_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now use the <code>cbind()</code> function to append the predicted values onto the test_data data-frame for further work.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-3" role="tab" aria-controls="tabset-22-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>test_data_p <span class="ot">&lt;-</span> <span class="fu">cbind</span>(test_data, GRF_pred_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(test_data_p, <span class="st">"data/test_data_p.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-22-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>test_data_p<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/test_data_p.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="root-mean-square-error-rmse" class="level3">
<h3 class="anchored" data-anchor-id="root-mean-square-error-rmse">3.5.1.3 Root Mean Square Error (RMSE)</h3>
<p>The root mean square error (RMSE) allows us to measure how far the predicted values are from the observed values in a regression analysis.</p>
<p>In the code chunk below, the rmse() function of the Metrics package is used to compute the RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(test_data_p<span class="sc">$</span>resale_price,</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>     test_data_p<span class="sc">$</span>GRF_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 66847.04</code></pre>
</div>
</div>
<p>The RMSE value is relatively low and indicates good model performance. This must be compared with the upcoming model to determine how the model performs in comparison.</p>
</section>
<section id="visualizing-the-predicted-values" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-predicted-values">3.5.1.4 Visualizing the predicted values</h3>
<p>We create a scatterplot to visualise the actual resale price and the predicted resale price by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> test_data_p,</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> GRF_pred,</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="insights-box">
<p>A better predictive model would have the scattered points close to the diagonal line. The scatter plot can be also used to detect if any outliers in the model.</p>
</div>
</section>
</section>
<section id="july-to-september-2024-data" class="level2">
<h2 class="anchored" data-anchor-id="july-to-september-2024-data">3.5.2 July to September 2024 Data</h2>
<p>The code chunk below will be used to combine the test data with its corresponding coordinates data, and drop the geometry using the st_drop_geometry() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>resale_2024 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(resale_2024, coords_2024) <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now implement the&nbsp;<code>predict.grf()</code>&nbsp;function of the spatialML package to predict the resale value by using the test data and gwRF_adaptive model calibrated earlier.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true">Calibration</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-3" role="tab" aria-controls="tabset-23-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>gwRF_pred_2024 <span class="ot">&lt;-</span> <span class="fu">predict.grf</span>(gwRF_adaptive, </span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>                           resale_2024, </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x.var.name=</span><span class="st">"X"</span>,</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y.var.name=</span><span class="st">"Y"</span>, </span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">local.w=</span><span class="dv">1</span>,</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">global.w=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(gwRF_pred_2024, <span class="st">"data/GRF_pred_2024.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-23-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>GRF_pred_2024 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"data/GRF_pred_2024.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<section id="converting-the-output-into-a-data-frame-1" class="level3">
<h3 class="anchored" data-anchor-id="converting-the-output-into-a-data-frame-1">3.5.2.2 Converting the output into a data-frame</h3>
<p>We implement the as.data.frame() function to convert <code>GRF_pred</code> to a data-frame as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>GRF_pred_df_2024 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(GRF_pred_2024)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now use the <code>cbind()</code> function to append the predicted values onto the test_data data-frame for further work.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true">Computation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false">RDS File Creation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-3" role="tab" aria-controls="tabset-24-3" aria-selected="false">Reading RDS File</a></li></ul>
<div class="tab-content">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>resale_2024_p <span class="ot">&lt;-</span> <span class="fu">cbind</span>(resale_2024, GRF_pred_df_2024)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(resale_2024_p, <span class="st">"data/rds/resale_2024_p.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-24-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>resale_2024_p<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">'data/rds/resale_2024_p.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="root-mean-square-error-rmse-1" class="level3">
<h3 class="anchored" data-anchor-id="root-mean-square-error-rmse-1">3.5.2.3 Root Mean Square Error (RMSE)</h3>
<p>The root mean square error (RMSE) allows us to measure how far the predicted values are from the observed values in a regression analysis.</p>
<p>In the code chunk below, the rmse() function of the Metrics package is used to compute the RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(resale_2024_p<span class="sc">$</span>resale_price,</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>     resale_2024_p<span class="sc">$</span>GRF_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100955.9</code></pre>
</div>
</div>
<p>The RMSE is higher than it is for when this model was applied on the test data from 2023, indicating worse performance however the model is still highly viable as shown in the plot below.</p>
</section>
<section id="visualizing-the-predicted-values-1" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-predicted-values-1">3.5.2.4 Visualizing the predicted values</h3>
<p>We create a scatterplot to visualise the actual resale price and the predicted resale price by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> resale_2024_p,</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> GRF_pred_2024,</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> resale_price)) <span class="sc">+</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex03_files/figure-html/unnamed-chunk-130-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As mentioned earlier, a better model would have points scattered around the diagonal from the origin. That being said, we infer that our model performs well.</p>
</section>
</section>
</section>
<section id="model-comparison" class="level1">
<h1>3.6 Model Comparison</h1>
<p>Over this exercise, we created a few models in order to predict flat-resale prices. Each of them come with their own pros and cons.</p>
<p>We first compare the Hedonic Pricing Model and the Random Forest Model.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 52%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th>Hedonic Pricing Model</th>
<th>Random Forest</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Higher (Adjusted) R-Squared Value</td>
<td>Lower (Adjusted) R-Squared Value</td>
</tr>
<tr class="even">
<td>More observations used to calibrate model</td>
<td>Fewer observations used to calibrate model</td>
</tr>
<tr class="odd">
<td>Does not handle non-linear relationships effectively</td>
<td>Handles non-linear relationships effectively.</td>
</tr>
</tbody>
</table>
<p>When it comes down to choice of model, it is up to personal preference however when dealing with Spatial Data, it is recommended to incorporate Random Forest Modelling as it is better suited to deal with high-dimensional data and has the ability to not get impacted as much by outliers.</p>
<p>With regards to the Random Forest Model, we infer that the model performs better on the test data from 2023 compared to predicting prices for July to September 2024, however the model is viable in both cases, as shown by the plot in 3.5.1.4 and 3.5.2.4.</p>
<p>Flat prices lately have been trending differently to how they were over 2023 for several reasons.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>Test Data</th>
<th>July to September 2024</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lower RMSE at 66000</td>
<td>Higher RMSE at just over 100000</td>
</tr>
<tr class="even">
<td>Fewer Data Points to test with</td>
<td>More data points used</td>
</tr>
<tr class="odd">
<td>Same year as training data</td>
<td>Over half a year, minimum, later than training points used.</td>
</tr>
</tbody>
</table>
<p>There has been increasing demand for flats on the resale market due to a wide variety of reasons:</p>
<ul>
<li><p>The pandemic resulted in significant delays in Build-To-Order (BTO) projects, which has now caused a backlog of demand for new flats. Many buyers who were initially planning to purchase BTO flats changed their minds and have started to look to the resale market, driving up resale prices as a result due to increased demand.</p></li>
<li><p>Global supply chain disruptions and inflation have only gotten worse over the past year causing construction costs to rise. Key factors of production such as raw materials, labor, and shipping are all more expensive, which has affected both new developments and resale prices, as buyers account for the higher replacement cost of newer units.</p></li>
</ul>
<p>There are several other reasons that can be looked at such as more demand from foreign buyers as investment holds however the two reasons above are key in the trend we are seeing of late.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>