<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arjun Singh">
<meta name="dcterms.date" content="2024-09-30">

<title>Take Home Exercise 2- Discovering impacts of COVID-19 on Thailand tourism economy at the province level using spatial and spatio-temporal statistics – ISSS626-GAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1- Geospatial Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01b.html">
 <span class="dropdown-text">Hands-on Exercise 1 - Part 2- Choropleth Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02a.html">
 <span class="dropdown-text">Hands-on Exercise 2 - Part 1- 1st Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02b.html">
 <span class="dropdown-text">Hands-on Exercise 2 - Part 2- 2nd Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands On Exercise 3- Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands On Exercise 4- Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05a.html">
 <span class="dropdown-text">Hands On Exercise 5- Global Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05b.html">
 <span class="dropdown-text">Hands On Exercise 5- Part 2- Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands On Exercise 6- Geographical Segmentation with Spatially Constrained Clustering Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07.html">
 <span class="dropdown-text">Hands On Exercise 7- Geographically Weighted Explanatory Variables</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex01.html">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex2/Take-home_Ex02.html">
 <span class="dropdown-text">Take Home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In Class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex2/In-class_Ex2.html">
 <span class="dropdown-text">In Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex3/In-class_Ex3.html">
 <span class="dropdown-text">In Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex4/In-class_Ex4.html">
 <span class="dropdown-text">In Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex5/In-class_Ex5.html">
 <span class="dropdown-text">In Class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex6/In-class_Ex6.html">
 <span class="dropdown-text">In Class Exercise 6</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">2 Introduction</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">2.1 Objectives</a></li>
  <li><a href="#data-and-packages" id="toc-data-and-packages" class="nav-link" data-scroll-target="#data-and-packages">2.2 Data and Packages</a>
  <ul class="collapse">
  <li><a href="#importing-the-data" id="toc-importing-the-data" class="nav-link" data-scroll-target="#importing-the-data">2.1 Importing the data</a>
  <ul class="collapse">
  <li><a href="#importing-the-aspatial-data" id="toc-importing-the-aspatial-data" class="nav-link" data-scroll-target="#importing-the-aspatial-data">2.1.1 Importing the aspatial data</a></li>
  <li><a href="#importing-the-geospatial-data" id="toc-importing-the-geospatial-data" class="nav-link" data-scroll-target="#importing-the-geospatial-data">2.1.2 Importing the geospatial data</a></li>
  <li><a href="#performing-relational-join" id="toc-performing-relational-join" class="nav-link" data-scroll-target="#performing-relational-join">2.1.3 Performing relational join</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">2.3 Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#visualizing-regional-indicators" id="toc-visualizing-regional-indicators" class="nav-link" data-scroll-target="#visualizing-regional-indicators">2.3.1 Visualizing regional indicators</a>
  <ul class="collapse">
  <li><a href="#number-of-tourists" id="toc-number-of-tourists" class="nav-link" data-scroll-target="#number-of-tourists">2.3.1.1 Number of tourists</a></li>
  </ul></li>
  <li><a href="#total-rooms-booked" id="toc-total-rooms-booked" class="nav-link" data-scroll-target="#total-rooms-booked">Total Rooms Booked</a></li>
  </ul></li>
  <li><a href="#spatial-analysis" id="toc-spatial-analysis" class="nav-link" data-scroll-target="#spatial-analysis">2.4 Spatial Analysis</a>
  <ul class="collapse">
  <li><a href="#spatial-weights" id="toc-spatial-weights" class="nav-link" data-scroll-target="#spatial-weights">2.4.1 Spatial Weights</a>
  <ul class="collapse">
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">2.4.1.1 Computing Contiguity Spatial Weights</a></li>
  <li><a href="#visualizing-contiguity-spatial-weights" id="toc-visualizing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#visualizing-contiguity-spatial-weights">2.4.1.2 Visualizing Contiguity Spatial Weights</a></li>
  <li><a href="#computing-distance-based-neighbors" id="toc-computing-distance-based-neighbors" class="nav-link" data-scroll-target="#computing-distance-based-neighbors">2.4.1.3 Computing Distance Based Neighbors</a></li>
  <li><a href="#weights-based-on-inversed-distance-weighting-idw" id="toc-weights-based-on-inversed-distance-weighting-idw" class="nav-link" data-scroll-target="#weights-based-on-inversed-distance-weighting-idw">2.4.1.4 <strong>Weights based on Inversed Distance Weighting (IDW)</strong></a></li>
  <li><a href="#row-standardized-weights-matrix" id="toc-row-standardized-weights-matrix" class="nav-link" data-scroll-target="#row-standardized-weights-matrix">2.4.1.5 <strong>Row-Standardized Weights Matrix</strong></a></li>
  <li><a href="#application-of-spatial-weight-matrix" id="toc-application-of-spatial-weight-matrix" class="nav-link" data-scroll-target="#application-of-spatial-weight-matrix">2.4.1.6 Application of Spatial Weight Matrix</a></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation">2.4.2 Global Measures of Spatial Autocorrelation</a>
  <ul class="collapse">
  <li><a href="#spatial-correlogram" id="toc-spatial-correlogram" class="nav-link" data-scroll-target="#spatial-correlogram">2.4.2.3 Spatial Correlogram</a></li>
  </ul></li>
  <li><a href="#local-indicators-of-spatial-association" id="toc-local-indicators-of-spatial-association" class="nav-link" data-scroll-target="#local-indicators-of-spatial-association">2.4.3 Local Indicators of Spatial Association</a>
  <ul class="collapse">
  <li><a href="#computing-local-morans-i" id="toc-computing-local-morans-i" class="nav-link" data-scroll-target="#computing-local-morans-i">2.4.3.1 Computing Local Moran’s I</a></li>
  <li><a href="#creating-a-lisa-cluster-map" id="toc-creating-a-lisa-cluster-map" class="nav-link" data-scroll-target="#creating-a-lisa-cluster-map">2.4.3.2 Creating a LISA Cluster Map</a></li>
  <li><a href="#hot-and-cold-spot-analysis" id="toc-hot-and-cold-spot-analysis" class="nav-link" data-scroll-target="#hot-and-cold-spot-analysis">2.4.3.3 Hot and Cold Spot Analysis</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 2- Discovering impacts of COVID-19 on Thailand tourism economy at the province level using spatial and spatio-temporal statistics</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arjun Singh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 10, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>2 Introduction</h1>
<p>Tourism is one of Thailand’s largest industries, accounting for some 20% of the gross domestic product (GDP). In 2019, Thailand earned 90 billion US$ from domestic and international tourism, but the COVID-19 pandemic caused revenues to crash to 24 billion US$ in 2020.</p>
<p>The figure below shows the total revenue for the tourism sector from January 2019 until Feb 2023. The figure reveals that the revenue for the industry have been recovering gradually since September 2021.</p>
<p><img src="images/clipboard-378385426.png" class="img-fluid"></p>
<p>However, it is important to note that the tourism economy of Thailand is not evenly distributed- not all provinces make a lot of revenue.</p>
<p>Thailand has 77 provinces in total as shown on the map below. This map was sourced from <a href="https://en.wikipedia.org/wiki/Provinces_of_Thailand">Wikipedia</a>.</p>
<p><img src="images/clipboard-746665905.png" class="img-fluid"></p>
<p>The figure below reveals that the tourism economy of Thailand is carried by five provinces, namely Bangkok, Phuket, Chiang Mai, Sukhothai and Phetchaburi.</p>
<p><img src="images/clipboard-986836251.png" class="img-fluid"></p>
</section>
<section id="objectives" class="level1">
<h1>2.1 Objectives</h1>
<p>The objectives of this exercise are to understand:</p>
<ul>
<li><p>if the key indicators of the tourism economy of Thailand are independent from space and space and time.</p></li>
<li><p>If the tourism economy is indeed spatial and spatio-temporal dependent. If so, then we would like to detect where the clusters and outliers are, as well as the emerging hot spot/cold spot areas.</p></li>
</ul>
</section>
<section id="data-and-packages" class="level1">
<h1>2.2 Data and Packages</h1>
<p>The data used for this exercise are as follows:</p>
<ul>
<li><p><a href="https://www.kaggle.com/datasets/thaweewatboy/thailand-domestic-tourism-statistics">Thailand Domestic Tourism Statistics</a>&nbsp;which is sourced from Kaggle.&nbsp;</p>
<p><img src="images/Screenshot 2024-10-02 180644.png" class="img-fluid"></p></li>
<li><p><a href="https://data.humdata.org/dataset/cod-ab-tha?">Thailand - Subnational Administrative Boundaries</a> which is sourced from Humanitarian Data Exchange. We will use the data at the province level (i.e: ADM1).</p>
<p><img src="images/clipboard-3292985936.png" class="img-fluid"></p></li>
</ul>
<p>We will be focusing on various variables present in the Thailand Domestic Tourism Statistics dataset. The variables present in the dataset are as follows:</p>
<ul>
<li><p><code>no_tourist_all</code>&nbsp;The total number of domestic tourists who visited the province</p></li>
<li><p><code>no_tourist_foreign</code>&nbsp;The number of foreign tourists who visited the province</p></li>
<li><p><code>no_tourist_occupied</code>&nbsp;The total number of occupied hotel rooms in the province</p></li>
<li><p><code>no_tourist_thai</code>&nbsp;The number of Thai tourists who visited the province</p></li>
<li><p><code>occupancy_rate</code>&nbsp;The percentage of occupied travel accommodation in the province</p></li>
<li><p><code>net_profit_all</code>&nbsp;The net profit generated by the tourism industry in the province, in Thai Baht</p></li>
<li><p><code>net_profit_foreign</code>&nbsp;The net profit generated by foreign tourists in the province, in Thai Baht</p></li>
<li><p><code>net_profit_thai</code>&nbsp;The net profit generated by Thai tourists in the province, in Thai Baht</p></li>
</ul>
<p>The following packages are used:</p>
<ul>
<li><strong><code>sf</code></strong>: Provides simple features support for handling and analyzing spatial vector data in R.</li>
<li><strong><code>spdep</code></strong>: A package for spatial dependence and spatial regression analysis, particularly for handling spatial weights.</li>
<li><strong><code>tmap</code></strong>: A flexible visualization package for thematic maps, supporting both static and interactive mapping in R.</li>
<li><strong><code>tidyverse</code></strong>: A collection of R packages designed for data science, emphasizing data manipulation, visualization, and functional programming.</li>
<li><strong><code>knitr</code></strong>: A dynamic report generation tool in R, allowing for the integration of code, results, and narrative in reproducible documents.</li>
</ul>
<p>We now load these packages into our environment by using the p_load() function of the pacman package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spdep, tmap, tidyverse, knitr, plotly, Kendall, sfdep)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">'plot'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="importing-the-data" class="level2">
<h2 class="anchored" data-anchor-id="importing-the-data">2.1 Importing the data</h2>
<section id="importing-the-aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-aspatial-data">2.1.1 Importing the aspatial data</h3>
<p>We will now import the aspatial data by implementing the read_csv() function of the readr package as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tourists<span class="ot">=</span><span class="fu">read_csv</span>(<span class="st">'data/aspatial/thailand_domestic_tourism_2019_2023_ver2.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="ot">=</span> tourists<span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month=</span><span class="fu">month</span>(date))<span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year=</span><span class="fu">year</span>(date))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Summing the 'value' based on 'province_eng' and 'variable'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>summed_data <span class="ot">&lt;-</span> tourists <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_eng, province_eng, variable) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(summed_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  region_eng province_eng variable           total_value
  &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;                    &lt;dbl&gt;
1 central    Ang Thong    no_tourist_all        2293450 
2 central    Ang Thong    no_tourist_foreign      42073 
3 central    Ang Thong    no_tourist_stay        391465 
4 central    Ang Thong    no_tourist_thai       2251377 
5 central    Ang Thong    ratio_tourist_stay       1622.
6 central    Ang Thong    revenue_all        2556650000 </code></pre>
</div>
</div>
</section>
<section id="importing-the-geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-geospatial-data">2.1.2 Importing the geospatial data</h3>
<p>We now import the geospatial data using the st_read() function of the sf package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>province<span class="ot">=</span><span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/geospatial"</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">17</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex2\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>We now check the CRS information using the st_crs() function of the sf package and transform the EPSG code using the st_transform() function if it is not 32647, the EPSG code of Thailand.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Check CRS</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Transform CRS</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_transform</span>(province, <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 77 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
First 10 features:
   Shape_Leng Shape_Area                  ADM1_EN       ADM1_TH ADM1_PCODE
1    2.417227 0.13133873                  Bangkok  กรุงเทพมหานคร       TH10
2    1.695100 0.07926199             Samut Prakan    สมุทรปราการ       TH11
3    1.251111 0.05323766               Nonthaburi         นนทบุรี       TH12
4    1.884945 0.12698345             Pathum Thani        ปทุมธานี       TH13
5    3.041716 0.21393797 Phra Nakhon Si Ayutthaya พระนครศรีอยุธยา       TH14
6    1.739908 0.07920961                Ang Thong        อ่างทอง       TH15
7    5.693342 0.54578838                 Lop Buri          ลพบุรี       TH16
8    1.778326 0.06872655                Sing Buri         สิงห์บุรี       TH17
9    2.896316 0.20907828                 Chai Nat         ชัยนาท       TH18
10   4.766446 0.29208711                 Saraburi         สระบุรี       TH19
                         geometry
1  MULTIPOLYGON (((674339.8 15...
2  MULTIPOLYGON (((687139.8 15...
3  MULTIPOLYGON (((644817.9 15...
4  MULTIPOLYGON (((704086 1575...
5  MULTIPOLYGON (((662941.6 16...
6  MULTIPOLYGON (((643472.8 16...
7  MULTIPOLYGON (((751293.3 17...
8  MULTIPOLYGON (((647136.1 16...
9  MULTIPOLYGON (((620165.4 17...
10 MULTIPOLYGON (((757935.1 16...</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="performing-relational-join" class="level3">
<h3 class="anchored" data-anchor-id="performing-relational-join">2.1.3 Performing relational join</h3>
<p>After performing consistency checks, we notice that the provinces aren’t named correctly in our tourist data-set. We correct the names below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Nong Bua Lamphu"</span>, <span class="st">"Nong Bua Lam Phu"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Sisaket"</span>, <span class="st">"Si Sa Ket"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Phang Nga"</span>, <span class="st">"Phangnga"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Lopburi"</span>, <span class="st">"Lop Buri"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Chonburi"</span>, <span class="st">"Chon Buri"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Chainat"</span>, <span class="st">"Chai Nat"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Buriram"</span>, <span class="st">"Buri Ram"</span>, summed_data<span class="sc">$</span>province_eng)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>summed_data<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Prachinburi"</span>, <span class="st">"Prachin Buri"</span>, summed_data<span class="sc">$</span>province_eng)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now join the aspatial and geospatial data by using the left_join() function of the package as showing in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pro_tourism<span class="ot">=</span><span class="fu">left_join</span>(summed_data, province, <span class="at">by=</span> <span class="fu">c</span>(<span class="st">"province_eng"</span><span class="ot">=</span><span class="st">"ADM1_EN"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>2.3 Exploratory Data Analysis</h1>
<section id="visualizing-regional-indicators" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-regional-indicators">2.3.1 Visualizing regional indicators</h2>
<p>After successfully completing the relational join, we can now plot a choropleth map to visualize the tourism in each province in Thailand using various functions of the tmap package.</p>
<section id="number-of-tourists" class="level3">
<h3 class="anchored" data-anchor-id="number-of-tourists">2.3.1.1 Number of tourists</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Number of Foreign Tourists</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Number of Domestic Tourists</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">All tourists</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>We first take a look at the number of tourists, both foreign and domestic, across all provinces in Thailand.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tourist_foreign<span class="ot">=</span>pro_tourism<span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_foreign'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>tourist_foreign<span class="ot">=</span><span class="fu">st_as_sf</span>(tourist_foreign)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>tourist_foreign<span class="ot">=</span><span class="fu">st_as_sf</span>(tourist_foreign)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive basemap</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>basemap01 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(tourist_foreign) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span> <span class="st">'jenks'</span>)<span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>basemap01</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tourist_domestic<span class="ot">=</span>pro_tourism<span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_thai'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>tourist_domestic<span class="ot">=</span><span class="fu">st_as_sf</span>(tourist_domestic)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive basemap</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>basemap02 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(tourist_domestic) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>)<span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>basemap02</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tourist_all<span class="ot">=</span>pro_tourism<span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_all'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>tourist_all<span class="ot">=</span><span class="fu">st_as_sf</span>(tourist_all)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive basemap</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>basemap03 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(tourist_all) <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>)<span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.3</span>) </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>basemap03</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<section id="revenue" class="level4">
<h4 class="anchored" data-anchor-id="revenue">2.3.1.2 Revenue</h4>
<p>We now take a look at the revenue generated by foreign and domestic tourists in Thailand</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Revenue generated by Foreigners</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Revenue generated by Domestic Tourists</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Overall Profit</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>profit_foreigners<span class="ot">=</span>pro_tourism<span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_foreign'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>profit_foreigners<span class="ot">=</span><span class="fu">st_as_sf</span>(profit_foreigners)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive basemap</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>basemap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit_foreigners) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span> <span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>basemap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>profit_domestic<span class="ot">=</span>pro_tourism<span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_thai'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>profit_domestic<span class="ot">=</span><span class="fu">st_as_sf</span>(profit_domestic)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive basemap</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>basemap2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit_domestic) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>basemap2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>profit_all<span class="ot">=</span>pro_tourism<span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_all'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>profit_all<span class="ot">=</span><span class="fu">st_as_sf</span>(profit_all)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive basemap</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>basemap3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit_all) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span> <span class="st">'jenks'</span>)<span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)     </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive map</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>basemap3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Bangkok seems to be the most lucrative province overall.</p>
</section>
<section id="occupancy-rate-by-year.-the-impact-of-covid." class="level4">
<h4 class="anchored" data-anchor-id="occupancy-rate-by-year.-the-impact-of-covid.">2.3.1.3 Occupancy Rate by Year. The impact of Covid.</h4>
<p>We will now look at the occupancy rates, namely the ratio_tourist_stay variable. This is derived by the following formula:</p>
</section>
</section>
</section>
<section id="total-rooms-booked" class="level2">
<h2 class="anchored" data-anchor-id="total-rooms-booked">Total Rooms Booked</h2>
<p>Total Rooms Available</p>
<p>We do this year by year.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">2019</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">2020</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">2021</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">2022</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Nong Bua Lamphu"</span>, <span class="st">"Nong Bua Lam Phu"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Sisaket"</span>, <span class="st">"Si Sa Ket"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Phang Nga"</span>, <span class="st">"Phangnga"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Lopburi"</span>, <span class="st">"Lop Buri"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Chonburi"</span>, <span class="st">"Chon Buri"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Chainat"</span>, <span class="st">"Chai Nat"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Buriram"</span>, <span class="st">"Buri Ram"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Prachinburi"</span>, <span class="st">"Prachin Buri"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>occupancy_2019_avg <span class="ot">=</span>tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2019</span>, variable <span class="sc">==</span> <span class="st">'ratio_tourist_stay'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng) <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_occupancy =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>occupancy_2019_avg<span class="ot">=</span><span class="fu">left_join</span>(occupancy_2019_avg, province, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'province_eng'</span><span class="ot">=</span><span class="st">'ADM1_EN'</span>))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>occupancy_2019_avg<span class="ot">=</span><span class="fu">st_as_sf</span>(occupancy_2019_avg)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(occupancy_2019_avg) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"avg_occupancy"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2020 data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>occupancy_2020_avg <span class="ot">=</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2020</span>, variable <span class="sc">==</span> <span class="st">'ratio_tourist_stay'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_occupancy =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>occupancy_2020_avg <span class="ot">=</span> <span class="fu">left_join</span>(occupancy_2020_avg, province, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'province_eng'</span> <span class="ot">=</span> <span class="st">'ADM1_EN'</span>))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>occupancy_2020_avg <span class="ot">=</span> <span class="fu">st_as_sf</span>(occupancy_2020_avg)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(occupancy_2020_avg) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"avg_occupancy"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style =</span> <span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2021 data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>occupancy_2021_avg <span class="ot">=</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>, variable <span class="sc">==</span> <span class="st">'ratio_tourist_stay'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_occupancy =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>occupancy_2021_avg <span class="ot">=</span> <span class="fu">left_join</span>(occupancy_2021_avg, province, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'province_eng'</span> <span class="ot">=</span> <span class="st">'ADM1_EN'</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>occupancy_2021_avg <span class="ot">=</span> <span class="fu">st_as_sf</span>(occupancy_2021_avg)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(occupancy_2021_avg) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"avg_occupancy"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style =</span> <span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2022 data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>occupancy_2022_avg <span class="ot">=</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2022</span>, variable <span class="sc">==</span> <span class="st">'ratio_tourist_stay'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_occupancy =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>occupancy_2022_avg <span class="ot">=</span> <span class="fu">left_join</span>(occupancy_2022_avg, province, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'province_eng'</span> <span class="ot">=</span> <span class="st">'ADM1_EN'</span>))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>occupancy_2022_avg <span class="ot">=</span> <span class="fu">st_as_sf</span>(occupancy_2022_avg)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(occupancy_2022_avg) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"avg_occupancy"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style =</span> <span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We immediately see a big difference based on the year. There was a far lesser occupancy rate during the covid years as we can see from the above choropleth maps.</p>
<p>Occupancy rates peaked in 2019 and dropped in 2020 and 2021. The occupancy rate has started to rebound and return to higher levels in ‘post-covid’.</p>
<section id="seasonal-data" class="level4">
<h4 class="anchored" data-anchor-id="seasonal-data">2.3.1.4 Seasonal Data</h4>
<section id="number-of-tourists-by-season" class="level5">
<h5 class="anchored" data-anchor-id="number-of-tourists-by-season">2.3.1.4.1 Number of tourists by season</h5>
<p>We will now analyse how revenue is distributed based on the month of the year.</p>
<p>For this, we first aggregate data based on certain features such as holiday periods and seasons.</p>
<p>We determine that there are three distinct seasons in Thailand from the [‘UK Meteorological Office’](https://www.metoffice.gov.uk/weather/travel/holiday-weather/asia/thailand#:~:text=Part%20of%20Thailand’s%20appeal%20is,season%20(March%20to%20May).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Nong Bua Lamphu"</span>, <span class="st">"Nong Bua Lam Phu"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Sisaket"</span>, <span class="st">"Si Sa Ket"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Phang Nga"</span>, <span class="st">"Phangnga"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Lopburi"</span>, <span class="st">"Lop Buri"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Chonburi"</span>, <span class="st">"Chon Buri"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Chainat"</span>, <span class="st">"Chai Nat"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Buriram"</span>, <span class="st">"Buri Ram"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>tourists_temporal<span class="sc">$</span>province_eng <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"Prachinburi"</span>, <span class="st">"Prachin Buri"</span>, tourists_temporal<span class="sc">$</span>province_eng)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming your dataset is called 'tourists_temporal' and has a 'month' column</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>tourists_temporal <span class="ot">&lt;-</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>) <span class="sc">~</span> <span class="st">"Wet Season"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Cool Season"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="st">"Hot Season"</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tourists_temporal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  date       province_thai province_eng    region_thai region_eng variable value
  &lt;date&gt;     &lt;chr&gt;         &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;
1 2019-01-01 กรุงเทพมหานคร  Bangkok         ภาคกลาง     central    ratio_t…  93.4
2 2019-01-01 ลพบุรี          Lop Buri        ภาคกลาง     central    ratio_t…  61.3
3 2019-01-01 พระนครศรีอยุธยา Phra Nakhon Si… ภาคกลาง     central    ratio_t…  73.4
4 2019-01-01 สระบุรี         Saraburi        ภาคกลาง     central    ratio_t…  67.3
5 2019-01-01 ชัยนาท         Chai Nat        ภาคกลาง     central    ratio_t…  79.3
6 2019-01-01 นครปฐม        Nakhon Pathom   ภาคกลาง     central    ratio_t…  71.7
# ℹ 3 more variables: month &lt;dbl&gt;, year &lt;dbl&gt;, season &lt;chr&gt;</code></pre>
</div>
</div>
<p>We now join tourists_temporal df to the province df create separate data-frames for each.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate data frames for each season</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>wet_season_df <span class="ot">&lt;-</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"Wet Season"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>cool_season_df <span class="ot">&lt;-</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"Cool Season"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>hot_season_df <span class="ot">&lt;-</span> tourists_temporal <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"Hot Season"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now sum the values using the group_by() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtaining aggregates</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>wet_sum<span class="ot">=</span> wet_season_df <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng, variable) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># JOINING DF TO THE PROVINCE DF</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>wet_sum<span class="ot">=</span><span class="fu">left_join</span>(wet_sum, province, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'province_eng'</span><span class="ot">=</span><span class="st">'ADM1_EN'</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtaining Aggregates</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>cool_sum<span class="ot">=</span> cool_season_df <span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng, variable) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Joining to province df</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>cool_sum<span class="ot">=</span> <span class="fu">left_join</span>(cool_sum, province, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'province_eng'</span><span class="ot">=</span><span class="st">'ADM1_EN'</span>))</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtaining Aggregates</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>hot_sum<span class="ot">=</span> hot_season_df <span class="sc">%&gt;%</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_eng, variable) <span class="sc">%&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Joining to province df</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>hot_sum<span class="ot">=</span><span class="fu">left_join</span>(hot_sum, province, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'province_eng'</span><span class="ot">=</span><span class="st">'ADM1_EN'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now create choropleth maps for each by implementing functions of the tmap packages.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Wet Season</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Hot season</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Cool season</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>wet_sum<span class="ot">=</span><span class="fu">st_as_sf</span>(wet_sum)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>wet_tourism_foreign<span class="ot">=</span>wet_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_foreign'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>wet_tourism_thai<span class="ot">=</span> wet_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_thai'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the basemap</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>basemap11 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(wet_tourism_foreign) <span class="sc">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>basemap12<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(wet_tourism_thai) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap11, basemap12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are far more domestic travellers in the rainy season compared to foreign travellers.</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>hot_sum<span class="ot">=</span><span class="fu">st_as_sf</span>(hot_sum)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>hot_tourism_foreign<span class="ot">=</span>hot_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_foreign'</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>hot_tourism_thai<span class="ot">=</span> hot_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_thai'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the basemap</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>basemap13 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(hot_tourism_foreign) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>basemap14<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(hot_tourism_thai) <span class="sc">+</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap13, basemap14)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cool_sum<span class="ot">=</span><span class="fu">st_as_sf</span>(cool_sum)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>cool_tourism_foreign<span class="ot">=</span>cool_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_foreign'</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>cool_tourism_thai<span class="ot">=</span> cool_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'no_tourist_thai'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the basemap</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>basemap15 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(cool_tourism_foreign) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>basemap16<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(cool_tourism_thai) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'jenks'</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap15, basemap16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We see clear differences in number of tourists across regions based on the season, indicating to us that tourism is not independent from temporal factors such as time of the year.</p>
</section>
<section id="profit-from-tourists-by-season" class="level5">
<h5 class="anchored" data-anchor-id="profit-from-tourists-by-season">2.3.1.4.2 Profit from tourists by season</h5>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Wet Season</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Hot season</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Cool Season</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>wet_sum<span class="ot">=</span><span class="fu">st_as_sf</span>(wet_sum)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>wet_profit_foreign<span class="ot">=</span>wet_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_foreign'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>wet_profit_thai<span class="ot">=</span> wet_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_thai'</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the basemap</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>basemap21 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(wet_profit_foreign) <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>basemap22<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(wet_profit_thai) <span class="sc">+</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap21, basemap22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>hot_sum<span class="ot">=</span><span class="fu">st_as_sf</span>(hot_sum)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>hot_profit_foreign<span class="ot">=</span>hot_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_foreign'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>hot_profit_thai<span class="ot">=</span> hot_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_thai'</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the basemap</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>basemap23 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(hot_profit_foreign) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>basemap24<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(hot_profit_thai) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap23, basemap24)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cool_sum<span class="ot">=</span><span class="fu">st_as_sf</span>(cool_sum)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>cool_profit_foreign<span class="ot">=</span>cool_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_foreign'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>cool_profit_thai<span class="ot">=</span> cool_sum<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_thai'</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the basemap</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>basemap25 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(cool_profit_foreign) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>basemap26<span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(cool_profit_thai) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"total_value"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">style=</span><span class="st">'quantile'</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"province_eng"</span>, <span class="at">size =</span> <span class="fl">0.5</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap25, basemap26)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We notice that while for the most part, there are significantly more domestic travellers, more profit is earned from foreign travellers throughout the year.</p>
<p>We infer from our above visualizations that tourism statistics are not independent from space and time. Both of these factors impact the different metrics significantly.</p>
</section>
</section>
</section>
</section>
<section id="spatial-analysis" class="level1">
<h1>2.4 Spatial Analysis</h1>
<p>We now implement the <strong>poly2nb()</strong> function of the <strong>spdep</strong> package to compute contiguity weight matrices for the study area selected.</p>
<p>Using this function, we are able to build a ‘neighbors list’ based on regions with contiguous boundaries.</p>
<p>In this function, we will pass an argument, ‘queen’, that can be set as either TRUE (default) or FALSE. If the ‘queen’ argument is not explicitly set to FALSE, the function returns a list of first order neighbors using the Queen criteria.</p>
<p><a href="https://cran.r-project.org/web/packages/spdep/spdep.pdf">You may refer to the <code>spdep</code> package documentation here</a> to learn more about its functions and arguments.</p>
<section id="spatial-weights" class="level2">
<h2 class="anchored" data-anchor-id="spatial-weights">2.4.1 Spatial Weights</h2>
<section id="computing-contiguity-spatial-weights" class="level3">
<h3 class="anchored" data-anchor-id="computing-contiguity-spatial-weights">2.4.1.1 Computing Contiguity Spatial Weights</h3>
<p>We use the poly2nb() function as shown in the code chunk below. Using this, we are able to compute a Queen contiguity weight matrix.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Profit from Foreigners</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Domestic Tourists (Profit)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Tourists (all)</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rook contiguity</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>wm_r <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(profit_foreigners, <span class="at">queen=</span><span class="cn">FALSE</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_r, <span class="st">'data/rds/wm_r_pro_foreign'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen Contiguity</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(profit_foreigners, <span class="at">queen=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_q, <span class="st">'data/rds/wm_q_pro_foreign'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Rook Contiguity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Queen Contiguity</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>wm_r_pro_foreign<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_r_pro_foreign"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_r_pro_foreign)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>wm_q_pro_foreign<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_q_pro_foreign"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q_pro_foreign)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p>We now repeat the same steps for Domestic tourists.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rook contiguity </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>wm_r <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(profit_domestic, <span class="at">queen=</span><span class="cn">FALSE</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_r, <span class="st">'data/rds/wm_r_pro_dom'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen Contiguity</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(profit_domestic, <span class="at">queen=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_q, <span class="st">'data/rds/wm_q_pro_dom'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now look at a summary of both using the code chunks below.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Rook Contiguity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Queen Contiguity</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>wm_r_pro_dom<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_r_pro_dom"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_r_pro_dom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>wm_q_pro_dom<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_q_pro_dom"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q_pro_dom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<p>We now check all tourists.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rook contiguity</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>wm_r <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(profit_all, <span class="at">queen=</span><span class="cn">FALSE</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_r, <span class="st">'data/rds/wm_r_pro_all'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Queen Contiguity</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(profit_all, <span class="at">queen=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(wm_q, <span class="st">'data/rds/wm_q_pro_all'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Rook Contiguity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Queen Contiguity</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>wm_r_pro_all<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_r_pro_all"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_r_pro_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>wm_q_pro_all<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/wm_q_pro_all"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q_pro_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
71 with 1 link
2 most connected regions:
17 69 with 9 links</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="visualizing-contiguity-spatial-weights" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-contiguity-spatial-weights">2.4.1.2 Visualizing Contiguity Spatial Weights</h3>
<p>A connectivity graph takes a point and displays a line to each neighboring point. We are working with polygons in this situation, so we need to ensure that our points are in order to produce our connectivity graphs.</p>
<p>Usually, the method of choice will be polygon centroids. We calculate using the sf package before moving onto the graphs. Getting latitude and longitude of the Polygon Centroids.</p>
<p>We need points to associate with each polygon before we can make our connectivity graph. It won’t be as simple as applying the st_centroid() function of the sf sf object: <em><code>us.bound</code></em>. We need the coordinates in a separate data-frame for this to work.</p>
<p>To do this, we will use a mapping function which will apply a given function to each element of a vector and returns a vector of the same length. Our input vector will be the geometry column of <code>us.bound</code>.</p>
<p>The function that we implement in this situation will be st_centroid().</p>
<p>We will be using the map_dbl variation of map from the purrr package.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Coordinates of Foreign Travellers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Coordinates of Domestic Travellers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">Coordinates for all travellers</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<p>We start by extracting the longitude and latitude values for foreign travellers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>longitude_profit_foreign<span class="ot">=</span> <span class="fu">map_dbl</span>(profit_foreigners<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>latitude_profit_foreign<span class="ot">=</span> <span class="fu">map_dbl</span>(profit_foreigners<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have the latitude and longitude values, we can use the cbind() function to put the longitude and latitude values into the same object,&nbsp;<code>coords</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>coords_profit_foreign <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude_profit_foreign, latitude_profit_foreign)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the head() function to verify if&nbsp;<code>coords</code>&nbsp;is in the correct format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords_profit_foreign)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     longitude_profit_foreign latitude_profit_foreign
[1,]                100.34851                14.62354
[2,]                100.62353                13.77183
[3,]                100.02748                15.13390
[4,]                 99.04668                14.58513
[5,]                100.90713                15.10760
[6,]                100.10312                13.92502</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>longitude_profit_domestic<span class="ot">=</span> <span class="fu">map_dbl</span>(profit_domestic<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>latitude_profit_domestic<span class="ot">=</span> <span class="fu">map_dbl</span>(profit_domestic<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have the latitude and longitude values, we can use the cbind() function to put the longitude and latitude values into the same object,&nbsp;<code>coords</code>. We now create the coords object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>coords_profit_domestic<span class="ot">=</span><span class="fu">cbind</span>(longitude_profit_domestic, latitude_profit_domestic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the head() function to verify if&nbsp;<code>coords</code>&nbsp;is in the correct format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords_profit_domestic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     longitude_profit_domestic latitude_profit_domestic
[1,]                  104.7414                 15.89261
[2,]                  100.3485                 14.62354
[3,]                  100.6235                 13.77183
[4,]                  103.7109                 18.14879
[5,]                  102.9567                 14.81998
[6,]                  101.4254                 13.60649</code></pre>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>longitude_profit_all<span class="ot">=</span> <span class="fu">map_dbl</span>(profit_all<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>latitude_profit_all<span class="ot">=</span> <span class="fu">map_dbl</span>(profit_all<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now create the coords object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>coords_profit_all <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude_profit_all, latitude_profit_all)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords_profit_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     longitude_profit_all latitude_profit_all
[1,]            100.34851            14.62354
[2,]            100.62353            13.77183
[3,]            100.02748            15.13390
[4,]             99.04668            14.58513
[5,]            100.90713            15.10760
[6,]            100.10312            13.92502</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We can now visualize it using the plot() function as shown in the following code chunks.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Profits from foreign travellers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Profits from domestic travellers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">Profits from all travellers</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_foreigners<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_r_pro_foreign, coords_profit_foreign, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_foreigners<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_q_pro_foreign, coords_profit_foreign, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_domestic<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_r_pro_dom, coords_profit_domestic, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_domestic<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_q_pro_dom, coords_profit_foreign, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_all<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_r_pro_all, coords_profit_all, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_all<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_q_pro_all, coords_profit_foreign, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"purple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="computing-distance-based-neighbors" class="level3">
<h3 class="anchored" data-anchor-id="computing-distance-based-neighbors">2.4.1.3 Computing Distance Based Neighbors</h3>
<p>In order to derive distance-based weight matrices, we will implement the <strong>dnearneigh()</strong> function of the <strong>spdep</strong> package.</p>
<p>This function identifies neighbors of region points by Euclidean Distance with a distance band with lower d1 and upper d2 bounds controlled by the <code>bounds=</code> argument.</p>
<p>If un-projected coordinates are used and either specified in the coordinates object x or with x as a two column matrix and <code>longlat=TRUE,</code> great circle distances in km will be calculated assuming the WGS84 reference ellipsoid.</p>
<section id="determining-cut-off-distance" class="level4">
<h4 class="anchored" data-anchor-id="determining-cut-off-distance">2.4.1.3.1 Determining cut-off distance</h4>
<p>We must first determine the upper limit for the distance band by using the steps shown below:</p>
<ul>
<li><p><strong>Find k Nearest Neighbours</strong>: Use <strong><code>knearneigh()</code></strong> from the <strong><code>spdep</code></strong> package to get a matrix of indices for the k nearest neighbours of each point.</p></li>
<li><p><strong>Convert to Neighbours List</strong>: Convert the <strong><code>knn</code></strong> object returned by <strong><code>knearneigh()</code></strong> into a neighbours list of class <strong><code>nb</code></strong> using <strong><code>knn2nb()</code></strong>. This list contains integer vectors with neighbour region number IDs.</p></li>
<li><p><strong>Calculate Edge Lengths</strong>: Use <strong><code>nbdists()</code></strong> from <strong><code>spdep</code></strong> to return the lengths of neighbour relationship edges. The function returns distances in the units of the coordinates if projected, otherwise in kilometers.</p></li>
<li><p><strong>Flatten the List</strong>: Remove the list structure of the returned object using <strong><code>unlist()</code></strong></p></li>
</ul>
<p>We focus on ALL travellers as opposed to singling out Foreign and/or Domestic travellers for the following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>k1_pro_all <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords_profit_all))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>k1dists_pro_all <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1_pro_all, coords_profit_all, <span class="at">longlat =</span> <span class="cn">TRUE</span>))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists_pro_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  21.55   51.92   64.33   63.24   76.77  110.94 </code></pre>
</div>
</div>
<div class="note-box">
<p>You could also do the below if you are interested in singling them out based on foreign and domestic travellers.</p>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Profits from foreign travellers</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Profits from domestic travellers</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>k1_pro_foreign <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords_profit_foreign))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>k1dists_pro_foreign <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1_pro_foreign, coords_profit_foreign, <span class="at">longlat =</span> <span class="cn">TRUE</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists_pro_foreign)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the output above, we can infer that the largest first nearest neighbor distance is just under 125KM. Using this value, 125KM, as the upper threshold gives certainty that all units will have at least one neighbor.</p>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>k1_pro_domestic <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords_profit_domestic))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>k1dists_pro_domestic <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1_pro_domestic, coords_profit_domestic, <span class="at">longlat =</span> <span class="cn">TRUE</span>))</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists_pro_domestic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="computing-distance-based-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="computing-distance-based-weight-matrix">2.4.1.3.2 Computing Distance Based Weight Matrix</h4>
<p>We now implement the dnearneigh() function to compute the distance weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>wm_d62_pro_all <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords_profit_all, <span class="dv">0</span>, <span class="dv">111</span>, <span class="at">longlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>wm_d62_pro_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 350 
Percentage nonzero weights: 5.903188 
Average number of links: 4.545455 
2 disjoint connected subgraphs</code></pre>
</div>
</div>
<div class="insights-box">
<p>From the output above, we infer that there are 69 distinct regions, as we identified earlier. There are 368 connections between regions where the distance is within the threshold that we have set. 7.73% of all possible region pairs have a connection. On average, each region is connected to approximately 5.3 other regions.</p>
</div>
<p>We now use the combination of table() and card() functions from the spdep package to display the structure of the weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(profit_all<span class="sc">$</span>province_eng, <span class="fu">card</span>(wm_d62_pro_all))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          
                           1 2 3 4 5 6 7 8 9 10 11 12 13 14
  Amnat Charoen            0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Ang Thong                0 0 0 0 0 0 0 0 0  0  1  0  0  0
  Bangkok                  0 0 0 0 0 0 0 0 0  0  0  1  0  0
  Bueng Kan                0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Buri Ram                 0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Chachoengsao             0 0 0 0 0 0 0 0 1  0  0  0  0  0
  Chai Nat                 0 0 0 0 0 0 1 0 0  0  0  0  0  0
  Chaiyaphum               0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Chanthaburi              0 0 0 0 1 0 0 0 0  0  0  0  0  0
  Chiang Mai               0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Chiang Rai               1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Chon Buri                0 0 0 0 0 1 0 0 0  0  0  0  0  0
  Chumphon                 1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Kalasin                  0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Kamphaeng Phet           0 0 0 0 1 0 0 0 0  0  0  0  0  0
  Kanchanaburi             0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Khon Kaen                0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Krabi                    0 0 0 0 1 0 0 0 0  0  0  0  0  0
  Lampang                  0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Lamphun                  0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Loei                     1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Lop Buri                 0 0 0 0 0 0 1 0 0  0  0  0  0  0
  Mae Hong Son             1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Maha Sarakham            0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Mukdahan                 0 0 0 0 1 0 0 0 0  0  0  0  0  0
  Nakhon Nayok             0 0 0 0 0 0 0 0 0  1  0  0  0  0
  Nakhon Pathom            0 0 0 0 0 0 0 0 0  1  0  0  0  0
  Nakhon Phanom            0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Nakhon Ratchasima        1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Nakhon Sawan             0 0 0 0 0 1 0 0 0  0  0  0  0  0
  Nakhon Si Thammarat      0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Nan                      0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Narathiwat               0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Nong Bua Lam Phu         0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Nong Khai                0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Nonthaburi               0 0 0 0 0 0 0 0 0  0  0  0  1  0
  Pathum Thani             0 0 0 0 0 0 0 0 0  0  0  0  0  1
  Pattani                  0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Phangnga                 0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Phatthalung              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Phayao                   0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Phetchabun               0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Phetchaburi              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Phichit                  0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Phitsanulok              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Phra Nakhon Si Ayutthaya 0 0 0 0 0 0 0 0 0  0  0  0  1  0
  Phrae                    0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Phuket                   0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Prachin Buri             0 0 0 0 0 1 0 0 0  0  0  0  0  0
  Prachuap Khiri Khan      1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Ranong                   0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Ratchaburi               0 0 0 0 1 0 0 0 0  0  0  0  0  0
  Rayong                   0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Roi Et                   0 0 0 0 1 0 0 0 0  0  0  0  0  0
  Sa Kaeo                  0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Sakon Nakhon             0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Samut Prakan             0 0 0 0 0 0 0 0 0  1  0  0  0  0
  Samut Sakhon             0 0 0 0 0 0 0 0 1  0  0  0  0  0
  Samut Songkhram          0 0 0 0 0 0 0 1 0  0  0  0  0  0
  Saraburi                 0 0 0 0 0 0 0 0 1  0  0  0  0  0
  Satun                    0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Si Sa Ket                0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Sing Buri                0 0 0 0 0 0 0 0 0  1  0  0  0  0
  Songkhla                 0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Sukhothai                0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Suphan Buri              0 0 0 0 0 0 0 0 1  0  0  0  0  0
  Surat Thani              0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Surin                    0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Tak                      1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Trang                    0 0 0 1 0 0 0 0 0  0  0  0  0  0
  Trat                     1 0 0 0 0 0 0 0 0  0  0  0  0  0
  Ubon Ratchathani         0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Udon Thani               0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Uthai Thani              0 0 0 0 0 1 0 0 0  0  0  0  0  0
  Uttaradit                0 0 1 0 0 0 0 0 0  0  0  0  0  0
  Yala                     0 1 0 0 0 0 0 0 0  0  0  0  0  0
  Yasothon                 0 0 1 0 0 0 0 0 0  0  0  0  0  0</code></pre>
</div>
</div>
<p>Next, we implement the n.comp.nb() function to identify the number of connected components in a neighbor list object of class nb.</p>
<div class="note-box">
<p>Note: A connected component is a subset of regions where each region is reachable from any other region within the same subset. The function returns an object that includes the number of connected components (<code>nc</code>) and a vector indicating the component membership for each region.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>n_comp_pro_all<span class="ot">&lt;-</span> <span class="fu">n.comp.nb</span>(wm_d62_pro_all)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>n_comp_pro_all<span class="sc">$</span>nc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(n_comp_pro_all<span class="sc">$</span>comp.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2 
63 14 </code></pre>
</div>
</div>
</section>
<section id="plotting-fixed-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="plotting-fixed-distance-weight-matrix">2.4.1.3.3 <strong>Plotting fixed distance weight matrix</strong></h4>
<p>We now plot the distance weight matrix using the plot() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_all<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d62_pro_all, coords_profit_all, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k1_pro_all, coords_profit_all, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"purple"</span>, <span class="at">length=</span><span class="fl">0.08</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As identified earlier, we see two distinct groups. The upper 63 and the bottom 14.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_all<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>, <span class="at">main=</span><span class="st">"1st nearest neighbours"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(k1_pro_all, coords_profit_foreign, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">length=</span><span class="fl">0.08</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(profit_all<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>, <span class="at">main=</span><span class="st">"Distance link"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_d62_pro_all, coords_profit_foreign, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="weights-based-on-inversed-distance-weighting-idw" class="level3">
<h3 class="anchored" data-anchor-id="weights-based-on-inversed-distance-weighting-idw">2.4.1.4 <strong>Weights based on Inversed Distance Weighting (IDW)</strong></h3>
<p>We first compute the distances between areas by implementing the&nbsp;<strong>nbdists()</strong>&nbsp;function of the&nbsp;<strong>spdep</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dist_pro_all <span class="ot">&lt;-</span> <span class="fu">nbdists</span>(wm_q_pro_all, coords_profit_all, <span class="at">longlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>ids_pro_all <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dist_pro_all, <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(x))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>ids_pro_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.004304527 0.001160634 0.001066433

[[2]]
[1] 0.012985433 0.001690876 0.002273629 0.001178524

[[3]]
[1] 0.007462489 0.001950621 0.001878392 0.004449595 0.004722243 0.002947391

[[4]]
[1] 0.001573833 0.001596968 0.004315842

[[5]]
[1] 0.015632633 0.003912968 0.004489280 0.007575615 0.001312962

[[6]]
[1] 0.007462489 0.008317161 0.014028638 0.003155141 0.004087449 0.002035937
[7] 0.003527405 0.002928580

[[7]]
[1] 0.003581885 0.002363964 0.001150661 0.001293117

[[8]]
[1] 0.009952248 0.018047546 0.003860230 0.003001429

[[9]]
[1] 0.008317161 0.015334899 0.001501404 0.002477496 0.002901933

[[10]]
[1] 0.003537334 0.007878212 0.004212708 0.007957349 0.001320848

[[11]]
[1] 0.003537334 0.003736228 0.001328590

[[12]]
[1] 0.014028638 0.015334899 0.001657611

[[13]]
[1] 0.001870586 0.001552262 0.001311196

[[14]]
[1] 0.006701583 0.006503928 0.004354774 0.001595340 0.003356687 0.002124330

[[15]]
[1] 0.002823347 0.001837465 0.001826891 0.001801133 0.001537177

[[16]]
[1] 0.002359220 0.006697566 0.001066427 0.001260504 0.001173126

[[17]]
[1] 0.015632633 0.009952248 0.006701583 0.004725908 0.003907719 0.003558587
[7] 0.003072110 0.002808776 0.002310335

[[18]]
[1] 0.002183596 0.002065176 0.001128192 0.001325482

[[19]]
[1] 0.007878212 0.003736228 0.009026604 0.002035029 0.001407667 0.001652236
[7] 0.001449637

[[20]]
[1] 0.004212708 0.009026604 0.001575009

[[21]]
[1] 0.004725908 0.002660170 0.001937480 0.003080049 0.002215115 0.002573408

[[22]]
[1] 0.012985433 0.018047546 0.004910079 0.004704466 0.003599849 0.001755660
[7] 0.002656938 0.002520896

[[23]]
[1] 0.007957349 0.001346034

[[24]]
[1] 0.003912968 0.006503928 0.003907719 0.001392161 0.001761791

[[25]]
[1] 0.004304527 0.004354774 0.001980272 0.001552070 0.002884652 0.001178221

[[26]]
[1] 0.003155141 0.003558711 0.003382780 0.001352479 0.001584017

[[27]]
[1] 0.0019506208 0.0023592196 0.0059364663 0.0013983663 0.0020314658
[6] 0.0017873918 0.0008895808

[[28]]
[1] 0.001573833 0.001980272 0.002410879

[[29]]
[1] 0.004489280 0.003860230 0.003558587 0.004910079 0.003558711 0.001870923
[7] 0.003963653 0.002028040

[[30]]
[1] 0.0035818850 0.0028233466 0.0047044657 0.0042667164 0.0052617025
[6] 0.0042537796 0.0010404155 0.0009843316

[[31]]
[1] 0.0021835958 0.0123436755 0.0009408462 0.0008908885 0.0008955000

[[32]]
[1] 0.005831318 0.002097865 0.001114347

[[33]]
[1] 0.0133013891 0.0008980288

[[34]]
[1] 0.003072110 0.002660170 0.005531089

[[35]]
[1] 0.001596968 0.001937480 0.002236446 0.005277973

[[36]]
[1] 0.001878392 0.005936466 0.002734973 0.001604487

[[37]]
[1] 0.004449595 0.004087449 0.003382780 0.002734973 0.001796205 0.002468228

[[38]]
[1] 0.0133013891 0.0009426671 0.0009042085

[[39]]
[1] 0.0020651761 0.0019354986 0.0007996429

[[40]]
[1] 0.0123436755 0.0021315468 0.0009945834 0.0009414076

[[41]]
[1] 0.001328590 0.002035029 0.005831318 0.002006311

[[42]]
[1] 0.003001429 0.002808776 0.003080049 0.003599849 0.004266716 0.003407656
[7] 0.007482348

[[43]]
[1] 0.001364908 0.001868686 0.001609008

[[44]]
[1] 0.001837465 0.005261703 0.003407656 0.004327631

[[45]]
[1] 0.001826891 0.002215115 0.007482348 0.004327631 0.001033418 0.001055321

[[46]]
[1] 0.0016908763 0.0017556598 0.0013983663 0.0016044867 0.0017962051
[6] 0.0043493723 0.0006979124

[[47]]
[1] 0.0014076669 0.0020978649 0.0020063106 0.0007880819 0.0008352345

[[48]]
numeric(0)

[[49]]
[1] 0.002035937 0.001352479 0.001870923 0.003499025

[[50]]
[1] 0.001870586 0.001364908

[[51]]
[1] 0.001552262 0.001935499 0.000722524

[[52]]
[1] 0.006697566 0.002031466 0.001868686 0.003588130 0.005521926

[[53]]
[1] 0.001501404 0.001657611

[[54]]
[1] 0.0015953402 0.0013921607 0.0015520704 0.0010089184 0.0008445359
[6] 0.0006908864

[[55]]
[1] 0.007575615 0.003527405 0.002477496 0.003963653 0.003499025

[[56]]
[1] 0.004315842 0.003356687 0.002884652 0.002410879 0.002236446 0.002178883

[[57]]
[1] 0.004722243 0.002928580

[[58]]
[1] 0.002947391 0.001787392 0.003588130 0.009069811

[[59]]
[1] 0.001609008 0.005521926 0.009069811

[[60]]
[1] 0.002656938 0.001584017 0.002028040 0.002468228 0.004349372

[[61]]
[1] 0.002131547 0.001252905 0.001210392

[[62]]
[1] 0.0022736286 0.0023639641 0.0025208956 0.0042537796 0.0007773996

[[63]]
[1] 0.001008918 0.005053451 0.002509349 0.001931811

[[64]]
[1] 0.0009408462 0.0009426671 0.0009945834 0.0012529046 0.0108592161

[[65]]
[1] 0.0018011331 0.0016522358 0.0010334178 0.0007880819 0.0099562188
[6] 0.0093594811

[[66]]
[1] 0.0011785245 0.0011506607 0.0010664269 0.0008895808 0.0006979124
[6] 0.0007773996 0.0064754571

[[67]]
[1] 0.0013111958 0.0011281918 0.0008908885 0.0007996429 0.0007225240

[[68]]
[1] 0.0013129618 0.0017617908 0.0008445359 0.0050534505

[[69]]
[1] 0.001320848 0.001537177 0.001260504 0.001449637 0.001575009 0.001346034
[7] 0.001040416 0.009956219 0.012040582

[[70]]
[1] 0.0013254821 0.0008955000 0.0009414076 0.0012103921

[[71]]
[1] 0.002901933

[[72]]
[1] 0.001160634 0.002509349 0.006205971

[[73]]
[1] 0.002124330 0.002310335 0.002573408 0.005531089 0.005277973 0.002178883

[[74]]
[1] 0.0012931171 0.0011731257 0.0009843316 0.0064754571 0.0120405815

[[75]]
[1] 0.0011143468 0.0010553209 0.0008352345 0.0093594811

[[76]]
[1] 0.0008980288 0.0009042085 0.0108592161

[[77]]
[1] 0.0010664325 0.0011782214 0.0006908864 0.0019318111 0.0062059708</code></pre>
</div>
</div>
</section>
<section id="row-standardized-weights-matrix" class="level3">
<h3 class="anchored" data-anchor-id="row-standardized-weights-matrix">2.4.1.5 <strong>Row-Standardized Weights Matrix</strong></h3>
<p>We now need to assign weights to each neighboring polygon. We use equal weights (style=“W”), where each neighboring polygon is assigned a weight of 1 divided by the number of neighbors.</p>
<p>This means each neighboring county’s weight is calculated as 1/(# of neighbors), and these weights are then used to sum the weighted income values.</p>
<p>While this method is intuitive for summarizing neighbors’ values, it has a drawback: polygons at the edges of the study area may rely on fewer neighbors, potentially skewing the spatial autocorrelation results.</p>
<div class="note-box">
<p>Note: For simplicity, we’ll use the style=“W” option in this example, but be aware that more robust options, such as style=“B”, are available.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>rswm_q_pro_all <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q_pro_all, <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>rswm_q_pro_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs

Weights style: W 
Weights constants summary:
   n   nn S0       S1      S2
W 76 5776 76 36.26113 315.652</code></pre>
</div>
</div>
<p>Setting the argument <code>zero.policy</code> to TRUE allows for lists of non-neighbors. This should be used with caution as users may not be aware of missing neighbors in their data however setting <code>zero,policy</code> to FALSE would return an error.</p>
<div class="insights-box">
<p>The <code>nb2listw()</code> function requires an input of class <code>nb</code>, representing a neighborhood object. The function’s two key arguments are <code>style</code> and <code>zero.policy</code>.</p>
<ul>
<li><p>The <code>style</code> argument defines how the weights are calculated. It can take several values:</p>
<ul>
<li><p><code>"B"</code>: Binary coding, where weights are either 0 or 1.</p></li>
<li><p><code>"W"</code>: Row-standardized, where the sum of weights across all neighbors equals 1.</p></li>
<li><p><code>"C"</code>: Globally standardized, where the sum of weights across all neighbors equals the total number of neighbors.</p></li>
<li><p><code>"U"</code>: A variation of <code>"C"</code>, where weights are normalized by the number of neighbors.</p></li>
<li><p><code>"S"</code>: A variance-stabilizing scheme proposed by Tiefelsdorf et al.&nbsp;(1999), which adjusts weights based on the number of neighbors.</p></li>
</ul></li>
<li><p>The <code>zero.policy</code> argument, when set to <code>TRUE</code>, handles regions with no neighbors by assigning them a weight vector of zero length. This results in a spatial lag value of zero for regions without neighbors, which may or may not be a suitable assumption depending on the context. For such regions, the spatially lagged value is computed as the sum of the products of a zero vector with any numerical vector <code>x</code>, effectively setting the lagged value to zero for those regions.</p></li>
</ul>
</div>
<p>The code chunk below is implemented to check the weights of the first polygons three neighbors type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>rswm_q_pro_all<span class="sc">$</span>weights[<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.2 0.2 0.2 0.2 0.2</code></pre>
</div>
</div>
<div class="insights-box">
<p>Each neighbor is assigned a 0.33 of the total weight. This means that when R computes the average neighboring income values, each neighbor’s income will be multiplied by 0.125 before being tallied.</p>
</div>
<p>Using the same method, we derive a row standardized distance weight matrix by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>rswm_ids_pro_all <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q_pro_all, <span class="at">glist=</span>ids_pro_all, <span class="at">style=</span><span class="st">"B"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>rswm_ids_pro_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
48
2 disjoint connected subgraphs

Weights style: B 
Weights constants summary:
   n   nn       S0         S1        S2
B 76 5776 1.213098 0.01552322 0.1106777</code></pre>
</div>
</div>
</section>
<section id="application-of-spatial-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="application-of-spatial-weight-matrix">2.4.1.6 Application of Spatial Weight Matrix</h3>
<p>We now create four different spatial lagged variables:</p>
<ul>
<li><p>spatial lag with row-standardized weights</p></li>
<li><p>spatial lag as a sum of neighbouring values</p></li>
<li><p>spatial window average</p></li>
<li><p>spatial window sum</p></li>
</ul>
<section id="spatial-lag-with-row-standardized-weights" class="level4">
<h4 class="anchored" data-anchor-id="spatial-lag-with-row-standardized-weights">2.4.1.6.1 <strong>Spatial Lag With Row-Standardized Weights</strong></h4>
<p>We now compute the average neighbor profit value for each polygon. We often refer to these values as Spatially Lagged Values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>pro_all.lag <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_q_pro_all, profit_all<span class="sc">$</span>total_value)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>pro_all.lag</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  15248910000  71904305000  17782063583   5178840000  36013064000
 [6]  31745038750  32105155000  10405027500  12712836300  33305844000
[11]  22020000000  35697183833   7173613333  16223873333  14814766000
[16]  27425816000  67352080889 212310945000  45577798571  21752636667
[21]   4584020000 270772546000  24977540000  20078698000   4460971667
[26]  23296622300  44589101714  32263766667  17276292250  24668200588
[31] 203675776000  86141040000  10075095000 163646976667 142613772500
[36]  80010247500  57489828583  65740183333  10838346667 250877220000
[41]  65822225000  77822444000   8713083333   6442295000 119772565000
[46] 278672914286  50654714000            0  23475485375  15365575000
[51]   9887916667  10243580400  46938295000  30342651667  28203860300
[56]  18890338333   8793150750   6465472500  11795120000  77961440000
[61] 333411596667 377157446940  27488695000   6144732000  47679541667
[66] 322168826671  12065114000  25180272500  30452323556   6594607500
[71]  83774300000   8448340000  84276121667   9224755340  43124960000
[76]  59620853333  12093334000</code></pre>
</div>
</div>
<p>We can append the spatially lagged profit values onto our <code>profit_foreigners</code> sf data-frame by using the code chunk shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>lag.list_pro_all <span class="ot">&lt;-</span> <span class="fu">list</span>(profit_all<span class="sc">$</span>province_eng, <span class="fu">lag.listw</span>(rswm_q_pro_all, profit_all<span class="sc">$</span>total_value))</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>lag.res_pro_all <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lag.list_pro_all)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lag.res_pro_all) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"province_eng"</span>, <span class="st">"lag Profit"</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>profit_all <span class="ot">&lt;-</span> <span class="fu">left_join</span>(profit_all,lag.res_pro_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now plot the actual profit and spatial lag profits side by side to facilitate comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>pro_all <span class="ot">&lt;-</span> <span class="fu">qtm</span>(profit_all, <span class="st">"total_value"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>lag_pro_all <span class="ot">&lt;-</span> <span class="fu">qtm</span>(profit_all, <span class="st">"lag Profit"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(pro_all, lag_pro_all, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see a difference in the surrounding regions of Bangkok as well as Mae Hong Son, all of which are in a higher band as compared to the non-spatially lagged values.</p>
</section>
<section id="spatial-window-sum" class="level4">
<h4 class="anchored" data-anchor-id="spatial-window-sum">2.4.1.6.2 <strong>Spatial Window Sum</strong></h4>
<p>The spatial window sum is the counter part of the window average, but without using row-standardized weights.</p>
<p>To add the diagonal element to the neighbour list, we just need to use <em>include.self()</em> from <strong>spdep</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>wm_qs_profit <span class="ot">&lt;-</span> <span class="fu">include.self</span>(wm_q_pro_all)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>wm_qs_profit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 429 
Percentage nonzero weights: 7.235622 
Average number of links: 5.571429 
2 disjoint connected subgraphs</code></pre>
</div>
</div>
<p>We now assign binary weights to the neighbour structure that includes the diagonal element.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>b_weights <span class="ot">&lt;-</span> <span class="fu">lapply</span>(wm_qs_profit, <span class="cf">function</span>(x) <span class="dv">0</span><span class="sc">*</span>x <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>b_weights[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 1 1 1</code></pre>
</div>
</div>
<p>Notice that now [1] has four neighbours instead of three.</p>
<p>Again, we use <em>nb2listw()</em> and <em>glist()</em> to explicitly assign weight values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>b_weights2 <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_qs_profit, </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">glist =</span> b_weights, </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style =</span> <span class="st">"B"</span>)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>b_weights2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 429 
Percentage nonzero weights: 7.235622 
Average number of links: 5.571429 
2 disjoint connected subgraphs

Weights style: B 
Weights constants summary:
   n   nn  S0  S1    S2
B 77 5929 429 858 10572</code></pre>
</div>
</div>
<p>With our newly obtained weight structure, we can compute the lag variable with&nbsp;<em>lag.listw()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>w_sum_profit <span class="ot">&lt;-</span> <span class="fu">list</span>(profit_all<span class="sc">$</span>province_eng, <span class="fu">lag.listw</span>(b_weights2, profit_all<span class="sc">$</span>total_value))</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>w_sum_profit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] "Ang Thong"                "Bangkok"                 
 [3] "Chai Nat"                 "Kanchanaburi"            
 [5] "Lop Buri"                 "Nakhon Pathom"           
 [7] "Nonthaburi"               "Pathum Thani"            
 [9] "Phetchaburi"              "Phra Nakhon Si Ayutthaya"
[11] "Prachuap Khiri Khan"      "Ratchaburi"              
[13] "Samut Prakan"             "Samut Sakhon"            
[15] "Samut Songkhram"          "Saraburi"                
[17] "Sing Buri"                "Suphan Buri"             
[19] "Chachoengsao"             "Chanthaburi"             
[21] "Chon Buri"                "Nakhon Nayok"            
[23] "Prachin Buri"             "Rayong"                  
[25] "Sa Kaeo"                  "Trat"                    
[27] "Amnat Charoen"            "Bueng Kan"               
[29] "Buri Ram"                 "Chaiyaphum"              
[31] "Kalasin"                  "Khon Kaen"               
[33] "Loei"                     "Maha Sarakham"           
[35] "Mukdahan"                 "Nakhon Phanom"           
[37] "Nakhon Ratchasima"        "Nong Bua Lam Phu"        
[39] "Nong Khai"                "Roi Et"                  
[41] "Sakon Nakhon"             "Surin"                   
[43] "Ubon Ratchathani"         "Udon Thani"              
[45] "Yasothon"                 "Chiang Mai"              
[47] "Chiang Rai"               "Kamphaeng Phet"          
[49] "Lampang"                  "Lamphun"                 
[51] "Mae Hong Son"             "Nakhon Sawan"            
[53] "Nan"                      "Phayao"                  
[55] "Phetchabun"               "Phichit"                 
[57] "Phitsanulok"              "Phrae"                   
[59] "Sukhothai"                "Tak"                     
[61] "Uthai Thani"              "Uttaradit"               
[63] "Chumphon"                 "Krabi"                   
[65] "Nakhon Si Thammarat"      "Narathiwat"              
[67] "Pattani"                  "Phangnga"                
[69] "Phatthalung"              "Phuket"                  
[71] "Ranong"                   "Satun"                   
[73] "Si Sa Ket"                "Songkhla"                
[75] "Surat Thani"              "Trang"                   
[77] "Yala"                    

[[2]]
 [1] 4.830338e+10 2.134585e+12 1.101507e+11 9.340557e+10 1.946905e+11
 [6] 2.680883e+11 1.396260e+11 4.928399e+10 1.473385e+11 2.103152e+11
[11] 1.772473e+11 1.171938e+11 3.554698e+10 1.016263e+11 8.539054e+10
[16] 1.552375e+11 6.085889e+11 8.650487e+11 3.343474e+11 8.676681e+10
[21] 5.111633e+11 2.183154e+12 6.231617e+10 1.664943e+11 4.162284e+10
[26] 1.587393e+11 3.131988e+11 9.978200e+10 1.532802e+11 2.028048e+11
[31] 1.021204e+12 2.996642e+11 3.231268e+10 4.936895e+11 5.789357e+11
[36] 3.266903e+11 4.004009e+11 1.981167e+11 4.581352e+10 1.007159e+12
[41] 2.702601e+11 5.519137e+11 4.284426e+10 5.251363e+10 7.204721e+11
[46] 2.210756e+12 3.488313e+11 4.543780e+09 1.073239e+11 3.554191e+10
[51] 4.403470e+10 6.355763e+10 1.030658e+11 1.870943e+11 1.634672e+11
[56] 1.174073e+11 4.062376e+10 3.220251e+10 4.437412e+10 4.082087e+11
[61] 1.004334e+12 1.891204e+12 1.249114e+11 1.965276e+11 3.199416e+11
[66] 2.260363e+12 6.266470e+10 1.747477e+11 2.802401e+11 8.571596e+11
[71] 9.147103e+10 4.840299e+10 5.105184e+11 1.584872e+11 3.283940e+11
[76] 1.981167e+11 6.829842e+10</code></pre>
</div>
</div>
<p>Next, we will convert the lag variable listw object into a data.frame by using&nbsp;<em>as.data.frame()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>w_sum_profit.res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(w_sum_profit)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(w_sum_profit.res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"province_eng"</span>, <span class="st">"w_sum Profit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>Do note that the second command line on the code chunk above renames the field names of&nbsp;<em>w_sum_profit.res</em>&nbsp;object into province_eng&nbsp;and&nbsp;<em>w_sum Profit</em>&nbsp;respectively.</p>
</div>
<p>Next, the code chunk below will be used to append&nbsp;w_sum&nbsp;<em>Profit</em> values onto&nbsp;our profit sf data.frame by using&nbsp;left_join()&nbsp;of&nbsp;<strong>dplyr</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>profit_all <span class="ot">&lt;-</span> <span class="fu">left_join</span>(profit_all, w_sum_profit.res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To compare the values of lag Profit and Spatial window average, the&nbsp;<code>kable()</code>&nbsp;function of the Knitr package is used to prepare a table using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>profit_all <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"province_eng"</span>, <span class="st">"total_value"</span>, <span class="st">"w_sum Profit"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">province_eng</th>
<th style="text-align: right;">total_value</th>
<th style="text-align: right;">w_sum Profit</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ang Thong</td>
<td style="text-align: right;">2.556650e+09</td>
<td style="text-align: right;">4.830338e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.3332 14…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bangkok</td>
<td style="text-align: right;">1.846967e+12</td>
<td style="text-align: right;">2.134585e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((100.6139 13…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chai Nat</td>
<td style="text-align: right;">3.458300e+09</td>
<td style="text-align: right;">1.101507e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.1199 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kanchanaburi</td>
<td style="text-align: right;">7.786905e+10</td>
<td style="text-align: right;">9.340557e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((98.58631 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lop Buri</td>
<td style="text-align: right;">1.462523e+10</td>
<td style="text-align: right;">1.946905e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((101.3453 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nakhon Pathom</td>
<td style="text-align: right;">1.412800e+10</td>
<td style="text-align: right;">2.680883e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.2231 14…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nonthaburi</td>
<td style="text-align: right;">1.120537e+10</td>
<td style="text-align: right;">1.396260e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.3415 14…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pathum Thani</td>
<td style="text-align: right;">7.663878e+09</td>
<td style="text-align: right;">4.928399e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.8916 14…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phetchaburi</td>
<td style="text-align: right;">8.377430e+10</td>
<td style="text-align: right;">1.473385e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.75869 13…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phra Nakhon Si Ayutthaya</td>
<td style="text-align: right;">4.378594e+10</td>
<td style="text-align: right;">2.103152e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.5131 14…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Prachuap Khiri Khan</td>
<td style="text-align: right;">1.111873e+11</td>
<td style="text-align: right;">1.772473e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.56326 11…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ratchaburi</td>
<td style="text-align: right;">1.010229e+10</td>
<td style="text-align: right;">1.171938e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.8821 13….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Samut Prakan</td>
<td style="text-align: right;">1.402614e+10</td>
<td style="text-align: right;">3.554698e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.7306 13…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Samut Sakhon</td>
<td style="text-align: right;">4.283070e+09</td>
<td style="text-align: right;">1.016263e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.3091 13…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Samut Songkhram</td>
<td style="text-align: right;">1.131671e+10</td>
<td style="text-align: right;">8.539054e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.0116 13…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Saraburi</td>
<td style="text-align: right;">1.810841e+10</td>
<td style="text-align: right;">1.552375e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((101.3994 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sing Buri</td>
<td style="text-align: right;">2.420130e+09</td>
<td style="text-align: right;">6.085889e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.3691 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Suphan Buri</td>
<td style="text-align: right;">1.580496e+10</td>
<td style="text-align: right;">8.650487e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.37118 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chachoengsao</td>
<td style="text-align: right;">1.530283e+10</td>
<td style="text-align: right;">3.343474e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((101.0612 13…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chanthaburi</td>
<td style="text-align: right;">2.150890e+10</td>
<td style="text-align: right;">8.676681e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((102.2517 12…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chon Buri</td>
<td style="text-align: right;">4.836592e+11</td>
<td style="text-align: right;">5.111633e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.9719 12…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nakhon Nayok</td>
<td style="text-align: right;">1.697358e+10</td>
<td style="text-align: right;">2.183154e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((101.2827 14…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Prachin Buri</td>
<td style="text-align: right;">1.236109e+10</td>
<td style="text-align: right;">6.231617e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((101.4881 14…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rayong</td>
<td style="text-align: right;">6.610082e+10</td>
<td style="text-align: right;">1.664943e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((101.4421 12…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sa Kaeo</td>
<td style="text-align: right;">1.485701e+10</td>
<td style="text-align: right;">4.162284e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((102.1877 14…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trat</td>
<td style="text-align: right;">4.225621e+10</td>
<td style="text-align: right;">1.587393e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((102.5216 11…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Amnat Charoen</td>
<td style="text-align: right;">1.075100e+09</td>
<td style="text-align: right;">3.131988e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((104.9598 16…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bueng Kan</td>
<td style="text-align: right;">2.990700e+09</td>
<td style="text-align: right;">9.978200e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((103.405 18….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Buri Ram</td>
<td style="text-align: right;">1.506982e+10</td>
<td style="text-align: right;">1.532802e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((102.9303 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chaiyaphum</td>
<td style="text-align: right;">5.459210e+09</td>
<td style="text-align: right;">2.028048e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((101.5603 16…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kalasin</td>
<td style="text-align: right;">2.825040e+09</td>
<td style="text-align: right;">1.021204e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((103.584 17….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Khon Kaen</td>
<td style="text-align: right;">4.124104e+10</td>
<td style="text-align: right;">2.996642e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((102.7072 17…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Loei</td>
<td style="text-align: right;">1.216249e+10</td>
<td style="text-align: right;">3.231268e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((102.095 18….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maha Sarakham</td>
<td style="text-align: right;">2.748530e+09</td>
<td style="text-align: right;">4.936895e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((103.1562 16…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mukdahan</td>
<td style="text-align: right;">8.480580e+09</td>
<td style="text-align: right;">5.789357e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((104.2527 16…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nakhon Phanom</td>
<td style="text-align: right;">6.649310e+09</td>
<td style="text-align: right;">3.266903e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((104.192 18….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nakhon Ratchasima</td>
<td style="text-align: right;">5.546189e+10</td>
<td style="text-align: right;">4.004009e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((102.3144 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nong Bua Lam Phu</td>
<td style="text-align: right;">8.961000e+08</td>
<td style="text-align: right;">1.981167e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((102.2866 17…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nong Khai</td>
<td style="text-align: right;">1.329848e+10</td>
<td style="text-align: right;">4.581352e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((103.2985 18…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Roi Et</td>
<td style="text-align: right;">3.649690e+09</td>
<td style="text-align: right;">1.007159e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((104.314 16….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sakon Nakhon</td>
<td style="text-align: right;">6.971230e+09</td>
<td style="text-align: right;">2.702601e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((103.5404 18…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Surin</td>
<td style="text-align: right;">7.156580e+09</td>
<td style="text-align: right;">5.519137e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((103.1336 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ubon Ratchathani</td>
<td style="text-align: right;">1.670501e+10</td>
<td style="text-align: right;">4.284426e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((105.0633 16…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Udon Thani</td>
<td style="text-align: right;">2.674445e+10</td>
<td style="text-align: right;">5.251363e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((102.0581 18…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yasothon</td>
<td style="text-align: right;">1.836680e+09</td>
<td style="text-align: right;">7.204721e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((104.3952 16…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chiang Mai</td>
<td style="text-align: right;">2.600457e+11</td>
<td style="text-align: right;">2.210756e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((99.52512 20…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chiang Rai</td>
<td style="text-align: right;">9.555777e+10</td>
<td style="text-align: right;">3.488313e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.96093 20…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Kamphaeng Phet</td>
<td style="text-align: right;">4.543780e+09</td>
<td style="text-align: right;">4.543780e+09</td>
<td style="text-align: left;">MULTIPOLYGON (((99.48875 16…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lampang</td>
<td style="text-align: right;">1.342195e+10</td>
<td style="text-align: right;">1.073239e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.58445 19…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lamphun</td>
<td style="text-align: right;">4.810760e+09</td>
<td style="text-align: right;">3.554191e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((99.18821 18…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mae Hong Son</td>
<td style="text-align: right;">1.437095e+10</td>
<td style="text-align: right;">4.403470e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((98.0591 19….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nakhon Sawan</td>
<td style="text-align: right;">1.233973e+10</td>
<td style="text-align: right;">6.355763e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.0266 16…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nan</td>
<td style="text-align: right;">9.189250e+09</td>
<td style="text-align: right;">1.030658e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.8948 19…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phayao</td>
<td style="text-align: right;">5.038420e+09</td>
<td style="text-align: right;">1.870943e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.4195 19…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phetchabun</td>
<td style="text-align: right;">2.244791e+10</td>
<td style="text-align: right;">1.634672e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((101.3987 17…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phichit</td>
<td style="text-align: right;">4.065240e+09</td>
<td style="text-align: right;">1.174073e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.2165 16…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phitsanulok</td>
<td style="text-align: right;">2.303746e+10</td>
<td style="text-align: right;">4.062376e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((101.0033 17…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phrae</td>
<td style="text-align: right;">6.340620e+09</td>
<td style="text-align: right;">3.220251e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.1597 18…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sukhothai</td>
<td style="text-align: right;">8.988760e+09</td>
<td style="text-align: right;">4.437412e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((99.60051 17…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tak</td>
<td style="text-align: right;">1.840145e+10</td>
<td style="text-align: right;">4.082087e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((97.97318 17…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Uthai Thani</td>
<td style="text-align: right;">4.098740e+09</td>
<td style="text-align: right;">1.004334e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((99.13905 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Uttaradit</td>
<td style="text-align: right;">5.416300e+09</td>
<td style="text-align: right;">1.891204e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((101.0924 18…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chumphon</td>
<td style="text-align: right;">1.495662e+10</td>
<td style="text-align: right;">1.249114e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.19067 10…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Krabi</td>
<td style="text-align: right;">1.658040e+11</td>
<td style="text-align: right;">1.965276e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.11329 7….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nakhon Si Thammarat</td>
<td style="text-align: right;">3.386435e+10</td>
<td style="text-align: right;">3.199416e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.77467 9….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Narathiwat</td>
<td style="text-align: right;">5.181640e+09</td>
<td style="text-align: right;">2.260363e+12</td>
<td style="text-align: left;">MULTIPOLYGON (((101.6323 6….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pattani</td>
<td style="text-align: right;">2.339130e+09</td>
<td style="text-align: right;">6.266470e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((101.2827 6….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phangnga</td>
<td style="text-align: right;">7.402664e+10</td>
<td style="text-align: right;">1.747477e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((98.61471 7….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phatthalung</td>
<td style="text-align: right;">6.169140e+09</td>
<td style="text-align: right;">2.802401e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.96416 7….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phuket</td>
<td style="text-align: right;">8.307811e+11</td>
<td style="text-align: right;">8.571596e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((98.31437 7….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ranong</td>
<td style="text-align: right;">7.696730e+09</td>
<td style="text-align: right;">9.147103e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((98.35294 9….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Satun</td>
<td style="text-align: right;">2.305797e+10</td>
<td style="text-align: right;">4.840299e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((100.0903 6….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Si Sa Ket</td>
<td style="text-align: right;">4.861620e+09</td>
<td style="text-align: right;">5.105184e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((104.1052 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Songkhla</td>
<td style="text-align: right;">1.123635e+11</td>
<td style="text-align: right;">1.584872e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((100.5973 7….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Surat Thani</td>
<td style="text-align: right;">1.558941e+11</td>
<td style="text-align: right;">3.283940e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.96396 9….</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trang</td>
<td style="text-align: right;">1.925409e+10</td>
<td style="text-align: right;">1.981167e+11</td>
<td style="text-align: left;">MULTIPOLYGON (((99.47579 6….</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yala</td>
<td style="text-align: right;">7.831750e+09</td>
<td style="text-align: right;">6.829842e+10</td>
<td style="text-align: left;">MULTIPOLYGON (((101.2927 6….</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We now plot the actual profit and w_sum_profit maps next to each other using the qtm() function of the tmap package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the first map for 'total_value' using Jenks classification</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>profit_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit_all) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tm_polygons</span>(<span class="st">"total_value"</span>, <span class="at">style =</span> <span class="st">"jenks"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">title =</span> <span class="st">"Total Value"</span>) <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the second map for 'w_sum Profit' using Jenks classification</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>w_sum_profit_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit_all) <span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tm_polygons</span>(<span class="st">"w_sum Profit"</span>, <span class="at">style =</span> <span class="st">"jenks"</span>, <span class="at">palette =</span> <span class="st">"Reds"</span>, <span class="at">title =</span> <span class="st">"W Sum Profit"</span>) <span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(profit_map, w_sum_profit_map, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="global-measures-of-spatial-autocorrelation">2.4.2 Global Measures of Spatial Autocorrelation</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true">2.4.2.1 Moran’s I test</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false">2.4.2.2 Geary’s C</a></li></ul>
<div class="tab-content">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<p>We now conduct Moran’s I statistics testing by using the&nbsp;<strong>moran.test()</strong>&nbsp;function of the&nbsp;<strong>spdep</strong>&nbsp;package.</p>
<div class="note-box">
<p>Statistical tests are conducted at a 5% significance level.</p>
</div>
<p>The hypotheses for the test are as follows:</p>
<ul>
<li><p>H0: Regions with similar levels of profit from tourism are randomly distributed.</p></li>
<li><p>H1: Regions with similar levels of profit from tourism are not randomly distributed and exhibit spatial clustering.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(profit_all<span class="sc">$</span>total_value, </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span>rswm_q_pro_all, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  profit_all$total_value  
weights: rswm_q_pro_all  
n reduced by no-neighbour observations  

Moran I statistic standard deviate = 0.065612, p-value = 0.4738
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     -0.010147395      -0.013333333       0.002357817 </code></pre>
</div>
</div>
<p>From the output above, we can infer the following:</p>
<ul>
<li><p>The p-value 0.7224&gt;0.05, indicating that the observed spatial autocorrelation is not statistically significant.</p></li>
<li><p>Moran’s I statistic: The observed value of -0.037 indicates <strong>no spatial autocorrelation</strong>, meaning that regions with similar levels of profit from tourism are randomly distributed.</p></li>
</ul>
<p>There isn’t sufficient evidence to reject H0 and we conclude that there is no spatial clustering with regards to profits from tourism in Thailand.</p>
<div class="note-box">
<p>If Morans I Statistic is = 0, there is Complete Random Spatial Distribution.</p>
</div>
<section id="monte-carlo-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-morans-i">2.4.2.1.1 Monte Carlo Moran’s I</h4>
<p>We now implement the moran.mc() function of the spdep package. In this scenario, we will run 1000 simulations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>bperm<span class="ot">=</span> <span class="fu">moran.mc</span>(profit_all<span class="sc">$</span>total_value, </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span>rswm_q_pro_all, </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  profit_all$total_value 
weights: rswm_q_pro_all  
number of simulations + 1: 1000 

statistic = -0.010147, observed rank = 697, p-value = 0.303
alternative hypothesis: greater</code></pre>
</div>
</div>
<div class="insights-box">
<p>From the above output, notice that the observed rank is 326. This indicates that the observed Moran’s I value of -0.037893 is not ‘unusual’ compared to the distribution that was generated by the simulations run. This further supports the high p-value and reinforces our earlier conclusion that there is no significant spatial autocorrelation in the data.</p>
</div>
<p>We visualize the test statistics obtained from the above simulation by implementing the below code chunk.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Summary Statistics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">The plot</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01239532</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002461426</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
-0.078064 -0.041783 -0.027639 -0.012395 -0.002367  0.284911 </code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm<span class="sc">$</span>res, </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq=</span><span class="cn">TRUE</span>, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks=</span><span class="dv">20</span>, </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Simulated Moran's I"</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<p>We now implement a further test to verify if our findings from the above test are indeed correct.</p>
<p>The Geary’s C test for spatial autocorrelation is implemented by using the&nbsp;<strong>geary.test()</strong>&nbsp;function of the&nbsp;<strong>spdep</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geary.test</span>(profit_all<span class="sc">$</span>total_value, <span class="at">listw=</span>rswm_q_pro_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  profit_all$total_value 
weights: rswm_q_pro_all  
n reduced by no-neighbour observations 

Geary C statistic standard deviate = 0.89723, p-value = 0.1848
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       0.85789622        1.00000000        0.02508438 </code></pre>
</div>
</div>
<p>We once again see that the p-value (0.8784) is greater than 0.05. We do not have sufficient evidence to reject the null hypothesis. In fact, from the Geary C statistic value, we infer that there is actually <strong>negative</strong> spatial autocorrelation.</p>
<section id="monte-carlo-gearys-c" class="level4">
<h4 class="anchored" data-anchor-id="monte-carlo-gearys-c">2.4.2.2.1 Monte Carlo Geary’s C</h4>
<p>We implement the the geary.mc() function of the spdep package to conduct 1000 simulations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>bperm<span class="ot">=</span><span class="fu">geary.mc</span>(profit_all<span class="sc">$</span>total_value, <span class="at">listw=</span>rswm_q_pro_all, </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">nsim=</span><span class="dv">999</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  profit_all$total_value 
weights: rswm_q_pro_all  
number of simulations + 1: 1000 

statistic = 0.8579, observed rank = 193, p-value = 0.193
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>The simulations above reinforce our earlier conclusion.</p>
</section>
</div>
</div>
</div>
<section id="spatial-correlogram" class="level3">
<h3 class="anchored" data-anchor-id="spatial-correlogram">2.4.2.3 Spatial Correlogram</h3>
<p>Spatial correlograms are a powerful tool for analyzing patterns of spatial autocorrelation in your data or model residuals. They illustrate how the correlation between pairs of spatial observations changes as the distance (or lag) between them increases. Essentially, they plot an index of autocorrelation, such as Moran’s I or Geary’s C, against distance.</p>
<p>While correlograms are not as central to geostatistics as variograms—an essential concept in that field—they offer valuable insights as an exploratory and descriptive tool. In fact, for examining spatial autocorrelation, correlograms often provide more detailed information than variograms, making them particularly useful for initial spatial data analysis.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true">Moran’s I Correlogram</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false">Geary’s C Correlogram</a></li></ul>
<div class="tab-content">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<p>We implement the sp.correlogram() function of the spdep package to compute a 6-lag spatial correlogram of profit from tourism in Thailand. The global spatial autocorrelation used in Moran’s I.</p>
<p>The <strong>plot()</strong> of base Graph is then used to plot the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>MI_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(wm_q_pro_all, </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>                          profit_all<span class="sc">$</span>total_value, </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order=</span><span class="dv">6</span>, </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method=</span><span class="st">"I"</span>, </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot above may not allow us to provide complete interpretation. This is because not all autocorrelation values are statistically significant. Hence, it is important for us to examine the full analysis report by printing out the analysis results as in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(MI_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial correlogram for profit_all$total_value 
method: Moran's I
         estimate expectation   variance standard deviate Pr(I) two sided
1 (76) -0.0101474  -0.0133333  0.0023578           0.0656          0.9477
2 (76) -0.0176961  -0.0133333  0.0014567          -0.1143          0.9090
3 (76) -0.0191112  -0.0133333  0.0011568          -0.1699          0.8651
4 (76) -0.0304960  -0.0133333  0.0012360          -0.4882          0.6254
5 (76) -0.0175200  -0.0133333  0.0013957          -0.1121          0.9108
6 (76) -0.0254808  -0.0133333  0.0020155          -0.2706          0.7867</code></pre>
</div>
</div>
<p>From above, we can conclude that there is NO spatial autocorrelation.</p>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<p>We implement the&nbsp;<code>sp.correlogram()</code>&nbsp;of&nbsp;<strong>spdep</strong>&nbsp;package is used to compute a 6-lag spatial correlogram of total_value, profit. The global spatial autocorrelation used in Geary’s C. The&nbsp;<strong>plot()</strong>&nbsp;of base Graph is then used to plot the output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>GC_corr <span class="ot">&lt;-</span> <span class="fu">sp.correlogram</span>(wm_q_pro_all, </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>                          profit_all<span class="sc">$</span>total_value, </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">order=</span><span class="dv">6</span>, </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">method=</span><span class="st">"C"</span>, </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(GC_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similar to the step done for Moran’s I, we will print out the analysis report by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(GC_corr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spatial correlogram for profit_all$total_value 
method: Geary's C
       estimate expectation variance standard deviate Pr(I) two sided
1 (76) 0.857896    1.000000 0.025084          -0.8972          0.3696
2 (76) 0.943719    1.000000 0.021602          -0.3829          0.7018
3 (76) 1.010709    1.000000 0.022887           0.0708          0.9436
4 (76) 1.082440    1.000000 0.037279           0.4270          0.6694
5 (76) 0.884287    1.000000 0.079390          -0.4107          0.6813
6 (76) 0.711056    1.000000 0.161791          -0.7183          0.4725</code></pre>
</div>
</div>
<p>Indeed, our findings are reinforced.</p>
</div>
</div>
</div>
</section>
</section>
<section id="local-indicators-of-spatial-association" class="level2">
<h2 class="anchored" data-anchor-id="local-indicators-of-spatial-association">2.4.3 Local Indicators of Spatial Association</h2>
<p>Local Indicators of Spatial Association or LISA are statistics that evaluate the existence of clusters and/or outliers in the spatial arrangement of a given variable. For instance if we are studying distribution of profits from tourism across Thailand, local clusters in profit mean that there are counties that have higher or lower rates than is to be expected by chance alone; that is, the values occurring are above or below those of a random distribution in space.</p>
<section id="computing-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="computing-local-morans-i">2.4.3.1 Computing Local Moran’s I</h3>
<p>We implement the localmoran() function of spdep compute the local Moran’s I statistic. This function helps us compute li values, given a set of zi values and a listw object providing neighbor weighting information for the polygon associated with the zi values.</p>
<p>We compute Local Moran’s I for Profits from Tourism at the County Level</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(profit_all<span class="sc">$</span>province_eng)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>localMI <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(profit_all<span class="sc">$</span>total_value, rswm_q_pro_all)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii          E.Ii       Var.Ii       Z.Ii Pr(z != E(Ii))
1  0.06181623 -1.012111e-03 0.0252591992  0.3953173      0.6926088
2  0.15435147 -7.673501e-01 3.2991219598  0.5074475      0.6118408
3  0.05798144 -9.840716e-04 0.0117753912  0.5433884      0.5868624
4 -0.01218856 -2.760711e-05 0.0006896679 -0.4630711      0.6433134
5  0.03017796 -6.694470e-04 0.0097531108  0.3123540      0.7547715
6  0.03463324 -6.821710e-04 0.0059490181  0.4578695      0.6470462</code></pre>
</div>
</div>
<div class="insights-box">
<p><em>localmoran()</em> function returns a matrix of values whose columns are:</p>
<ul>
<li><p>Ii: the local Moran’s I statistics</p></li>
<li><p>E.Ii: the expectation of local moran statistic under the randomisation hypothesis</p></li>
<li><p>Var.Ii: the variance of local moran statistic under the randomisation hypothesis</p></li>
<li><p>Z.Ii:the standard deviate of local moran statistic</p></li>
<li><p>Pr(): the p-value of local moran statistic</p></li>
</ul>
</div>
<p>We now use the printCoefmat() to display the content of the local Moran matrix that we created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printCoefmat</span>(<span class="fu">data.frame</span>(</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  localMI[fips,], </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names=</span>profit_all<span class="sc">$</span>province_eng[fips]),</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  Ii        E.Ii      Var.Ii        Z.Ii
Amnat Charoen             2.7517e-02 -1.0590e-03  1.0706e-02  2.7618e-01
Ang Thong                 6.1816e-02 -1.0121e-03  2.5259e-02  3.9532e-01
Bangkok                   1.5435e-01 -7.6735e-01  3.2991e+00  5.0745e-01
Bueng Kan                 4.1289e-02 -9.9856e-04  2.4921e-02  2.6787e-01
Buri Ram                  4.7904e-02 -6.5817e-04  5.7399e-03  6.4098e-01
Chachoengsao              2.0651e-02 -6.5230e-04  6.5970e-03  2.6229e-01
Chai Nat                  5.7981e-02 -9.8407e-04  1.1775e-02  5.4339e-01
Chaiyaphum                4.8334e-02 -9.2325e-04  8.0495e-03  5.4902e-01
Chanthaburi               3.8221e-02 -5.0560e-04  1.2625e-02  3.4466e-01
Chiang Mai                7.5088e-01 -9.0097e-03  9.0357e-02  2.5279e+00
Chiang Rai               -8.6369e-03 -1.9489e-04  2.8407e-03 -1.5839e-01
Chon Buri                -4.8006e-01 -4.2017e-02  4.8212e-01 -6.3087e-01
Chumphon                  3.8186e-02 -6.6103e-04  1.2208e-02  3.5159e-01
Kalasin                  -1.6174e-01 -1.0037e-03  1.4618e-02 -1.3295e+00
Kamphaeng Phet            0.0000e+00  0.0000e+00  0.0000e+00         NaN
Kanchanaburi             -1.2189e-02 -2.7607e-05  6.8967e-04 -4.6307e-01
Khon Kaen                -9.0533e-03 -1.6317e-04  4.0756e-03 -1.3926e-01
Krabi                    -1.1084e-01 -2.3556e-03  3.4261e-02 -5.8607e-01
Lampang                   4.3281e-02 -7.0044e-04  1.2935e-02  3.8671e-01
Lamphun                   5.9526e-02 -9.4275e-04  3.5778e-02  3.1969e-01
Loei                      5.7872e-02 -7.3364e-04  2.7848e-02  3.5119e-01
Lop Buri                  3.0178e-02 -6.6945e-04  9.7531e-03  3.1235e-01
Mae Hong Son              5.5731e-02 -6.7594e-04  1.6875e-02  4.3422e-01
Maha Sarakham            -1.1444e-01 -1.0061e-03  2.5110e-02 -7.1586e-01
Mukdahan                 -8.1527e-02 -8.3509e-04  1.5420e-02 -6.4982e-01
Nakhon Nayok             -1.8823e-01 -6.1097e-04  5.3285e-03 -2.5702e+00
Nakhon Pathom             3.4633e-02 -6.8217e-04  5.9490e-03  4.5787e-01
Nakhon Phanom            -1.4286e-02 -8.8800e-04  1.6396e-02 -1.0464e-01
Nakhon Ratchasima         2.0960e-03 -3.3343e-05  3.9936e-04  1.0655e-01
Nakhon Sawan              5.7515e-02 -7.2892e-04  1.0619e-02  5.6521e-01
Nakhon Si Thammarat       1.1975e-02 -2.6910e-04  3.2224e-03  2.1568e-01
Nan                       2.1631e-02 -8.1506e-04  3.0936e-02  1.2762e-01
Narathiwat               -2.9111e-01 -9.3157e-04  9.4188e-03 -2.9899e+00
Nong Bua Lam Phu          1.7743e-03 -1.0648e-03  2.6572e-02  1.7416e-02
Nong Khai                 5.5920e-02 -7.0367e-04  1.7567e-02  4.2722e-01
Nonthaburi                3.6169e-02 -7.5938e-04  1.4023e-02  3.1185e-01
Pathum Thani              6.2241e-02 -8.5849e-04  1.5851e-02  5.0118e-01
Pattani                   6.5826e-02 -1.0189e-03  1.4840e-02  5.4873e-01
Phangnga                 -5.2853e-03 -1.1310e-05  2.0901e-04 -3.6480e-01
Phatthalung               4.1280e-02 -9.0214e-04  6.8888e-03  5.0823e-01
Phayao                    4.2170e-02 -9.3588e-04  1.1199e-02  4.0733e-01
Phetchabun                3.2121e-02 -4.8503e-04  7.0677e-03  3.8784e-01
Phetchaburi              -1.6631e-02 -6.6598e-05  9.7084e-04 -5.3162e-01
Phichit                   5.6141e-02 -9.6542e-04  1.1552e-02  5.3131e-01
Phitsanulok               4.7478e-02 -4.7233e-04  1.7934e-02  3.5805e-01
Phra Nakhon Si Ayutthaya  1.4604e-02 -1.3274e-04  1.9348e-03  3.3503e-01
Phrae                     6.8038e-02 -8.9708e-04  1.6563e-02  5.3564e-01
Phuket                   -8.5193e-01 -1.4125e-01  2.2416e+00 -4.7468e-01
Prachin Buri              4.2618e-02 -7.2836e-04  2.7648e-02  2.6069e-01
Prachuap Khiri Khan      -3.6589e-02 -4.6886e-04  1.1708e-02 -3.3382e-01
Ranong                   -1.8162e-02 -8.5754e-04  6.5974e-02 -6.7372e-02
Ratchaburi                3.3106e-02 -7.8960e-04  1.9710e-02  2.4144e-01
Rayong                    9.4808e-04 -2.8939e-07  4.2189e-06  4.6172e-01
Roi Et                   -2.1489e-01 -9.7817e-04  1.8059e-02 -1.5918e+00
Sa Kaeo                   6.0448e-02 -6.6356e-04  7.9427e-03  6.8571e-01
Sakon Nakhon              1.5207e-03 -8.7858e-04  1.6222e-02  1.8838e-02
Samut Prakan              5.8752e-02 -6.8479e-04  1.7096e-02  4.5458e-01
Samut Sakhon              5.9036e-02 -9.5877e-04  1.1473e-02  5.6011e-01
Samut Songkhram           5.3885e-02 -7.5637e-04  1.1018e-02  5.2055e-01
Saraburi                  3.5939e-02 -5.8367e-04  8.5042e-03  3.9604e-01
Satun                     4.7736e-02 -4.7190e-04  1.1783e-02  4.4410e-01
Si Sa Ket                -1.9604e-02 -9.4121e-04  1.1263e-02 -1.7585e-01
Sing Buri                -1.8877e-04 -1.0164e-03  7.7603e-03  9.3949e-03
Songkhla                 -4.8208e-02 -4.9426e-04  7.2021e-03 -5.6223e-01
Sukhothai                 5.9366e-02 -8.2070e-04  2.0486e-02  4.2050e-01
Suphan Buri              -1.3730e-01 -6.3974e-04  1.1815e-02 -1.2573e+00
Surat Thani              -3.9306e-02 -1.9060e-03  3.5155e-02 -1.9947e-01
Surin                    -1.1748e-02 -8.7318e-04  8.8289e-03 -1.1574e-01
Tak                      -9.6728e-03 -5.7672e-04  8.4030e-03 -9.9228e-02
Trang                     6.6840e-03 -5.5674e-04  1.3901e-02  6.1413e-02
Trat                      2.0154e-02 -1.5065e-04  2.1960e-03  4.3330e-01
Ubon Ratchathani          5.4361e-02 -6.1752e-04  1.5418e-02  4.4277e-01
Udon Thani                4.5242e-02 -3.9636e-04  7.3218e-03  5.3337e-01
Uthai Thani              -3.0925e-01 -9.6439e-04  2.4069e-02 -1.9871e+00
Uttaradit                -3.5255e-01 -9.2454e-04  1.3466e-02 -3.0301e+00
Yala                      6.0220e-02 -8.5365e-04  1.2435e-02  5.4770e-01
Yasothon                 -6.3268e-02 -1.0348e-03  1.2382e-02 -5.5928e-01
                         Pr.z....E.Ii..
Amnat Charoen                    0.7824
Ang Thong                        0.6926
Bangkok                          0.6118
Bueng Kan                        0.7888
Buri Ram                         0.5215
Chachoengsao                     0.7931
Chai Nat                         0.5869
Chaiyaphum                       0.5830
Chanthaburi                      0.7303
Chiang Mai                       0.0115
Chiang Rai                       0.8741
Chon Buri                        0.5281
Chumphon                         0.7251
Kalasin                          0.1837
Kamphaeng Phet                      NaN
Kanchanaburi                     0.6433
Khon Kaen                        0.8892
Krabi                            0.5578
Lampang                          0.6990
Lamphun                          0.7492
Loei                             0.7254
Lop Buri                         0.7548
Mae Hong Son                     0.6641
Maha Sarakham                    0.4741
Mukdahan                         0.5158
Nakhon Nayok                     0.0102
Nakhon Pathom                    0.6470
Nakhon Phanom                    0.9167
Nakhon Ratchasima                0.9151
Nakhon Sawan                     0.5719
Nakhon Si Thammarat              0.8292
Nan                              0.8985
Narathiwat                       0.0028
Nong Bua Lam Phu                 0.9861
Nong Khai                        0.6692
Nonthaburi                       0.7552
Pathum Thani                     0.6162
Pattani                          0.5832
Phangnga                         0.7153
Phatthalung                      0.6113
Phayao                           0.6838
Phetchabun                       0.6981
Phetchaburi                      0.5950
Phichit                          0.5952
Phitsanulok                      0.7203
Phra Nakhon Si Ayutthaya         0.7376
Phrae                            0.5922
Phuket                           0.6350
Prachin Buri                     0.7943
Prachuap Khiri Khan              0.7385
Ranong                           0.9463
Ratchaburi                       0.8092
Rayong                           0.6443
Roi Et                           0.1114
Sa Kaeo                          0.4929
Sakon Nakhon                     0.9850
Samut Prakan                     0.6494
Samut Sakhon                     0.5754
Samut Songkhram                  0.6027
Saraburi                         0.6921
Satun                            0.6570
Si Sa Ket                        0.8604
Sing Buri                        0.9925
Songkhla                         0.5740
Sukhothai                        0.6741
Suphan Buri                      0.2087
Surat Thani                      0.8419
Surin                            0.9079
Tak                              0.9210
Trang                            0.9510
Trat                             0.6648
Ubon Ratchathani                 0.6579
Udon Thani                       0.5938
Uthai Thani                      0.0469
Uttaradit                        0.0024
Yala                             0.5839
Yasothon                         0.5760</code></pre>
</div>
</div>
<section id="mapping-the-local-morans-i" class="level4">
<h4 class="anchored" data-anchor-id="mapping-the-local-morans-i">2.4.3.1.1 Mapping the Local Moran’s I</h4>
<p>Before we map the local Moran’s I map, it is wise to append the local Moran’s data-frame (<code>localMI</code>) onto the profit SpatialPolygonDataFrame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>profit.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(profit_all,localMI) <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true">Mapping the Local Moran’s I</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false">Mapping Local Moran’s P-values</a></li></ul>
<div class="tab-content">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p>We now make use of the tmap package and its choropleth mapping functions to plot the local Moran’s I values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(profit.localMI) <span class="sc">+</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<p>The Choropleth reveals the presence of both positive, as well as negative I values. This indicates that there are varying levels of spatial autocorrelation, however, we must examine the p-values for these I values to check for statistical significance.</p>
<p>We use the tmap package to draw a choropleth map of Moran’s I p-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(profit.localMI) <span class="sc">+</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>We map both of the above plots side by side for comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit.localMI) <span class="sc">+</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>pvalue.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit.localMI) <span class="sc">+</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(localMI.map, pvalue.map, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="creating-a-lisa-cluster-map" class="level3">
<h3 class="anchored" data-anchor-id="creating-a-lisa-cluster-map">2.4.3.2 Creating a LISA Cluster Map</h3>
<p>The LISA Cluster Map shows the significant locations color coded by type of spatial autocorrelation.</p>
<p>Before we can generate the LISA cluster map, we must plot the Moran scatterplot.</p>
<section id="plotting-a-moran-scatterplot" class="level4">
<h4 class="anchored" data-anchor-id="plotting-a-moran-scatterplot">2.4.3.2.1 Plotting a Moran Scatterplot</h4>
<p>The Moran Scatterplot depicts the relationship between the values of the chosen attribute at each location and the average value of the same attribute at neighboring locations.</p>
<p>We will implement the moran.plot() function of the spdep package to create the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>nci <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(profit_all<span class="sc">$</span>total_value, rswm_q_pro_all,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">labels=</span><span class="fu">as.character</span>(profit_all<span class="sc">$</span>province_eng), </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlab=</span><span class="st">"Total Value"</span>, </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylab=</span><span class="st">"Spatially Lag Total Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="insights-box">
<p>Notice that the plot is split in 4 quadrants.</p>
<p>The top right corner belongs to areas that have high profits and are surrounded by other areas that have the average level of profits.</p>
</div>
</section>
<section id="plotting-moran-scatterplot-with-standardised-variable" class="level4">
<h4 class="anchored" data-anchor-id="plotting-moran-scatterplot-with-standardised-variable">2.4.3.2.2 Plotting Moran Scatterplot with Standardised variable</h4>
<p>We first implement the scale() function to center and scale the variable. Here, centering is done by subtracting the mean (omitting NAs) from the corresponding columns, and scaling is done by dividing the (centered) variable by their standard deviations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>profit_all<span class="sc">$</span>Z.value <span class="ot">&lt;-</span> <span class="fu">scale</span>(profit_all<span class="sc">$</span>total_value) <span class="sc">%&gt;%</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  as.vector </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>Note that the as.vector() function is added so that we get a vector as the output. This allows us to map it neatly into our data-frame.</p>
</div>
<p>We can now plot the Moran scatterplot again by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>nci2 <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(profit_all<span class="sc">$</span>Z.value, rswm_q_pro_all,</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">as.character</span>(profit_all<span class="sc">$</span>province_eng),</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlab=</span><span class="st">"z-Value"</span>, </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylab=</span><span class="st">"Spatially Lag z-Value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="preparing-lisa-map-classes" class="level4">
<h4 class="anchored" data-anchor-id="preparing-lisa-map-classes">2.4.3.2.3 Preparing LISA Map Classes</h4>
<p>We now prepare the data in order to facilitate plotting a LISA Cluster Map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>quadrant <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="fu">nrow</span>(localMI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we will derive the spatially lagged variable of interest (i.e: GDPPC) and center the spatially lagged variable around its mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>profit_all<span class="sc">$</span><span class="st">`</span><span class="at">lag Profit</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_q_pro_all, profit_all<span class="sc">$</span>total_value)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>DV <span class="ot">&lt;-</span> profit_all<span class="sc">$</span><span class="st">`</span><span class="at">lag Profit</span><span class="st">`</span> <span class="sc">-</span> <span class="fu">mean</span>(profit_all<span class="sc">$</span><span class="st">`</span><span class="at">lag Profit</span><span class="st">`</span>)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we work on centering the local Moran around the mean.</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>LM_I <span class="ot">&lt;-</span> localMI[,<span class="dv">1</span>]   </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We set the significance level for the Local Moran in the code chunk below.</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>signif <span class="ot">&lt;-</span> <span class="fl">0.05</span>       </span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The following code chunk defines the four categories (low-low (1), low-high (2), high-low (3), high-high (4))</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&lt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span>  </span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>quadrant[DV <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> LM_I<span class="sc">&gt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">4</span>   </span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, we place the non-significant Moran in the category 0.</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>quadrant[localMI[,<span class="dv">5</span>]<span class="sc">&gt;</span>signif] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lisa-map" class="level4">
<h4 class="anchored" data-anchor-id="lisa-map">2.4.3.2.3 LISA Map</h4>
<p>We can now implement functions of the tmap package to plot the LISA Map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>profit.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(profit.localMI) <span class="sc">+</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the interest of easier visualization and interpretation, we plot the Total Values and their corresponding quadrants next to each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>profits <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit_all) <span class="sc">+</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tm_polygons</span>(<span class="st">"total_value"</span>, <span class="at">style =</span> <span class="st">"jenks"</span>, <span class="at">palette =</span> <span class="st">"Blues"</span>, <span class="at">title =</span> <span class="st">"Total Value"</span>) <span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>profit.localMI<span class="sc">$</span>quadrant <span class="ot">&lt;-</span> quadrant</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#ffffff"</span>, <span class="st">"#2c7bb6"</span>, <span class="st">"#abd9e9"</span>, <span class="st">"#fdae61"</span>, <span class="st">"#d7191c"</span>)</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"insignificant"</span>, <span class="st">"low-low"</span>, <span class="st">"low-high"</span>, <span class="st">"high-low"</span>, <span class="st">"high-high"</span>)</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>LISAmap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(profit.localMI) <span class="sc">+</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"quadrant"</span>, </span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"cat"</span>, </span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> colors[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>], </span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> clusters[<span class="fu">c</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(quadrant)))<span class="sc">+</span><span class="dv">1</span>],</span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">popup.vars =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="sc">+</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_view</span>(<span class="at">set.zoom.limits =</span> <span class="fu">c</span>(<span class="dv">11</span>,<span class="dv">17</span>)) <span class="sc">+</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(profits, LISAmap, </span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="hot-and-cold-spot-analysis" class="level3">
<h3 class="anchored" data-anchor-id="hot-and-cold-spot-analysis">2.4.3.3 Hot and Cold Spot Analysis</h3>
<p>We now use localized spatial statistics to detect hot and cold spot areas.</p>
<div class="note-box">
<p>“Hot Spot’ is generally used across various disciplines to describe a region or value that is higher relative to its surroundings.</p>
</div>
<section id="getis-and-ords-g-statistics" class="level4">
<h4 class="anchored" data-anchor-id="getis-and-ords-g-statistics">2.4.3.3.1 Getis and Ord’s G-Statistics</h4>
<p>An alternative spatial statistic used to detect spatial anomalies is the Getis-Ord G-statistic (Getis and Ord, 1972; Ord and Getis, 1995). This method examines spatial relationships within a defined proximity to identify clusters of high or low values. Statistically significant hotspots are areas where high values are spatially clustered, meaning that not only do these areas have high values, but their neighboring areas also exhibit similarly high values.</p>
<p>The analysis involves three key steps:</p>
<p>Deriving the spatial weight matrix: This defines the spatial relationships between areas, specifying which locations are considered neighbors based on proximity. Computing the Gi statistic: This step calculates the G-statistic for each location, identifying regions where values are significantly higher or lower than expected. Mapping the Gi statistics: The results are visualized to reveal spatial patterns of high-value clusters (hotspots) and low-value clusters (cold spots). This approach is useful for identifying localized patterns of spatial clustering and detecting significant anomalies in the data.</p>
</section>
<section id="deriving-distance-based-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="deriving-distance-based-weight-matrix">2.4.3.3.2 Deriving Distance Based Weight Matrix</h4>
<p>We start by defining a new set of neighbors. While the spatial autocorrelation considered units which shared borders, for Getis-Ord, we will define the neighbors based on distance.</p>
<p>There are two types of distance-based proximity matrices:</p>
<p>Fixed Distance Weight Matrix</p>
<p>Adaptive Distance Weight Matrix</p>
<section id="deriving-distance-based-weight-matrix-1" class="level5">
<h5 class="anchored" data-anchor-id="deriving-distance-based-weight-matrix-1">2.4.3.3.2.1 Deriving distance-based weight matrix</h5>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true">fixed distance matrix</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false">Mapping Gi values with fixed distance weights</a></li></ul>
<div class="tab-content">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<p>Before creating our connectivity graph, we need to assign a point to each polygon. This requires more than simply running st_centroid() on the us.bound spatial object. Specifically, we need to extract the coordinates into a separate data frame. We have already done this previously and have the object coords_all</p>
<p>For more detailed information, you can refer to the map documentation here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>wm62_lw_profit <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d62_pro_all, <span class="at">style =</span> <span class="st">'B'</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm62_lw_profit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 77 
Number of nonzero links: 350 
Percentage nonzero weights: 5.903188 
Average number of links: 4.545455 
2 disjoint connected subgraphs
Link number distribution:

 1  2  3  4  5  6  7  8  9 10 11 12 13 14 
 8 15 15 13  6  4  2  1  4  4  1  1  2  1 
8 least connected regions:
11 26 33 37 47 51 60 63 with 1 link
1 most connected region:
8 with 14 links

Weights style: B 
Weights constants summary:
   n   nn  S0  S1   S2
B 77 5929 350 700 9560</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(profit_all<span class="sc">$</span>province_eng)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>gi.fixed_profit <span class="ot">&lt;-</span> <span class="fu">localG</span>(profit_all<span class="sc">$</span>total_value, wm62_lw_profit)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>gi.fixed_profit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1.72204198  0.32507206 -0.63963877 -0.34656391 -0.63106922  1.85263552
 [7]  1.45185156  1.35082616 -0.28501259  1.41225147  0.07316501 -0.42146553
[13]  2.55350535  2.15204901  2.29392753  2.02716770 -0.78617455 -0.66718360
[19]  2.81711623  0.55503719  2.95575400  1.88026186  0.26863597  0.79540880
[25] -0.38548695 -0.19616145 -0.52581301 -0.35160364 -0.22202539 -0.21957271
[31] -0.54479866 -0.48275821 -0.28580881 -0.39038265 -0.63470128 -0.36591874
[37] -0.22285852 -0.38920403 -0.43191914 -0.63354645 -0.50650962 -0.35227572
[43] -0.39394926 -0.45414601 -0.47661388 -0.40437456 -0.26339386 -0.57279423
[49]  0.16843044  0.41726596  0.81941327 -0.67447118 -0.37806669 -0.09495497
[55] -0.42615323 -0.45645978 -0.50084879 -0.51135981 -0.50598386 -0.26988232
[61] -0.52573156 -0.41343694 -0.25664198  1.53862423  0.16663889 -0.38207690
[67] -0.19658983  2.37283918 -0.18161089  0.41109227  0.10594488 -0.16352985
[73] -0.34053906 -0.41978322  0.03763722 -0.09226794 -0.38989571
attr(,"internals")
                Gi      E(Gi)       V(Gi)       Z(Gi) Pr(z != E(Gi))
 [1,] 0.3858055203 0.14473684 0.019597204  1.72204198    0.085061914
 [2,] 0.1932727918 0.15789474 0.011844279  0.32507206    0.745126534
 [3,] 0.0184957073 0.09210526 0.013243380 -0.63963877    0.522407472
 [4,] 0.0039057092 0.02631579 0.004181385 -0.34656391    0.728918959
 [5,] 0.0193132416 0.09210526 0.013304960 -0.63106922    0.527995263
 [6,] 0.3813548575 0.13157895 0.018176955  1.85263552    0.063934618
 [7,] 0.3889691031 0.17105263 0.022528677  1.45185156    0.146542885
 [8,] 0.3927872620 0.18421053 0.023841458  1.35082616    0.176751126
 [9,] 0.0268929985 0.05263158 0.008155321 -0.28501259    0.775634493
[10,] 0.3844383845 0.17105263 0.022830045  1.41225147    0.157875930
[11,] 0.0165472431 0.01315789 0.002145979  0.07316501    0.941674808
[12,] 0.0241502351 0.06578947 0.009760711 -0.42146553    0.673415178
[13,] 0.4758402376 0.13157895 0.018176189  2.55350535    0.010664464
[14,] 0.3951862319 0.11842105 0.016539356  2.15204901    0.031393495
[15,] 0.3858808558 0.10526316 0.014964793  2.29392753    0.021794662
[16,] 0.3798739678 0.11842105 0.016634418  2.02716770    0.042645265
[17,] 0.0258430186 0.13157895 0.018088694 -0.78617455    0.431765234
[18,] 0.0324122288 0.11842105 0.016618633 -0.66718360    0.504654862
[19,] 0.4815471011 0.11842105 0.016615189  2.81711623    0.004845699
[20,] 0.1207543063 0.06578947 0.009806762  0.55503719    0.578869221
[21,] 0.4213553387 0.07894737 0.013419958  2.95575400    0.003119058
[22,] 0.3852284095 0.13157895 0.018198317  1.88026186    0.060072399
[23,] 0.1078287978 0.07894737 0.011558701  0.26863597    0.788209826
[24,] 0.1018968575 0.03947368 0.006159010  0.79540880    0.426375743
[25,] 0.0095313437 0.03947368 0.006033261 -0.38548695    0.699876672
[26,] 0.0041914072 0.01315789 0.002089380 -0.19616145    0.844483802
[27,] 0.0059294160 0.05263158 0.007888807 -0.52581301    0.599018137
[28,] 0.0039199342 0.02631579 0.004057220 -0.35160364    0.725135534
[29,] 0.0121380628 0.02631579 0.004077631 -0.22202539    0.824294115
[30,] 0.0123226101 0.02631579 0.004061403 -0.21957271    0.826203944
[31,] 0.0042254150 0.05263158 0.007894584 -0.54479866    0.585892002
[32,] 0.0017737008 0.03947368 0.006098499 -0.48275821    0.629267429
[33,] 0.0001736036 0.01315789 0.002063884 -0.28580881    0.775024563
[34,] 0.0092272618 0.03947368 0.006002982 -0.39038265    0.696253617
[35,] 0.0031044434 0.06578947 0.009754139 -0.63470128    0.525623256
[36,] 0.0029903222 0.02631579 0.004063417 -0.36591874    0.714425716
[37,] 0.0029442098 0.01315789 0.002100421 -0.22285852    0.823645619
[38,] 0.0180641784 0.05263158 0.007888216 -0.38920403    0.697125223
[39,] 0.0059355717 0.03947368 0.006029376 -0.43191914    0.665800184
[40,] 0.0032814385 0.06578947 0.009734525 -0.63354645    0.526376861
[41,] 0.0075885184 0.05263158 0.007908250 -0.50650962    0.612498940
[42,] 0.0038576245 0.02631579 0.004064275 -0.35227572    0.724631498
[43,] 0.0011511480 0.02631579 0.004080383 -0.39394926    0.693618502
[44,] 0.0041121198 0.03947368 0.006062782 -0.45414601    0.649723737
[45,] 0.0025532004 0.03947368 0.006000693 -0.47661388    0.633637101
[46,] 0.0066350187 0.03947368 0.006594826 -0.40437456    0.685937304
[47,] 0.0009921345 0.01315789 0.002133375 -0.26339386    0.792247020
[48,] 0.0092649289 0.06578947 0.009738159 -0.57279423    0.566784026
[49,] 0.0525524825 0.03947368 0.006029684  0.16843044    0.866244663
[50,] 0.0529041930 0.02631579 0.004060305  0.41726596    0.676483887
[51,] 0.0504008403 0.01315789 0.002065770  0.81941327    0.412550669
[52,] 0.0064343489 0.07894737 0.011558599 -0.67447118    0.500011800
[53,] 0.0022032196 0.02631579 0.004067712 -0.37806669    0.705381053
[54,] 0.0202649221 0.02631579 0.004060690 -0.09495497    0.924350594
[55,] 0.0063208919 0.03947368 0.006052136 -0.42615323    0.669996196
[56,] 0.0120639478 0.05263158 0.007898675 -0.45645978    0.648059389
[57,] 0.0079439193 0.05263158 0.007960896 -0.50084879    0.616477544
[58,] 0.0071631695 0.05263158 0.007906174 -0.51135981    0.609099135
[59,] 0.0076163930 0.05263158 0.007914888 -0.50598386    0.612867981
[60,] 0.0008813427 0.01315789 0.002069207 -0.26988232    0.787250791
[61,] 0.0225222310 0.07894737 0.011519063 -0.52573156    0.599074730
[62,] 0.0074231980 0.03947368 0.006009671 -0.41343694    0.679286515
[63,] 0.0014919135 0.01315789 0.002066270 -0.25664198    0.797455162
[64,] 0.2224029785 0.06578947 0.010360800  1.53862423    0.123896059
[65,] 0.0675325754 0.05263158 0.007996094  0.16663889    0.867654193
[66,] 0.0019677677 0.02631579 0.004060933 -0.38207690    0.702404325
[67,] 0.0242434216 0.03947368 0.006001954 -0.19658983    0.844148528
[68,] 0.2259809615 0.03947368 0.006178100  2.37283918    0.017651948
[69,] 0.0364839208 0.05263158 0.007905609 -0.18161089    0.855888103
[70,] 0.0552205480 0.02631579 0.004943791  0.41109227    0.681004878
[71,] 0.0330707115 0.02631579 0.004065189  0.10594488    0.915626085
[72,] 0.0267502119 0.03947368 0.006053649 -0.16352985    0.870101275
[73,] 0.0046162337 0.02631579 0.004060391 -0.34053906    0.733450616
[74,] 0.0062364667 0.03947368 0.006269013 -0.41978322    0.674643821
[75,] 0.0560761530 0.05263158 0.008375989  0.03763722    0.969976936
[76,] 0.0444054673 0.05263158 0.007948543 -0.09226794    0.926485158
[77,] 0.0014557954 0.02631579 0.004065417 -0.38989571    0.696613665
attr(,"cluster")
 [1] Low  High Low  High Low  Low  Low  Low  High Low  High Low  Low  Low  Low 
[16] Low  Low  Low  Low  Low  High Low  Low  Low  Low  Low  Low  Low  Low  Low 
[31] Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low 
[46] High High Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  Low 
[61] Low  Low  Low  High Low  Low  Low  High Low  High Low  Low  Low  High High
[76] Low  Low 
Levels: Low High
attr(,"gstari")
[1] FALSE
attr(,"call")
localG(x = profit_all$total_value, listw = wm62_lw_profit)
attr(,"class")
[1] "localG"</code></pre>
</div>
</div>
<p>The output of the localG() function is a vector containing G or G* values, with the following attributes: - “gstari”: Indicates whether the G* version of the statistic was used (TRUE or FALSE). - “call”: Stores the function call. - “class”: Set to “localG”, identifying the object type.</p>
<p>The Gi statistic is represented as a Z-score, where larger values signify stronger clustering. The sign of the value indicates the type of cluster: positive values point to high-value clusters (hotspots), while negative values indicate low-value clusters (cold spots).</p>
<p>To merge the Gi values with their corresponding geographic data in the Hunan spatial dataframe, use the following code to join the results to the profit sf object. This allows for the spatial visualization of clusters within the geographic data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>profit.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(profit_all, <span class="fu">as.matrix</span>(gi.fixed_profit)) <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_fixed =</span> as.matrix.gi.fixed_profit.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>the code chunk above actually performs three tasks. First, it convert the output vector (i.e.&nbsp;gi.fixed) into r matrix object by using as.matrix(). Next, cbind() is used to join hunan@data and gi.fixed matrix to produce a new SpatialPolygonDataFrame called hunan.gi. Lastly, the field name of the gi values is renamed to gstat_fixed by using rename().</p>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>Gimap <span class="ot">&lt;-</span><span class="fu">tm_shape</span>(profit.gi) <span class="sc">+</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_fixed"</span>, </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-RdBu"</span>,</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Gi"</span>) <span class="sc">+</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(profits, Gimap, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the above plot, we can infer that ‘hot spots’ tend to be neighboring regions and likewise for the cold spots too. We see high value (hot) clusters in the Central region of Thailand, particularly around Bangkok and the Bangkok Metropolitan Region as well as in the Southern Region, while the majority of the western part of Thailand is ‘cold’.</p>
</div>
</div>
</div>
</section>
</section>
<section id="emerging-hot-spot-analysis" class="level4">
<h4 class="anchored" data-anchor-id="emerging-hot-spot-analysis">2.4.3.3.2 Emerging Hot-Spot Analysis</h4>
<p>We will now conduct Emerging Hot-spot analysis to see if there are any trends popping up recently.</p>
<p>Emerging Hot Spot Analysis (EHSA) is a spatio-temporal analysis method for revealing and describing how hot spot and cold spot areas evolve over time. The analysis consist of four main steps:</p>
<ul>
<li><p>Building a space-time cube,</p></li>
<li><p>Calculating Getis-Ord local Gi* statistic for each bin by using an FDR correction,</p></li>
<li><p>Evaluating these hot and cold spot trends by using Mann-Kendall trend test,</p></li>
<li><p>Categorising each study area location by referring to the resultant trend z-score and p-value for each location with data, and with the hot spot z-score and p-value for each bin.</p></li>
</ul>
<section id="space-time-cube" class="level5">
<h5 class="anchored" data-anchor-id="space-time-cube">2.4.3.3.2.1 Space-Time Cube</h5>
<p>We now use the&nbsp;<a href="https://sfdep.josiahparry.com/reference/spacetime.html"><code>spacetime()</code></a>&nbsp;function of the sfdep package to create a spatio-temporal cube.</p>
<details>
<summary>
Click to show/hide code
</summary>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>profit_all_temporal<span class="ot">=</span>tourists_temporal<span class="sc">%&gt;%</span><span class="fu">filter</span>(variable<span class="sc">==</span><span class="st">'revenue_all'</span>)</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename province_eng to ADM1_EN using base R in order to facilitate the creation of the spacetime cube.</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(profit_all_temporal)[<span class="fu">names</span>(profit_all_temporal) <span class="sc">==</span> <span class="st">"province_eng"</span>] <span class="ot">&lt;-</span> <span class="st">"ADM1_EN"</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Space-time by month</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>profits_st <span class="ot">&lt;-</span> <span class="fu">spacetime</span>(profit_all_temporal, province,</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.loc_col =</span> <span class="st">"ADM1_EN"</span>,</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">.time_col =</span> <span class="st">"date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To verify if the cube has been create, we implement the is_spacetime_cube() function of the sfdep package as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is_spacetime_cube</span>(profits_st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Based on the above output, we can confirm that it has been created as intended.</p>
</section>
<section id="deriving-spatial-weights" class="level5">
<h5 class="anchored" data-anchor-id="deriving-spatial-weights">2.4.3.3.2.2 Deriving Spatial Weights</h5>
<p>We implement the below code chunk to identify neighbors and calculate the inverse-distance weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>profits_nb <span class="ot">&lt;-</span> profits_st <span class="sc">%&gt;%</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">activate</span>(<span class="st">"geometry"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nb =</span> <span class="fu">include_self</span>(</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_contiguity</span>(geometry)),</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">wt =</span> <span class="fu">st_inverse_distance</span>(nb, </span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>                             geometry, </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">scale =</span> <span class="dv">1</span>,</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_nbs</span>(<span class="st">"nb"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_wts</span>(<span class="st">"wt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="insights-box">
<ul>
<li><p><code>activate()</code> of dplyr package is used to activate the geometry context</p></li>
<li><p><code>mutate()</code> of dplyr package is used to create two new columns <em>nb</em> and <em>wt</em>.</p></li>
<li><p>Then we will activate the data context again and copy over the nb and wt columns to each time-slice using <code>set_nbs()</code> and <code>set_wts()</code></p>
<ul>
<li>row order is very important so do not rearrange the observations after using <code>set_nbs()</code> or <code>set_wts()</code>.</li>
</ul></li>
</ul>
</div>
</section>
<section id="computing-gi-stats" class="level5">
<h5 class="anchored" data-anchor-id="computing-gi-stats">2.4.3.3.3 Computing Gi Stats</h5>
<p>We can use these new columns to manually calculate the local Gi for each location. We do this by grouping by&nbsp;<em>Year</em>&nbsp;and using the&nbsp;<code>local_gstar_perm()</code>&nbsp;function of the sfdep package. After this, we use the&nbsp;<code>unnest()</code>&nbsp;function to unnest the&nbsp;<em>gi_star</em>&nbsp;column of the newly created&nbsp;<em>gi_starts</em>&nbsp;data.frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the local G* statistics</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>gi_stars <span class="ot">&lt;-</span> profits_nb <span class="sc">%&gt;%</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gi_star =</span> <span class="fu">local_gstar_perm</span>(</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>    value,  <span class="co"># Make sure it's numeric</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>    nb,                   <span class="co"># Neighbors</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>    wt                    <span class="co"># Weights</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mann-kendall-test" class="level5">
<h5 class="anchored" data-anchor-id="mann-kendall-test">2.4.3.3.4 <strong>Mann-Kendall Test</strong></h5>
<p>With the above Gi calculations, we can now conduct the Mann-Kendall test to evaluate selected locations, the top 5 most lucrative regions, for a trend.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true">Bangkok</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false">Krabi</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-3" role="tab" aria-controls="tabset-19-3" aria-selected="false">Phuket</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-4" role="tab" aria-controls="tabset-19-4" aria-selected="false">Chon Buri</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-5" role="tab" aria-controls="tabset-19-5" aria-selected="false">Chiang Mai</a></li></ul>
<div class="tab-content">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>bkk <span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span> </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Bangkok"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, date, gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now produce a plot by using the ggplot package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> bkk, </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> gi_star)) <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-107-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>kra <span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span> </span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Krabi"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, date, gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now produce a plot by using the ggplot package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> kra, </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> gi_star)) <span class="sc">+</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-109-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-19-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>phk<span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Phuket"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, date, gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now produce a plot to visualize this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> phk, </span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> gi_star)) <span class="sc">+</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-19-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>cbr<span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Chon Buri"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, date, gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now produce a plot for the same</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> cbr, </span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> gi_star)) <span class="sc">+</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-113-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-19-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>chm<span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Chiang Mai"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ADM1_EN, date, gi_star)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now create a plot for the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> chm, </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> gi_star)) <span class="sc">+</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-115-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>For all of these regions, besides Chiang Mai, we see a sharp drop between 2021 and 2022 however for the most part none of these regions reach their peaks between 2020 and 2022, which was when the world was hit by a global pandemic.</p>
<div class="insights-box">
<p>Alternatively, we can also create an interactive plot using the ggplotly() function of the plotly package.</p>
<p>The code chunk below can be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Interactive plot for Bangkok </span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> bkk, </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> date, </span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> gi_star)) <span class="sc">+</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>We now generate the report for the Mann Kendall Test by implementing the below code chunk.</p>
<p>A Monotonic series or function is one that only increases (or decreases) and never changes direction. So long as the function either stays flat or continues to increase, it is monotonic.</p>
<ul>
<li><p><strong>H0: No monotic trend.</strong></p></li>
<li><p><strong>H1: Monotonic trend is present</strong></p></li>
</ul>
<div class="insights-box">
<p>Tau ranges between -1 and 1 where:</p>
<ul>
<li><p>-1 is a perfectly decreasing series.</p></li>
<li><p>1 is a perfectly increasing series.</p></li>
</ul>
</div>
<p>We implement the below code chunk to obtain the required report.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true">Bangkok</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false">Krabi</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-3" role="tab" aria-controls="tabset-20-3" aria-selected="false">Chiang Mai</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-4" role="tab" aria-controls="tabset-20-4" aria-selected="false">Chon Buri</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-5" role="tab" aria-controls="tabset-20-5" aria-selected="false">Phuket</a></li></ul>
<div class="tab-content">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>bkk <span class="sc">%&gt;%</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span> </span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
     tau     sl     S     D   varS
   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 -0.185 0.0587  -227  1225 14292.</code></pre>
</div>
</div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>kra <span class="sc">%&gt;%</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span> </span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
     tau          sl     S     D   varS
   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 -0.484 0.000000735  -593  1225 14292.</code></pre>
</div>
</div>
</div>
<div id="tabset-20-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>chm <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span> </span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    tau      sl     S     D   varS
  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 0.290 0.00306   355  1225 14292.</code></pre>
</div>
</div>
</div>
<div id="tabset-20-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>cbr <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span> </span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
     tau    sl     S     D   varS
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 0.0514 0.604    63  1225 14292.</code></pre>
</div>
</div>
</div>
<div id="tabset-20-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>phk <span class="sc">%&gt;%</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span> </span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    tau    sl     S     D   varS
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 0.154 0.116   189  1225 14292.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="note-box">
<p>Note that&nbsp;<code>sl</code>in the output above is the p-value in this situation.</p>
</div>
</section>
<section id="mann-kendall-test-data-frame" class="level5">
<h5 class="anchored" data-anchor-id="mann-kendall-test-data-frame">2.4.3.3.5 <strong>Mann-Kendall Test Data-Frame</strong></h5>
<p>We can perform the above steps for every location by using the group_by() function of the dplyr package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="ot">&lt;-</span> gi_stars <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM1_EN) <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mk =</span> <span class="fu">list</span>(</span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unclass</span>(</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>      Kendall<span class="sc">::</span><span class="fu">MannKendall</span>(gi_star)))) <span class="sc">%&gt;%</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest_wider</span>(mk)</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ehsa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  ADM1_EN           tau     sl     S     D   varS
  &lt;chr&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Amnat Charoen -0.202  0.0396  -247  1225 14292.
2 Ang Thong      0.0449 0.651     55  1225 14292.
3 Bangkok       -0.185  0.0587  -227  1225 14292.
4 Bueng Kan     -0.110  0.262   -135  1225 14292.
5 Buri Ram       0.0678 0.493     83  1225 14292.
6 Chachoengsao  -0.229  0.0192  -281  1225 14292.</code></pre>
</div>
</div>
<p>We can sort the data-frame to highlight emerging hot/cold spots by implementing the below code chunk.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>emerging <span class="ot">&lt;-</span> ehsa <span class="sc">%&gt;%</span> </span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sl, <span class="fu">abs</span>(tau)) <span class="sc">%&gt;%</span> </span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(emerging)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  ADM1_EN                tau          sl     S     D   varS
  &lt;chr&gt;                &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Trang               -0.517 0.000000125  -633  1225 14292.
2 Phayao               0.496 0.000000358   607  1225 14292.
3 Nakhon Si Thammarat -0.489 0.000000567  -599  1225 14292.
4 Krabi               -0.484 0.000000735  -593  1225 14292.
5 Surat Thani         -0.484 0.000000735  -593  1225 14292.
6 Phangnga            -0.399 0.0000446    -489  1225 14292.</code></pre>
</div>
</div>
</section>
<section id="emerging-hot-spot-analysis-1" class="level5">
<h5 class="anchored" data-anchor-id="emerging-hot-spot-analysis-1">2.4.3.3.6 Emerging Hot-Spot Analysis</h5>
<p>We now perform EHSA by using the <a href="https://sfdep.josiahparry.com/reference/emerging_hotspot_analysis.html"><code>emerging_hotspot_analysis()</code></a> function of the sfdep package.</p>
<p>It takes a spacetime object x (i.e: profit_st), and the quoted name of the variable of interest (i.e.&nbsp;GDPPC) as the .var argument.</p>
<p>The <code>k</code> argument is used to specify the number of time lags which is set to 1 by default.</p>
<p><code>nsim</code> is number of simulations to be performed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>ehsa <span class="ot">&lt;-</span> <span class="fu">emerging_hotspot_analysis</span>(</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> profits_st, </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">.var =</span> <span class="st">"value"</span>, </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">1</span>, </span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">99</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now implement various ggplot2 functions to reveal the distributions of EHSA classes as a bar chart.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ehsa,</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> classification)) <span class="sc">+</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-125-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can proceed with Visualizing EHSA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>thai_ehsa <span class="ot">&lt;-</span> province <span class="sc">%&gt;%</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ehsa,</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(ADM1_EN <span class="sc">==</span> location))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now implement functions of the tmap package to produce a visualization for the above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>ehsa_sig <span class="ot">&lt;-</span> thai_ehsa  <span class="sc">%&gt;%</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.1</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thai_ehsa) <span class="sc">+</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ehsa_sig) <span class="sc">+</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"classification"</span>) <span class="sc">+</span> </span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">'ADM1_EN'</span>, <span class="at">size=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex02_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can further look at this in greater detail by each location as well if required.</p>


</section>
</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>