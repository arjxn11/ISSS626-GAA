<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arjun Singh">
<meta name="dcterms.date" content="2024-09-02">

<title>Take Home Exercise 1 – ISSS626-GAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS626-GAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1- Geospatial Data Wrangling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01b.html">
 <span class="dropdown-text">Hands-on Exercise 1 - Part 2- Choropleth Mapping</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02a.html">
 <span class="dropdown-text">Hands-on Exercise 2 - Part 1- 1st Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02b.html">
 <span class="dropdown-text">Hands-on Exercise 2 - Part 2- 2nd Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands On Exercise 3- Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands On Exercise 4- Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05a.html">
 <span class="dropdown-text">Hands On Exercise 5- Global Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05b.html">
 <span class="dropdown-text">Hands On Exercise 5- Part 2- Local Measures of Spatial Autocorrelation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex1/Take-home_Ex01.html">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In Class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex2/In-class_Ex2.html">
 <span class="dropdown-text">In Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex3/In-class_Ex3.html">
 <span class="dropdown-text">In Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex4/In-class_Ex4.html">
 <span class="dropdown-text">In Class Exercise 4</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">1 Introduction</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">1.1 Objectives</a></li>
  <li><a href="#data-and-packages" id="toc-data-and-packages" class="nav-link" data-scroll-target="#data-and-packages">1.2 Data and Packages</a>
  <ul class="collapse">
  <li><a href="#aspatial-data" id="toc-aspatial-data" class="nav-link" data-scroll-target="#aspatial-data">1.2.1 Aspatial Data</a></li>
  <li><a href="#geospatial-data" id="toc-geospatial-data" class="nav-link" data-scroll-target="#geospatial-data">1.2.2 Geospatial Data</a></li>
  <li><a href="#data-preparation-and-wrangling" id="toc-data-preparation-and-wrangling" class="nav-link" data-scroll-target="#data-preparation-and-wrangling">1.2.3 Data Preparation and Wrangling</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">1.3 Exploratory Data Analysis</a></li>
  <li><a href="#spatial-analysis" id="toc-spatial-analysis" class="nav-link" data-scroll-target="#spatial-analysis">1.4 Spatial Analysis</a>
  <ul class="collapse">
  <li><a href="#kernel-density-estimation-kde" id="toc-kernel-density-estimation-kde" class="nav-link" data-scroll-target="#kernel-density-estimation-kde">1.4.1 Kernel Density Estimation (KDE)</a>
  <ul class="collapse">
  <li><a href="#dealing-with-duplicates" id="toc-dealing-with-duplicates" class="nav-link" data-scroll-target="#dealing-with-duplicates">1.4.1.1 Dealing with Duplicates</a></li>
  <li><a href="#creating-an-owin-object" id="toc-creating-an-owin-object" class="nav-link" data-scroll-target="#creating-an-owin-object">1.4.1.2 Creating an owin object</a></li>
  <li><a href="#computing-kde-using-automatic-bandwidth-selection" id="toc-computing-kde-using-automatic-bandwidth-selection" class="nav-link" data-scroll-target="#computing-kde-using-automatic-bandwidth-selection">1.4.1.3 Computing KDE using automatic bandwidth selection</a></li>
  <li><a href="#converting-the-kde-output-into-a-grid-object" id="toc-converting-the-kde-output-into-a-grid-object" class="nav-link" data-scroll-target="#converting-the-kde-output-into-a-grid-object">1.4.1.4 Converting the KDE output into a grid object</a></li>
  </ul></li>
  <li><a href="#second-order-spatial-point-pattern-analysis." id="toc-second-order-spatial-point-pattern-analysis." class="nav-link" data-scroll-target="#second-order-spatial-point-pattern-analysis.">1.4.2 Second-Order Spatial Point Pattern Analysis.</a>
  <ul class="collapse">
  <li><a href="#calculating-g-function-estimates-and-testing-for-complete-spatial-randomness" id="toc-calculating-g-function-estimates-and-testing-for-complete-spatial-randomness" class="nav-link" data-scroll-target="#calculating-g-function-estimates-and-testing-for-complete-spatial-randomness"><strong>1.4.2.1 Calculating G-function estimates and testing for Complete Spatial Randomness</strong></a></li>
  </ul></li>
  <li><a href="#spatial-weights" id="toc-spatial-weights" class="nav-link" data-scroll-target="#spatial-weights">1.4.3 Spatial Weights</a>
  <ul class="collapse">
  <li><a href="#computing-contiguity-spatial-weights" id="toc-computing-contiguity-spatial-weights" class="nav-link" data-scroll-target="#computing-contiguity-spatial-weights">1.4.3.1 Computing Contiguity Spatial Weights</a></li>
  <li><a href="#visualizing-contiguity-weights" id="toc-visualizing-contiguity-weights" class="nav-link" data-scroll-target="#visualizing-contiguity-weights">1.4.3.2 Visualizing contiguity weights</a></li>
  <li><a href="#adaptive-distance-weight-matrix" id="toc-adaptive-distance-weight-matrix" class="nav-link" data-scroll-target="#adaptive-distance-weight-matrix">1.4.3.3 Adaptive Distance Weight Matrix</a></li>
  <li><a href="#row-standardized-weights-matrix" id="toc-row-standardized-weights-matrix" class="nav-link" data-scroll-target="#row-standardized-weights-matrix">1.4.3.4 Row standardized weights matrix</a></li>
  <li><a href="#spatial-window-average" id="toc-spatial-window-average" class="nav-link" data-scroll-target="#spatial-window-average">1.4.3.5 Spatial Window Average</a></li>
  </ul></li>
  <li><a href="#spatial-autocorrelation-morans-i-test." id="toc-spatial-autocorrelation-morans-i-test." class="nav-link" data-scroll-target="#spatial-autocorrelation-morans-i-test.">1.4.4 Spatial Autocorrelation: Morans I test.</a>
  <ul class="collapse">
  <li><a href="#monte-carlo-morans-i" id="toc-monte-carlo-morans-i" class="nav-link" data-scroll-target="#monte-carlo-morans-i">1.4.4.1 Monte Carlo Moran’s I</a></li>
  <li><a href="#visualizing-monte-carlo-morans-i" id="toc-visualizing-monte-carlo-morans-i" class="nav-link" data-scroll-target="#visualizing-monte-carlo-morans-i">1.4.4.2 Visualizing Monte Carlo Moran’s I</a></li>
  <li><a href="#local-morans-i" id="toc-local-morans-i" class="nav-link" data-scroll-target="#local-morans-i">1.4.4.3 Local Morans I</a></li>
  <li><a href="#mapping-the-local-morans-i" id="toc-mapping-the-local-morans-i" class="nav-link" data-scroll-target="#mapping-the-local-morans-i">1.4.4.4 Mapping the local Moran’s I</a></li>
  <li><a href="#mapping-local-morans-i-p-values" id="toc-mapping-local-morans-i-p-values" class="nav-link" data-scroll-target="#mapping-local-morans-i-p-values">1.4.4.5 Mapping Local Moran’s I p-values</a></li>
  <li><a href="#mapping-both-local-morans-i-values-and-p-values" id="toc-mapping-both-local-morans-i-values-and-p-values" class="nav-link" data-scroll-target="#mapping-both-local-morans-i-values-and-p-values">1.4.4.6 Mapping both local Moran’s I values and p-values</a></li>
  </ul></li>
  <li><a href="#hot-and-cold-spot-areas" id="toc-hot-and-cold-spot-areas" class="nav-link" data-scroll-target="#hot-and-cold-spot-areas">1.4.5 Hot and Cold Spot Areas</a>
  <ul class="collapse">
  <li><a href="#getis-and-ords-g-statistics" id="toc-getis-and-ords-g-statistics" class="nav-link" data-scroll-target="#getis-and-ords-g-statistics">1.4.5.1 Getis and Ord’s G-Statistics</a></li>
  <li><a href="#deriving-distance-based-weight-matrix" id="toc-deriving-distance-based-weight-matrix" class="nav-link" data-scroll-target="#deriving-distance-based-weight-matrix">1.4.5.2 Deriving Distance Based Weight Matrix</a></li>
  <li><a href="#computing-gi-statistics-using-fixed-distance" id="toc-computing-gi-statistics-using-fixed-distance" class="nav-link" data-scroll-target="#computing-gi-statistics-using-fixed-distance">1.4.5.3 Computing Gi statistics using Fixed Distance</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">1.5 Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arjun Singh </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 2, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">September 22, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>1 Introduction</h1>
<p>According to the World Health Organisation (WHO), road traffic accidents cause approximately 1.19 million deaths annually and result in between 20 and 50 million people with being down with non-fatal injuries. Over half of all road traffic deaths occur among vulnerable road users, such as pedestrians, cyclists and motorcyclists.</p>
<p>Road traffic injuries are the leading cause of death for children and young adults aged 5–29 while two-thirds of road traffic fatalities occur among people of working age (18–59 years). 9 in 10 fatalities on the roads occur in low and middle-income countries, even though these countries have only around 60% of the world’s vehicles.</p>
<p>In addition to the human suffering caused by road traffic injuries, they also inflict a heavy economic burden on victims and their families, both through treatment costs for the injured and through loss of productivity of those killed or disabled. More broadly, road traffic injuries have a serious impact on national economies, costing countries 3% of their annual GDP.</p>
<p>Thailand’s roads are the deadliest in Southeast Asia and among the worst in the world, according to the World Health Organisation. About 20,000 people die in road accidents each year, or about 56 deaths a day (WHO).</p>
<p>Between 2014 and 2021, Thailand experienced a notable increase in accidents. Specifically, 19% of all accidents in Thailand occurred on the national highways, which constituted the primary public thoroughfares connecting various regions, provinces, districts, and significant locations within a comprehensive network.</p>
<p>Within the broader context of accidents across the country, there existed a considerable 66% likelihood of encountering accident-prone zones, often termed ‘<strong>black spots</strong>,’ distributed as follows: 66% on straight road segments, 13% at curves, 6% at median points of cross-shaped intersections, 5% at T-shaped intersections and Y-shaped intersections, 3% at cross-shaped intersections, 2% on bridges, and 2% on steep slopes, respectively.</p>
</section>
<section id="objectives" class="level1">
<h1>1.1 Objectives</h1>
<p>For the most part, road accidents can be attributed to two key factors- behavioral factors. such as driving skill, and environmental factors, such as heavy rain.</p>
<p>For this exercise, we will implement Spatial and Spatio-Temporal Point Pattern Analysis methods to discover the underlying factors behind the accidents in the Bangkok Metropolitan Region.</p>
</section>
<section id="data-and-packages" class="level1">
<h1>1.2 Data and Packages</h1>
<p>For the purpose of this study, we will use the following three data-frames.</p>
<ul>
<li><p><a href="https://www.kaggle.com/datasets/thaweewatboy/thailand-road-accident-2019-2022">Thailand Road Accidents [2019-2022]</a>, sourced from Kaggle.</p></li>
<li><p><a href="https://data.humdata.org/dataset/hotosm_tha_roads">Thailand Roads Open Street Map Export</a>, sourced from Humanitarian Data Exchange.</p></li>
<li><p><a href="https://data.humdata.org/dataset/cod-ab-tha?">Thailand Subnational Administrative Boundaries</a> sourced from Humanitarian Data Exchange.</p></li>
</ul>
<p>You can click the link embedded on each of these data-frames to learn more.</p>
<p>We will use the following R packages for our analysis:</p>
<ul>
<li><p><code>sf</code>, a relatively new R package specially designed to import, manage and process vector-based geospatial data in R.</p></li>
<li><p><code>spatstat</code>, which has a wide range of useful functions for point pattern analysis. In this hands-on exercise, it will be used to perform 1st- and 2nd-order spatial point patterns analysis and derive kernel density estimation (KDE) layer.</p></li>
<li><p><code>raster</code>, which reads, writes, manipulates, analyses and model of gridded spatial data (i.e.&nbsp;raster). In this hands-on exercise, it will be used to convert image output generate by spatstat into raster format.</p></li>
<li><p><code>tidyverse</code> simplifies spatial analysis by offering a consistent and efficient framework that facilitates working with spatial data.</p></li>
<li><p><code>tmap</code> which provides functions for plotting cartographic quality static point patterns maps or interactive maps by using leaflet API.</p></li>
<li><p><code>spNetwork</code> which provides functions to perform Spatial Point Patterns Analysis such as kernel density estimation (KDE) and K-function on network. It also can be used to build spatial matrices (‘listw’ objects like in ‘spdep’ package) to conduct any kind of traditional spatial analysis with spatial weights based on reticular distances.</p></li>
</ul>
<p>We import them into our environment using the code chunk below. The <strong>p_load</strong>() function of the <strong>pacman</strong> package is used for this.</p>
<details>
<summary>
Click to show/hide code chunk
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, spatstat, raster, tidyverse, tmap, spNetwork, spdep, knitr) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p>We will now import the data-frames mentioned above into our environment. We save them as RDS files in the interest of computational efficiency.</p>
<section id="aspatial-data" class="level2">
<h2 class="anchored" data-anchor-id="aspatial-data">1.2.1 Aspatial Data</h2>
<p>We first import in the data-frame contained data of all accidents in the Bangkok Metropolitan Region. For this, we implement the read_rds() function as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rdacc_sf<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/acc_sf"</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hourofday=</span> <span class="fu">hour</span>(incident_datetime))<span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">traffic_period =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define peak hours: 7-9 AM and 4-7 PM (16-19 in 24-hour format)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    hourofday <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> hourofday <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Peak"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    hourofday <span class="sc">&gt;=</span> <span class="dv">16</span> <span class="sc">&amp;</span> hourofday <span class="sc">&lt;=</span> <span class="dv">19</span> <span class="sc">~</span> <span class="st">"Peak"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Off-Peak"</span>  <span class="co"># Everything else is off-peak</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(rdacc_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32647 
  wkt:
PROJCRS["WGS 84 / UTM zone 47N",
    BASEGEOGCRS["WGS 84",
        ENSEMBLE["World Geodetic System 1984 ensemble",
            MEMBER["World Geodetic System 1984 (Transit)"],
            MEMBER["World Geodetic System 1984 (G730)"],
            MEMBER["World Geodetic System 1984 (G873)"],
            MEMBER["World Geodetic System 1984 (G1150)"],
            MEMBER["World Geodetic System 1984 (G1674)"],
            MEMBER["World Geodetic System 1984 (G1762)"],
            MEMBER["World Geodetic System 1984 (G2139)"],
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ENSEMBLEACCURACY[2.0]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 47N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",99,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Navigation and medium accuracy spatial referencing."],
        AREA["Between 96°E and 102°E, northern hemisphere between equator and 84°N, onshore and offshore. China. Indonesia. Laos. Malaysia - West Malaysia. Mongolia. Myanmar (Burma). Russian Federation. Thailand."],
        BBOX[0,96,84,102]],
    ID["EPSG",32647]]</code></pre>
</div>
</div>
</section>
<section id="geospatial-data" class="level2">
<h2 class="anchored" data-anchor-id="geospatial-data">1.2.2 Geospatial Data</h2>
<p>We import the OpenStreetMap export of Thailand into our environment using the st_read() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>road_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/rawdata"</span>, <span class="at">layer=</span><span class="st">"hotosm_tha_roads_lines_shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>It is important to note the details shown in the output above. Most important takeaway from the above output is that there is no CRS information. This information is crucial as it informs our data preparation steps. We must ensure that the right CRS information is set in order to carry out analysis.</p>
</div>
<p>Below, we import the boundary data. <code>map_sf</code> is the boundary data at the province level (ADM1), while <code>map2_sf</code> is the boundary data at the district level (ADM2). We will be using both over the course of our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>map_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/rawdata"</span>, <span class="at">layer=</span><span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex1\data\rawdata' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>map2_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/rawdata"</span>, <span class="at">layer=</span><span class="st">"tha_admbnda_adm2_rtsd_20220121"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm2_rtsd_20220121' from data source 
  `C:\arjxn11\ISSS626-GAA\Take-home_Ex\Take-home_Ex1\data\rawdata' 
  using driver `ESRI Shapefile'
Simple feature collection with 928 features and 19 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>After importing the boundary data, we notice immediately that the EPSG code isn’t accurate. The EPSG code of Thailand is 32647 while the data-frame has an EPSG code of 4326.</p>
<p>We use the st_transform() function to convert the EPSG code to the correct value of 32647.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>map_sf<span class="ot">=</span><span class="fu">st_transform</span>(map_sf,<span class="at">crs =</span> <span class="dv">32647</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>map2_sf<span class="ot">=</span><span class="fu">st_transform</span>(map2_sf,<span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given that the OSM data-frame has no CRS information, we will first initialize it to WGS84 using the default EPSG code of 4326 by using the st_set_crs() function of the sf package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>road_sf<span class="ot">=</span><span class="fu">st_set_crs</span>(road_sf, <span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will then implement the st_crs() function to verify if the boundary data has the accurate CRS information after we transformed it above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(map_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32647 
  wkt:
PROJCRS["WGS 84 / UTM zone 47N",
    BASEGEOGCRS["WGS 84",
        ENSEMBLE["World Geodetic System 1984 ensemble",
            MEMBER["World Geodetic System 1984 (Transit)"],
            MEMBER["World Geodetic System 1984 (G730)"],
            MEMBER["World Geodetic System 1984 (G873)"],
            MEMBER["World Geodetic System 1984 (G1150)"],
            MEMBER["World Geodetic System 1984 (G1674)"],
            MEMBER["World Geodetic System 1984 (G1762)"],
            MEMBER["World Geodetic System 1984 (G2139)"],
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ENSEMBLEACCURACY[2.0]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 47N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",99,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Navigation and medium accuracy spatial referencing."],
        AREA["Between 96°E and 102°E, northern hemisphere between equator and 84°N, onshore and offshore. China. Indonesia. Laos. Malaysia - West Malaysia. Mongolia. Myanmar (Burma). Russian Federation. Thailand."],
        BBOX[0,96,84,102]],
    ID["EPSG",32647]]</code></pre>
</div>
</div>
</section>
<section id="data-preparation-and-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation-and-wrangling">1.2.3 Data Preparation and Wrangling</h2>
<p>Given our area of interest is the Bangkok Metropolitan Region, we create a list of all provinces in this area in order to facilitate filtering for our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bmr_province<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Bangkok"</span>, <span class="st">"Samut Prakan"</span>, <span class="st">"Samut Sakhon"</span>, <span class="st">"Nonthaburi"</span>, <span class="st">"Nakhon Pathom"</span>, <span class="st">"Pathum Thani"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, we implement the filter() function in order to filter the boundary data, at the province and district level, as well as the accident data, down to our region of interest- the Bangkok Metropolitan Region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bmr_boundary<span class="ot">=</span>map_sf <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">%in%</span> bmr_province)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>bmr_boundary2<span class="ot">=</span>map2_sf <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">%in%</span> bmr_province)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>bmr_accsf<span class="ot">=</span>rdacc_sf <span class="sc">%&gt;%</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_en <span class="sc">%in%</span> bmr_province)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_bbox</span>(bmr_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     xmin      ymin      xmax      ymax 
 587893.5 1484413.7  712440.5 1579076.3 </code></pre>
</div>
</div>
<p>We now implement the st_crs() function in order to transform the EPSG code of the <code>road_sf</code> data-frame from 4326 to 32647. This allows us to have the accurate geometry values to facilitate future spatial joins, as well as analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If road_sf was originally in EPSG:4326, reproject it properly</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>road_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(road_sf, <span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After ensuring that the CRS values are consistent, we can proceed with implementing the st_intersection() function and join the two data-frames based on their geometries.</p>
<p>The st_intersection() function is applied at the province level below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bmr_roads<span class="ot">=</span><span class="fu">st_intersection</span>(map2_sf, road_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As earlier, we will save this as an RDS file in order to improve computational efficiency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(bmr_roads, <span class="st">"data/rds/bmrroads"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bmr_roads<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/bmrroads"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, the st_intersection() function is applied at the district level and saved as an RDS file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bmr_districts<span class="ot">=</span><span class="fu">st_intersection</span>(map2_sf, bmr_roads)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(<span class="st">"data/rds/bmr_districts_roads"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bmr_districts<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/bmr_districts_roads"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>1.3 Exploratory Data Analysis</h1>
<p>To start of our analysis, we will first create a simple bar plot using the ggplot2 package to visualize the number of accidents per province.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Summarize the number of accidents per province</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>accident_summary <span class="ot">&lt;-</span> bmr_accsf <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(province_en) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_accidents =</span> <span class="fu">n</span>())</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Visualize using ggplot2</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(accident_summary, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(province_en, total_accidents), <span class="at">y =</span> total_accidents)) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip coordinates for better readability if many provinces</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Total Accidents by Province"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Province"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Accidents"</span>) <span class="sc">+</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Bangkok appears to have the most accidents followed by Samut Prakan.</p>
<p>Below, we use the tmap package to plot a highly cartographic map to verify the above information. We also use a basemap, thanks to OpenStreetMap, to be able to understand further where accidents occur.</p>
<p>This interactive map allows us to click on a point and identify the reason for the accident, the time, the month amongst other factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set tmap to interactive view mode (optional for exploration)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the map with boundaries and accident points</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bmr_boundary2) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># Show the boundaries</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(bmr_accsf) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.01</span>) <span class="sc">+</span>  <span class="co"># Show accident points as red dots</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Switch back to static mode after rendering (if needed)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the map above, we can infer the Eastern and South-Eastern region seems to have a high concentration of road accidents. We will verify if this is true using Spatial Analysis techniques later on in this exercise.</p>
<p>There appears to be a significant amount of rollover/driving off the curve accidents on curvy roads, especially when it is rainy.</p>
<p>We further break it down and produce a hexagonal choropleth map to gain a more in-depth understanding of the distribution of accidents across the region.</p>
<p>Below, we start by initializing a variable <code>grid_size</code> (2000 meters), and then use the st_make_grid() function of the sf package to create a grid that covers our region of interest. After creating the grid, we will convert to an sf data-frame using the st_sf() function and then ensure that we only have hexagons within the region of interest by implementing the st_intersection() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>grid_size <span class="ot">&lt;-</span> <span class="dv">2000</span>  <span class="co"># Size of the grid cells in meters (adjust as necessary)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a hexagonal grid covering the BMR boundary</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>bmr_hex_grid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(bmr_boundary, <span class="at">cellsize =</span> grid_size, <span class="at">square =</span> <span class="cn">FALSE</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to an sf object and clip to the BMR boundary</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>bmr_hex_grid_sf <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">geometry =</span> bmr_hex_grid)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>bmr_hex_grid_sf <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(bmr_hex_grid_sf, bmr_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can create the map using functions of the tmap() package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count accidents in the hexagonal grid</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>accidents_in_hex_grid <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bmr_hex_grid_sf, bmr_accsf) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(geometry) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">accident_count =</span> <span class="fu">n</span>())</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a polygon heatmap using tmap for the hexagonal grid</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(accidents_in_hex_grid) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"accident_count"</span>, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Blues"</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span> <span class="st">"Accident Count (Hexagonal Grid)"</span>) <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">"Accident Heatmap (Hexagonal Grid)"</span>, </span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see above that the Eastern, especially towards Samut Prakan, region of the Bangkok Metropolitan region sees more accidents than the rest of the region. These hotspots are areas of interest and roads and speeding laws in these area must be looked at in greater detail and improved.</p>
<p>We will now implement the ggplot2 package to compare the number of accidents in the peak period vs the off-peak period in Bagnkok.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of accidents in Peak and Off-Peak periods</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>accident_counts_summary <span class="ot">&lt;-</span> bmr_accsf <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(traffic_period) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">accident_count =</span> <span class="fu">n</span>())</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar chart showing the number of accidents in Peak vs Off-Peak</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> accident_counts_summary, <span class="fu">aes</span>(<span class="at">x =</span> traffic_period, <span class="at">y =</span> accident_count)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span>  <span class="co"># Bar chart with specified accident counts</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of Accidents: Peak vs Off-Peak"</span>, </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Traffic Period"</span>, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Accidents"</span>) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))  <span class="co"># Center the title</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Off-peak hours (Midnight to 7AM, 9AM to 4PM, 7PM to Midnight) sees more accidents in total.</p>
<p>We now move on and create a data-frame containing the count of the causes of each accident in the region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cause_count <span class="ot">&lt;-</span> bmr_accsf <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(presumed_cause) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can implement functions of the ggplot2 package to create a bar plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the top 5 causes</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>top_5_causes <span class="ot">&lt;-</span> cause_count <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>, count)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar chart showing only the top 5 presumed causes</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_5_causes, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(presumed_cause, <span class="sc">-</span>count), <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> count), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span>  <span class="co"># Add labels to show the count on top of the bars</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Presumed Causes of Accidents"</span>, </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Presumed Cause"</span>, </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Accident Count"</span>) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Speeding appears to be the primary cause of accidents, responsible for over 80% of all road accidents in the Bangkok Metropolitan Region.</p>
<p>We now convert the sf data-frames into spatial objects to store in our environment to facilitate future spatial analysis. We implement the as_Spatial() function of the sf package for this. We will then write large files as rds files in the interest of computational efficiency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bmr_acc <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(bmr_accsf)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>bmr <span class="ot">&lt;-</span> <span class="fu">as_Spatial</span>(bmr_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(osm_data, <span class="st">"data/rds/osm_data_spatial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>osm_data<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/osm_data_spatial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now convert the above obtain spatial object into Spatial Point and Spatial Polygon form respectively based on their geometry.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>bmracc_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(bmr_acc, <span class="st">"SpatialPoints"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>boundary_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(bmr, <span class="st">"SpatialPolygons"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we want to determine the road type that has the most accidents.</p>
<p>For this, we create a buffer first as accidents don’t always happen directly on the road but just off it using the st_buffer() function. A buffer of 5 meters is created.</p>
<p>After that, we can perform a spatial join using the st_join() function of the sf package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a small buffer around the accident points (e.g., 50 meters)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>accidents_buffered <span class="ot">=</span> <span class="fu">st_buffer</span>(bmr_accsf, <span class="at">dist =</span> <span class="dv">10</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the spatial join again with the buffered accident points</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>accidents_on_roads <span class="ot">=</span> <span class="fu">st_join</span>(accidents_buffered, bmr_roads, <span class="at">join =</span> st_intersects)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(accidents_on_roads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 51 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 627002.3 ymin: 1531930 xmax: 655421.7 ymax: 1533391
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 6 × 52
  acc_code incident_datetime   report_datetime     province_th province_en  
     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;              &lt;chr&gt;       &lt;chr&gt;        
1   571882 2019-01-01 02:25:00 2019-01-02 17:32:00 นครปฐม      Nakhon Pathom
2   571882 2019-01-01 02:25:00 2019-01-02 17:32:00 นครปฐม      Nakhon Pathom
3   571882 2019-01-01 02:25:00 2019-01-02 17:32:00 นครปฐม      Nakhon Pathom
4   571882 2019-01-01 02:25:00 2019-01-02 17:32:00 นครปฐม      Nakhon Pathom
5   600001 2019-01-01 03:00:00 2019-01-05 10:33:00 นนทบุรี       Nonthaburi   
6   600001 2019-01-01 03:00:00 2019-01-05 10:33:00 นนทบุรี       Nonthaburi   
# ℹ 47 more variables: agency &lt;chr&gt;, route &lt;chr&gt;, vehicle_type &lt;chr&gt;,
#   presumed_cause &lt;chr&gt;, accident_type &lt;chr&gt;,
#   number_of_vehicles_involved &lt;dbl&gt;, number_of_fatalities &lt;dbl&gt;,
#   number_of_injuries &lt;dbl&gt;, weather_condition &lt;chr&gt;, road_description &lt;chr&gt;,
#   slope_description &lt;chr&gt;, geometry &lt;POLYGON [m]&gt;, Month &lt;dbl&gt;,
#   Month_fac &lt;ord&gt;, dayofmonth &lt;int&gt;, hourofday &lt;int&gt;, traffic_period &lt;chr&gt;,
#   Shape_Leng &lt;dbl&gt;, Shape_Area &lt;dbl&gt;, ADM1_EN &lt;chr&gt;, ADM1_TH &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>We now count the number of accidents on each highway type by implementing the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count accidents by road type</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>accidents_by_road_type <span class="ot">=</span> accidents_on_roads <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(highway) <span class="sc">%&gt;%</span>  <span class="co"># Assuming the OSM roads data has a 'road_type' column</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">accident_count =</span> <span class="fu">n</span>())</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the summary</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(accidents_by_road_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 20 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 591267.5 ymin: 1486836 xmax: 710176.1 ymax: 1576530
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 20 × 3
   highway        accident_count                                        geometry
   &lt;chr&gt;                   &lt;int&gt;                              &lt;MULTIPOLYGON [m]&gt;
 1 construction             1217 (((629789.3 1496006, 629789.1 1496005, 629788.…
 2 cycleway                    8 (((665707.4 1532883, 665707.3 1532882, 665707.…
 3 footway                   218 (((627989 1495786, 627988.8 1495786, 627988.6 …
 4 motorway                 5366 (((661514.4 1506189, 661514 1506189, 661513.7 …
 5 motorway_link             939 (((664470.2 1506809, 664469.9 1506809, 664469.…
 6 path                       16 (((664563 1509817, 664562.5 1509817, 664562 15…
 7 primary                  2959 (((617714.5 1511678, 617714.2 1511678, 617713.…
 8 primary_link              484 (((626402.2 1497350, 626401.9 1497350, 626401.…
 9 residential               552 (((616749.7 1492543, 616749.4 1492542, 616749.…
10 secondary                2815 (((621676.4 1492259, 621676.1 1492259, 621675.…
11 secondary_link            329 (((637728 1498891, 637727.8 1498890, 637727.5 …
12 service                   723 (((617727.2 1487698, 617726.9 1487698, 617726.…
13 steps                      39 (((637789.9 1501257, 637789.8 1501256, 637789.…
14 tertiary                  411 (((616694.7 1490301, 616694.5 1490301, 616694.…
15 tertiary_link               9 (((683966 1504996, 683965.9 1504995, 683965.8 …
16 track                       4 (((682585.7 1518975, 682585.6 1518975, 682585.…
17 trunk                    2897 (((603768.7 1525407, 603768.4 1525406, 603768 …
18 trunk_link                289 (((639960.7 1500837, 639960.5 1500837, 639960.…
19 unclassified              122 (((622943.8 1491550, 622943.6 1491550, 622943.…
20 &lt;NA&gt;                      953 (((616483.2 1486841, 616482.9 1486841, 616482.…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>top_5_highway<span class="ot">=</span>accidents_by_road_type <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(accident_count))<span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now use the ggplot2 package to produce a barplot to facilitate visualization and understand what type of highways result in the most accidents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create bar plot</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_5_highway, <span class="fu">aes</span>(<span class="at">x =</span> highway, <span class="at">y =</span> accident_count, <span class="at">fill =</span> highway)) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Accident Count by highway Type"</span>, <span class="at">x =</span> <span class="st">"Highway Type"</span>, <span class="at">y =</span> <span class="st">"Number of Accidents"</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We will now single out the motorway to further determine what type of accidents are most common on them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for motorway and count causes of accidents</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>motorway_accidents_cause_count <span class="ot">&lt;-</span> accidents_on_roads <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(highway <span class="sc">==</span> <span class="st">"motorway"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(presumed_cause) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span>   <span class="co"># Sort by count in descending order</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)                 <span class="co"># Select top 5 causes</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a bar plot for the top 5 causes of accidents on motorways</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(motorway_accidents_cause_count, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(presumed_cause, count), <span class="at">y =</span> count, <span class="at">fill =</span> presumed_cause)) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip the axes for better readability</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Causes of Accidents on Motorways"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Accident Cause"</span>,</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># Hide legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Speeding seems to be by far the most common reason for road accidents across the region.</p>
<p>The best way to deal with this would be the installation of more speed cameras and harsher penalties, in the form of larger fines, for failing to adhere to regulations.</p>
<p>Currently, fines for speeding can be up to 4000B. Increasing this fine would be prudent and help reduce the amount of speeding accidents on motorways and across the region in general.</p>
<p>Now we analyze the accident types based on weather and time of day see if there are any changes based on changes in either factor. We will use the ggplot2 package for this.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Time</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Weather</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create time intervals for hour of day</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>accidents <span class="ot">&lt;-</span> bmr_accsf <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_interval =</span> <span class="fu">case_when</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    hourofday <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> hourofday <span class="sc">&lt;</span> <span class="dv">6</span>  <span class="sc">~</span> <span class="st">"0-6"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    hourofday <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> hourofday <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"6-12"</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    hourofday <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> hourofday <span class="sc">&lt;</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"12-18"</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    hourofday <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> hourofday <span class="sc">&lt;=</span> <span class="dv">24</span> <span class="sc">~</span> <span class="st">"18-24"</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and count the causes of accidents by time interval</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>top_5_time <span class="ot">&lt;-</span> accidents <span class="sc">%&gt;%</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time_interval, presumed_cause) <span class="sc">%&gt;%</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time_interval) <span class="sc">%&gt;%</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>, <span class="at">wt =</span> count)  <span class="co"># Get top 5 causes for each time interval</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for time intervals</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_5_time, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(presumed_cause, count), <span class="at">y =</span> count, <span class="at">fill =</span> presumed_cause)) <span class="sc">+</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span>  <span class="co"># Flip the coordinates for better readability</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> time_interval, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Causes of Accidents by Time Interval"</span>,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Cause of Accident"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There doesn’t seem to be a significant difference based on the different time periods of the day.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and count the causes of accidents by weather</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>top_5_weather <span class="ot">&lt;-</span> bmr_accsf <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weather_condition, presumed_cause) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">5</span>, <span class="at">wt =</span> count)  <span class="co"># Get the top 5 causes overall (not grouped by weather)</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for all weather conditions</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_5_weather, <span class="fu">aes</span>(<span class="at">x =</span> weather_condition, <span class="at">y =</span> count, <span class="at">fill =</span> presumed_cause)) <span class="sc">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 5 Causes of Accidents Across All Weather Conditions"</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Weather Condition"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Place legend at the bottom</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Speeding, unsurprisingly, is the primary reason for road accidents. However, we see far more instances of accidents in clear conditions.</p>
</div>
</div>
</div>
</section>
<section id="spatial-analysis" class="level1">
<h1>1.4 Spatial Analysis</h1>
<section id="kernel-density-estimation-kde" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-estimation-kde">1.4.1 Kernel Density Estimation (KDE)</h2>
<p>KDE will allow us to better estimate the distribution of accidents acrosss the Bangkok Metropolitan Region. Using this, we can make more informed decisions on where to focus resources on to reduce the rate of accidents across the region.</p>
<p>We start off by preparing the data for KDE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Define the window (bounding box) from the boundary</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>boundary_bbox <span class="ot">&lt;-</span> <span class="fu">bbox</span>(boundary_sp)  <span class="co"># Get bounding box of boundary</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">owin</span>(<span class="at">xrange =</span> boundary_bbox[<span class="dv">1</span>, ], <span class="at">yrange =</span> boundary_bbox[<span class="dv">2</span>, ])  <span class="co"># Define window</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Extract the coordinates from the SpatialPoints object</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>coordinates <span class="ot">&lt;-</span> <span class="fu">coordinates</span>(bmracc_sp)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Convert the SpatialPoints into a ppp object using the window</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>bmracc_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="at">x =</span> coordinates[,<span class="dv">1</span>], <span class="at">y =</span> coordinates[,<span class="dv">2</span>], <span class="at">window =</span> window)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Check the structure of the resulting point pattern object</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bmracc_ppp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Planar point pattern:  12986 points
Average intensity 1.101448e-06 points per square unit

*Pattern contains duplicated points*

Coordinates are given to 10 decimal places

Window: rectangle = [587893.5, 712440.5] x [1484413.7, 1579076.3] units
                    (124500 x 94660 units)
Window area = 11789900000 square units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can now use the ppp object for spatial analysis with spatstat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>Note that you must ensure to convert the spatial objects into ppp (planar point pattern) form before proceeding with Kernel Density Estimation. The spatstat package requires data to be in this format before conducting point pattern analysis. This also improves computational efficiency.</p>
</div>
<section id="dealing-with-duplicates" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-duplicates">1.4.1.1 Dealing with Duplicates</h3>
<p>After creating the above PPP object, we check for duplicates by implementing the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">duplicated</span>(bmracc_ppp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We check the number of duplicates in our data-frame using the code chunk below. The multiplicity() function creates a list of all duplicates after which the sum() function counts the total.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">multiplicity</span>(bmracc_ppp)<span class="sc">&gt;</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2293</code></pre>
</div>
</div>
<p>There are over 2293 duplicates. In this case, it means we have 2293 <strong><em>overlapping</em></strong> data points.</p>
<p>Using the rjitter() function, we deal with these data points by spacing them out slightly around the point. The function adds noise to the data and spreads these points out a little to facilitate visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>bmr_ppp_jit <span class="ot">&lt;-</span> <span class="fu">rjitter</span>(bmracc_ppp, </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">retry=</span><span class="cn">TRUE</span>, </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">nsim=</span><span class="dv">1</span>, </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">drop=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-an-owin-object" class="level3">
<h3 class="anchored" data-anchor-id="creating-an-owin-object">1.4.1.2 Creating an owin object</h3>
<p>When analyzing Spatial Point patterns, it is a good practice to confine the boundaries of the analysis with a Geographical area, such as Singapore’s boundary. Using the&nbsp;<strong>spatstat</strong>&nbsp;package, we can create an&nbsp;<strong>owin</strong>&nbsp;object that is designed to represent such polygonal regions.</p>
<p>We use the as.owin() function as shown in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>bmr_owin <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(bmr_boundary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use the plot() function to verify if the owin object has been correctly created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bmr_owin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="computing-kde-using-automatic-bandwidth-selection" class="level3">
<h3 class="anchored" data-anchor-id="computing-kde-using-automatic-bandwidth-selection">1.4.1.3 Computing KDE using automatic bandwidth selection</h3>
<p>We use the <strong>density()</strong> function of the <strong>spatstat</strong> package to compute the kernel density. These are the key configurations used in the computation:</p>
<ul>
<li><p><strong>bw.diggle()</strong> automatic bandwidth selection method.</p></li>
<li><p>The smoothing kernel used in this instance is <strong><em>gaussian</em></strong>. Other smoothing methods include <em>“epanechnikov”, “quartic”</em>. or <em>“disc”.</em></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>kde_bmracc_bw <span class="ot">&lt;-</span> <span class="fu">density</span>(bmr_ppp_jit,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma=</span>bw.diggle,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">edge=</span><span class="cn">TRUE</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">kernel=</span><span class="st">"gaussian"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="insights-box">
<p>The other two methods aside from bw.diggle() are bw.scott() and bw.ppl(). While bw.diggle() focuses on minimizing error in spatial density estimation for point process data and is tailor-made for spatial applications, bw.scott() (Scott’s rule) provides a rule-of-thumb bandwidth and is used in several KDE applications across different types of data besides just spatial data. bw.ppl() uses a more complex and data-driven approach (plug-in) for selecting the bandwidth, aiming to minimize the error in KDE. Like bw.diggle(), It is also tailor-made for spatial point processes, however, it takes a slightly different approach to bw.diggle()</p>
</div>
<p>We will now plot the above using the plot() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_bmracc_bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Immediately we notice that the density values are very small. This is because the unit of measurement is in meter, meaning that the density values are computed with a unit of ‘number of points per square meter.’</p>
<p>We now use the rescale.ppp() function of the spatstat package to convert the unit of measurement from meter to kilometer. This is done by implementing the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bmracc_ppp.km <span class="ot">&lt;-</span> <span class="fu">rescale.ppp</span>(bmr_ppp_jit, <span class="dv">1000</span>, <span class="st">"km"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After this, we re-deploy the density() function using the re-scaled data and plot the KDE map.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>kde_bmracc.bw <span class="ot">&lt;-</span> <span class="fu">density</span>(bmracc_ppp.km, </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sigma=</span>bw.diggle, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">edge=</span><span class="cn">TRUE</span>, </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">kernel=</span><span class="st">"gaussian"</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_bmracc.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="converting-the-kde-output-into-a-grid-object" class="level3">
<h3 class="anchored" data-anchor-id="converting-the-kde-output-into-a-grid-object">1.4.1.4 Converting the KDE output into a grid object</h3>
<section id="gridded-raster" class="level4">
<h4 class="anchored" data-anchor-id="gridded-raster">1.4.1.4.1 Gridded raster</h4>
<p>We convert the gridded kernel density objects into RasterLayer object by using&nbsp;<strong>raster()</strong>&nbsp;of the&nbsp;<strong>raster</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>kde_bmracc_bw_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(kde_bmracc.bw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The CRS above is NA, so we now set the CRS to EPSG 32647 of Thailand.</p>
<p>After that, we can implement the plot() function to plot the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(kde_bmracc_bw_raster) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">"+init=EPSG:32647"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kde_bmracc_bw_raster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the above, we infer that the South-East region, specifically districts around the Samut Prakan province seem to have a higher density of accidents.</p>
</section>
</section>
</section>
<section id="second-order-spatial-point-pattern-analysis." class="level2">
<h2 class="anchored" data-anchor-id="second-order-spatial-point-pattern-analysis.">1.4.2 Second-Order Spatial Point Pattern Analysis.</h2>
<p>We now focus on Second Order Spatial Point Patterns Analysis.</p>
<p>We first filter the data down to the regions of interest and create separate boundaries for each of them. Following this, we produce an owin object using the as.owin() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtering the data down to the regions of interest</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>bkk <span class="ot">=</span> bmr_boundary <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Bangkok"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>smt_pkn <span class="ot">=</span> bmr_boundary <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Samut Prakan"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>ntbr <span class="ot">=</span> bmr_boundary <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Nonthaburi"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>nkn_ptn<span class="ot">=</span> bmr_boundary <span class="sc">%&gt;%</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Nakhon Pathom"</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>smt_skn<span class="ot">=</span> bmr_boundary <span class="sc">%&gt;%</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ADM1_EN <span class="sc">==</span> <span class="st">"Samut Sakhon"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the owin object</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>bkk_owin <span class="ot">=</span> <span class="fu">as.owin</span>(bkk)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>smt_pkn_owin <span class="ot">=</span> <span class="fu">as.owin</span>(smt_pkn)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>ntbr_owin <span class="ot">=</span> <span class="fu">as.owin</span>(ntbr)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>nkn_ptn_owin <span class="ot">=</span> <span class="fu">as.owin</span>(nkn_ptn)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>smt_skn_owin <span class="ot">=</span> <span class="fu">as.owin</span>(smt_skn)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating point planar patterns</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>acc_bkk_ppp <span class="ot">=</span> bmr_ppp_jit[bkk_owin]</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>acc_smt_pkn_ppp <span class="ot">=</span> bmr_ppp_jit[smt_pkn_owin]</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>acc_ntbr_ppp <span class="ot">=</span> bmr_ppp_jit[ntbr_owin]</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>acc_nkn_ptn_ppp <span class="ot">=</span> bmr_ppp_jit[nkn_ptn_owin]</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>acc_smt_skn_ppp<span class="ot">=</span> bmr_ppp_jit[smt_skn_owin]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calculating-g-function-estimates-and-testing-for-complete-spatial-randomness" class="level3">
<h3 class="anchored" data-anchor-id="calculating-g-function-estimates-and-testing-for-complete-spatial-randomness"><strong>1.4.2.1 Calculating G-function estimates and testing for Complete Spatial Randomness</strong></h3>
<p>We now focus on computing G-function estimates.</p>
<p>The test below allows us to understand if accidents in the Bangkok Metropolitan Region exhibit Spatial Clustering or if they are Randomly Distributed.</p>
<p>We apply the test for Complete Spatial Randomness to each region individually. The tests are conducted at a 5% significance level.</p>
<p>The hypotheses are as follows.</p>
<ul>
<li><p><strong><em>H0: There is no spatial clustering. The accidents are randomly distributed across the region.</em></strong></p></li>
<li><p><strong><em>H1: There is spatial clustering. The accidents are NOT randomly distributed across the region.</em></strong></p></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Bangkok</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Samut Prakhan</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Nonthaburi</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Nakhon Pathom</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Samut Sakhon</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>We use the Gest() function of the spatstat package to compute a G-function estimation for Bangkok. Following that, we plot the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>G_bkk <span class="ot">=</span> <span class="fu">Gest</span>(acc_bkk_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_bkk, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now carry out the monte carlo simulation test, using the envelope() function, for complete spatial randomness.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>G_bkk.csr <span class="ot">&lt;-</span> <span class="fu">envelope</span>(acc_bkk_ppp, Gest, <span class="at">nsim =</span> <span class="dv">99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 99 simulations of CSR  ...
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 
99.

Done.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_bkk.csr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is clear that that there is clustering exhibited in this scenario as the black line, observed values, is far above the envelope. We have sufficient evidence to reject the null hypothesis.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>We use the Gest() function of the spatstat package to compute a G-function estimation for Samut Prakhan. Following that, we plot the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>G_smt_pkn <span class="ot">=</span> <span class="fu">Gest</span>(acc_smt_pkn_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_smt_pkn, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now implement a monte carlo simulation test, using the envelope() function, for Complete Spatial Random in Samut Prakan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>G_smt_pkn.csr <span class="ot">&lt;-</span> <span class="fu">envelope</span>(acc_smt_pkn_ppp, Gest, <span class="at">nsim =</span> <span class="dv">199</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 199 simulations of CSR  ...
1, 2, 3, 4.6.8.10.12.14.16.18.20.22.24.26.28.30.32.34
.36.38.40.42.44.46.48.50.52.54.56.58.60.62.64.66.68.70.72.74
.76.78.80.82.84.86.88.90.92.94.96.98.100.102.104.106.108.110.112.114
.116.118.120.122.124.126.128.130.132.134.136.138.140.142.144.146.148.150.152.154
.156.158.160.162.164.166.168.170.172.174.176.178.180.182.184.186.188.190.192.194
.196.198
199.

Done.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_smt_pkn.csr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We once again have sufficient evidence to reject the null hypothesis and conclude that accidents in Samut Prakan do indeed exhibit clustering, more so than is expected in a region that is randomly distributed.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>We use the Gest() function of the spatstat package to compute a G-function estimation for Nonthaburi. Following that, we plot the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>G_ntbr <span class="ot">=</span> <span class="fu">Gest</span>(acc_ntbr_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_ntbr, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now implement a Monte-Carlo Simulation test, using the envelope() function, to check for complete spatial randomness of roads accidents in Nonthaburi.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>G_ntbr.csr <span class="ot">&lt;-</span> <span class="fu">envelope</span>(acc_ntbr_ppp, Gest, <span class="at">nsim =</span> <span class="dv">199</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 199 simulations of CSR  ...
1, 2, 3, 4.6.8.10.12.14.16.18.20.22.24.26.28.30.32.34
.36.38.40.42.44.46.48.50.52.54.56.58.60.62.64.66.68.70.72.74
.76.78.80.82.84.86.88.90.92.94.96.98.100.102.104.106.108.110.112.114
.116.118.120.122.124.126.128.130.132.134.136.138.140.142.144.146.148.150.152.154
.156.158.160.162.164.166.168.170.172.174.176.178.180.182.184.186.188.190.192.194
.196.198
199.

Done.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_ntbr.csr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We once again have sufficient evidence to reject the null hypothesis and conclude that accidents in Nonthaburi do indeed exhibit clustering, more than is expected in a region that is randomly distributed.</p>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>We use the Gest() function of the spatstat package to compute a G-function estimation for Nakhon Pathom. Following that, we plot the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>G_nkn_ptn <span class="ot">=</span> <span class="fu">Gest</span>(acc_nkn_ptn_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_nkn_ptn, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now conduct the Monte-Carlo Simulation test, using the envelope() function, for complete spatial randomness for accidents in Nakhon Pathom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>G_nkn_ptn.csr <span class="ot">&lt;-</span> <span class="fu">envelope</span>(acc_nkn_ptn_ppp, Gest, <span class="at">nsim =</span> <span class="dv">199</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 199 simulations of CSR  ...
1, 2, 3, 4.6.8.10.12.14.16.18.20.22.24.26.28.30.32.34
.36.38.40.42.44.46.48.50.52.54.56.58.60.62.64.66.68.70.72.74
.76.78.80.82.84.86.88.90.92.94.96.98.100.102.104.106.108.110.112.114
.116.118.120.122.124.126.128.130.132.134.136.138.140.142.144.146.148.150.152.154
.156.158.160.162.164.166.168.170.172.174.176.178.180.182.184.186.188.190.192.194
.196.198
199.

Done.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_nkn_ptn.csr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We once again have sufficient evidence to reject the null hypothesis and conclude that accidents in Nakhon Pathom do indeed exhibit clustering, more than is expected in a region that is randomly distributed.</p>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<p>We use the Gest() function of the spatstat package to compute a G-function estimation for Samut Sakhon. Following that, we plot the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>G_smt_skn <span class="ot">=</span> <span class="fu">Gest</span>(acc_smt_skn_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_smt_skn, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We now conduct the Monte-Carlo Simulation test, using the envelope() function, for complete spatial randomness for accidents in Samut Sakhon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>G_smt_skn.csr <span class="ot">&lt;-</span> <span class="fu">envelope</span>(acc_smt_skn_ppp, Gest, <span class="at">nsim =</span> <span class="dv">199</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 199 simulations of CSR  ...
1, 2, 3, 4.6.8.10.12.14.16.18.20.22.24.26.28.30.32.34
.36.38.40.42.44.46.48.50.52.54.56.58.60.62.64.66.68.70.72.74
.76.78.80.82.84.86.88.90.92.94.96.98.100.102.104.106.108.110.112.114
.116.118.120.122.124.126.128.130.132.134.136.138.140.142.144.146.148.150.152.154
.156.158.160.162.164.166.168.170.172.174.176.178.180.182.184.186.188.190.192.194
.196.198
199.

Done.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(G_smt_skn.csr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We once again have sufficient evidence to reject the null hypothesis and conclude that accidents in Samut Sakhon do indeed exhibit clustering, more so than is expected in a region that is randomly distributed.</p>
</div>
</div>
</div>
<div class="insights-box">
<ul>
<li><p>The grey zone indicates the confidence envelop (In this case, we have set it as 95% as indicated by the critical value of 0.05)</p></li>
<li><p>When an observed L value is greater than its corresponding L(theo) value for a particular distance and lower than the upper confidence envelop, spatial clustering for that distance is statistically NOT significant (e.g.&nbsp;distance between B and C).</p></li>
<li><p>When an observed L value is smaller than its corresponding L(theo) value for a particular distance and beyond the lower confidence envelop, spatial dispersion for that distance is statistically significant. - When an observed L value is smaller than its corresponding L(theo) value for a particular distance and within the lower confidence envelop, spatial dispersion for that distance is statistically NOT significant (e.g.&nbsp;distance between A and B).</p></li>
</ul>
</div>
</section>
</section>
<section id="spatial-weights" class="level2">
<h2 class="anchored" data-anchor-id="spatial-weights">1.4.3 Spatial Weights</h2>
<p>We now create a data-frame, <code>boundary_with_accident_count</code>, in order to assign Spatial Weights and carry out further analysis.</p>
<p>We start off by conducting a spatial join with the help of the st_join() function of the sf package to join <code>bmr_accsf</code>, accident data of the Bangkok Metropolitan Region.</p>
<p>We then use the left_join() function of the dplyr package to join this with the boundary data in order to facilitate analysis.</p>
<p>We then save it as an RDS file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>accidents_with_districts <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bmr_accsf, bmr_boundary2, <span class="at">join =</span> st_intersects)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by adm2_en and count the number of accidents per district</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>accident_counts_by_adm2 <span class="ot">&lt;-</span> accidents_with_districts <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ADM2_EN) <span class="sc">%&gt;%</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">accident_count =</span> <span class="fu">n</span>())</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a left join with the boundary data</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>boundary_with_accident_count <span class="ot">&lt;-</span> bmr_boundary2 <span class="sc">%&gt;%</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(accident_counts_by_adm2, <span class="at">by =</span> <span class="st">"ADM2_EN"</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>boundary_with_accident_count <span class="ot">&lt;-</span> boundary_with_accident_count <span class="sc">%&gt;%</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">accident_count =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(accident_count), <span class="dv">0</span>, accident_count))</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(boundary_with_accident_count, <span class="st">"data/rds/boundary_with_acc_count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>boundary_with_accident_count<span class="ot">=</span><span class="fu">read_rds</span>(<span class="st">"data/rds/boundary_with_acc_count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After successfully completing the relational join, we can now plot a choropleth map to visualize the number of accidents in the Bangkok Metropolitan Region using various functions of the tmap package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>basemap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(boundary_with_accident_count) <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>() <span class="sc">+</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="st">"ADM2_EN.x"</span>, <span class="at">size=</span><span class="fl">0.5</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>gdppc <span class="ot">&lt;-</span> <span class="fu">qtm</span>(boundary_with_accident_count, <span class="st">"accident_count"</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(basemap, gdppc, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above map reinforces our earlier finding that the Eastern/South-Eastern region of the Bangkok Metropolitan Region have the most accidents. One district in the bottom left, part of the Samut Sakhon province, also has a high volume of accidents.</p>
<section id="computing-contiguity-spatial-weights" class="level3">
<h3 class="anchored" data-anchor-id="computing-contiguity-spatial-weights">1.4.3.1 Computing Contiguity Spatial Weights</h3>
<p>We now implement the <strong>poly2nb()</strong> function of the <strong>spdep</strong> package to compute contiguity weight matrices for the study area selected.</p>
<p>Using this function, we are able to build a ‘neighbors list’ based on regions with contiguous boundaries.</p>
<p>In this function, we will pass an argument, ‘queen’, that can be set as either TRUE (default) or FALSE. If the ‘queen’ argument is not explicitly set to FALSE, the function returns a list of first order neighbors using the Queen criteria.</p>
<p><a href="https://cran.r-project.org/web/packages/spdep/spdep.pdf">You may refer to the <code>spdep</code> package documentation here</a> to learn more about its functions and arguments.</p>
<section id="computing-queen-contiguity-based-neighbors" class="level4">
<h4 class="anchored" data-anchor-id="computing-queen-contiguity-based-neighbors">1.4.3.1.1 Computing (QUEEN) contiguity based neighbors</h4>
<p>The poly2nb() function is implemented as shown in the code chunk below. Using this, we are able to compute a Queen contiguity weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>wm_q <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(boundary_with_accident_count, <span class="at">queen=</span><span class="cn">TRUE</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 79 
Number of nonzero links: 438 
Percentage nonzero weights: 7.018106 
Average number of links: 5.544304 
Link number distribution:

 2  3  4  5  6  7  8  9 
 1  5 10 24 20 12  6  1 
1 least connected region:
66 with 2 links
1 most connected region:
30 with 9 links</code></pre>
</div>
</div>
<p>The most connected area has 9 neighbors. In general, most districts have approximately 5 to 6 neighbors.</p>
</section>
<section id="computing-rook-contiguity-based-neighbors" class="level4">
<h4 class="anchored" data-anchor-id="computing-rook-contiguity-based-neighbors">1.4.3.1.2 Computing (ROOK) contiguity based neighbors</h4>
<p>For this, we will set the <code>queen</code> argument of the poly2nb() function to false.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>wm_r <span class="ot">&lt;-</span> <span class="fu">poly2nb</span>(boundary_with_accident_count, <span class="at">queen=</span><span class="cn">FALSE</span>) </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm_r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 79 
Number of nonzero links: 422 
Percentage nonzero weights: 6.761737 
Average number of links: 5.341772 
Link number distribution:

 2  3  4  5  6  7  8 
 1  5 16 20 22 11  4 
1 least connected region:
66 with 2 links
4 most connected regions:
1 5 17 54 with 8 links</code></pre>
</div>
</div>
<p>The most connected area has 8 neighbors. In general, most districts have approximately 5 to 6 neighbors.</p>
</section>
</section>
<section id="visualizing-contiguity-weights" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-contiguity-weights">1.4.3.2 Visualizing contiguity weights</h3>
<p>A connectivity graph takes a point and displays a line to each neighboring point. We are working with polygons in this situation, so we need to ensure that our points are in order to produce our connectivity graphs.</p>
<p>Usually, the method of choice will be polygon centroids. We calculate using the sf package before moving onto the graphs. Getting latitude and longitude of the Polygon Centroids.</p>
<p>We need points to associate with each polygon before we can make our connectivity graph. It won’t be as simple as applying the st_centroid() function of the sf sf object: <em><code>us.bound</code></em>. We need the coordinates in a separate data-frame for this to work.</p>
<p>To do this, we will use a mapping function which will apply a given function to each element of a vector and returns a vector of the same length. Our input vector will be the geometry column of <code>us.bound</code>.</p>
<p>The function that we implement in this situation will be st_centroid().</p>
<p>We will be using the map_dbl variation of map from the purrr package.</p>
<section id="obtaining-coordinate-values" class="level4">
<h4 class="anchored" data-anchor-id="obtaining-coordinate-values">1.4.3.2.1 Obtaining Coordinate values</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Longitude</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Latitude</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Coords</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>longitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(boundary_with_accident_count<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>latitude <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(boundary_with_accident_count<span class="sc">$</span>geometry, <span class="sc">~</span><span class="fu">st_centroid</span>(.x)[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>Now that we have the latitude and longitude values, we can use the cbind() function to put the longitude and latitude values into the same object,&nbsp;<code>coords</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">cbind</span>(longitude, latitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     longitude latitude
[1,]  661951.4  1521172
[2,]  664121.1  1523923
[3,]  700735.2  1532207
[4,]  664808.5  1518057
[5,]  676193.5  1533602
[6,]  677305.1  1522820</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>We can now plot the contiguity weights side by side for comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boundary_with_accident_count<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>, <span class="at">main=</span><span class="st">"Queen Contiguity"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_q, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col=</span> <span class="st">"purple"</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boundary_with_accident_count<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>, <span class="at">main=</span><span class="st">"Rook Contiguity"</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wm_r, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"darkgreen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="insights-box">
<ul>
<li><p>Queen Contiguity creates more connections as seen above, as it considers both shared vertices AND edges. This results in a more dense network.</p></li>
<li><p>Rook Contiguity results in fewer connections as it only considers shared borders as opposed to Queen Contiguity. This results in a simpler network.</p></li>
</ul>
</div>
<p>We often use these in order to proceed with Spatial Autocorrelation Analysis to understand the neighbors taken into consideration amongst other factors.</p>
</section>
</section>
<section id="adaptive-distance-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="adaptive-distance-weight-matrix">1.4.3.3 Adaptive Distance Weight Matrix</h3>
<p>One of the characteristics of fixed distance weight matrices is that the more densely settled areas (usually urban areas) tend to have more neighbors and the less densely settled areas (usually rural areas) tend to have lesser neighbors.</p>
<p>Having many neighbors smoothens the neighbor relationship across more neighbors.</p>
<p>It is possible to control the numbers of neighbors directly using k-nearest neighbors by either accepting asymmetric neighbors or imposing symmetry</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>knn6 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords, <span class="at">k=</span><span class="dv">6</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>knn6</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 79 
Number of nonzero links: 474 
Percentage nonzero weights: 7.594937 
Average number of links: 6 
Non-symmetric neighbours list</code></pre>
</div>
</div>
<p>We immediately see a difference when comparing the above output to <code>wm_q</code> and <code>wm_r</code>. The number of non-zero links is higher.</p>
<p>We can create the plot for the same using the plot() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boundary_with_accident_count<span class="sc">$</span>geometry, <span class="at">border=</span><span class="st">"lightgrey"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn6, coords, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="row-standardized-weights-matrix" class="level3">
<h3 class="anchored" data-anchor-id="row-standardized-weights-matrix">1.4.3.4 Row standardized weights matrix</h3>
<section id="weights-based-on-inversed-distance-weighting-idw" class="level4">
<h4 class="anchored" data-anchor-id="weights-based-on-inversed-distance-weighting-idw">1.4.3.4.1 Weights Based on Inversed Distance Weighting (IDW)</h4>
<p>We first compute the distances between areas by implementing the&nbsp;<strong>nbdists()</strong>&nbsp;function of the&nbsp;<strong>spdep</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">&lt;-</span> <span class="fu">nbdists</span>(wm_q, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dist, <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(x))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.0002854535 0.0006582134 0.0004566217 0.0002167536 0.0003080119
[6] 0.0002757322 0.0003371576 0.0002806965

[[2]]
[1] 0.0002854535 0.0002055287 0.0003012437 0.0003439200 0.0003703229
[6] 0.0002193608 0.0001383976 0.0002982074

[[3]]
[1] 8.230456e-05 7.194802e-05 7.691011e-05 6.386761e-05

[[4]]
[1] 0.0005397094 0.0003348823 0.0004742967 0.0004145926 0.0006228750

[[5]]
[1] 1.466707e-04 1.197978e-04 1.317261e-04 1.901079e-04 1.449448e-04
[6] 2.005737e-04 1.397857e-04 8.481219e-05

[[6]]
[1] 0.0001622765 0.0002212846 0.0002009303 0.0001431074 0.0001781389
[6] 0.0002901167

[[7]]
[1] 0.0002055287 0.0005397094 0.0003428497 0.0003432013 0.0003504051
[6] 0.0002113326 0.0005031250 0.0001878859

[[8]]
[1] 0.0006582134 0.0003012437 0.0003348823 0.0003428497 0.0007193454

[[9]]
[1] 0.0001452881 0.0001919620 0.0002478517 0.0001846853 0.0003608347
[6] 0.0001275280

[[10]]
[1] 8.230456e-05 1.204212e-04 1.185473e-04 1.177461e-04 1.338999e-04

[[11]]
[1] 7.194802e-05 1.204212e-04 7.412539e-05 8.957108e-05 5.200876e-05
[6] 6.530843e-05 8.333031e-05

[[12]]
[1] 0.0002120327 0.0003601503 0.0003033661 0.0002204848 0.0002299417

[[13]]
[1] 0.0004566217 0.0004742967 0.0003432013 0.0007193454 0.0005352046

[[14]]
[1] 0.0003439200 0.0004723701 0.0002181006 0.0001852359 0.0003556913

[[15]]
[1] 0.0002167536 0.0004178016 0.0005004725 0.0002059056 0.0002024628
[6] 0.0002988328 0.0002534194

[[16]]
[1] 0.0003080119 0.0004178016 0.0001666057 0.0003222415 0.0002506523

[[17]]
[1] 0.0001622765 0.0004355978 0.0001468778 0.0001493430 0.0002022661
[6] 0.0001455745 0.0002525101 0.0003209334

[[18]]
[1] 0.0002757322 0.0004145926 0.0005352046 0.0005004725 0.0003077165
[6] 0.0003335152

[[19]]
[1] 0.0001666057 0.0002462888 0.0001860044 0.0001509068 0.0001330087
[6] 0.0001378191 0.0002092546

[[20]]
[1] 0.0003371576 0.0003222415 0.0002462888 0.0001834292 0.0002732088

[[21]]
[1] 8.969997e-05 1.203769e-04 1.245294e-04 9.569804e-05 4.958860e-05

[[22]]
[1] 0.0002059056 0.0002506523 0.0001860044 0.0001834292 0.0002152303
[6] 0.0001971194 0.0001095917

[[23]]
[1] 2.053579e-04 1.119769e-04 1.692192e-04 6.579843e-05 1.036058e-04

[[24]]
[1] 0.0002120327 0.0002024628 0.0003529966 0.0002347366 0.0001982741
[6] 0.0001621175

[[25]]
[1] 0.0002806965 0.0003703229 0.0001509068 0.0002732088 0.0001935337
[6] 0.0001208318

[[26]]
[1] 0.0004723701 0.0004355978 0.0001754699 0.0003013611

[[27]]
[1] 0.0001466707 0.0002212846 0.0002022599 0.0003179325 0.0001494025

[[28]]
[1] 0.0006228750 0.0003504051 0.0003601503 0.0003077165 0.0003330968
[6] 0.0002241661

[[29]]
[1] 2.193608e-04 2.181006e-04 1.935337e-04 2.480081e-04 1.269610e-04
[6] 1.731795e-04 8.705329e-05

[[30]]
[1] 0.0001383976 0.0001197978 0.0001852359 0.0001468778 0.0001754699
[6] 0.0002480081 0.0002134931 0.0001692547 0.0001150417

[[31]]
[1] 0.0003033661 0.0002988328 0.0003335152 0.0003529966 0.0003330968

[[32]]
[1] 1.452881e-04 7.412539e-05 1.648225e-04 1.385556e-04 1.384360e-04
[6] 9.877756e-05

[[33]]
[1] 0.0002113326 0.0001919620 0.0002204848 0.0002241661 0.0004631083
[6] 0.0001381990

[[34]]
[1] 0.0002009303 0.0002478517 0.0001493430 0.0001648225 0.0002087434
[6] 0.0001252900

[[35]]
[1] 2.534194e-04 8.969997e-05 2.152303e-04 2.347366e-04 1.338459e-04
[6] 1.190158e-04

[[36]]
[1] 1.317261e-04 1.741388e-04 1.477787e-04 9.360890e-05 1.023839e-04
[6] 4.522313e-05

[[37]]
[1] 0.0002982074 0.0005031250 0.0003556913 0.0002022661 0.0003013611
[6] 0.0001760696

[[38]]
[1] 0.0001901079 0.0001431074 0.0001455745 0.0002022599 0.0002134931
[6] 0.0001969405

[[39]]
[1] 0.0001878859 0.0001846853 0.0002525101 0.0004631083 0.0002087434
[6] 0.0001760696

[[40]]
[1] 0.0001330087 0.0001971194 0.0002053579 0.0001396487 0.0001509543

[[41]]
[1] 0.0001449448 0.0001269610 0.0001692547 0.0001741388 0.0001155726
[6] 0.0001062678

[[42]]
[1] 2.005737e-04 1.477787e-04 1.006357e-04 5.914874e-05

[[43]]
[1] 0.0001397857 0.0001185473 0.0003179325 0.0001503042 0.0001120205

[[44]]
[1] 1.781389e-04 1.177461e-04 8.957108e-05 1.494025e-04 1.385556e-04
[6] 1.252900e-04 1.503042e-04

[[45]]
[1] 0.0002901167 0.0003209334 0.0001969405

[[46]]
[1] 7.691011e-05 8.481219e-05 1.338999e-04 1.006357e-04 1.120205e-04
[6] 7.834800e-05

[[47]]
[1] 3.608347e-04 1.384360e-04 8.847607e-05 7.825942e-05 1.380165e-04

[[48]]
[1] 1.378191e-04 1.119769e-04 1.396487e-04 1.390484e-04 5.812114e-05
[6] 9.420908e-05

[[49]]
[1] 0.0001203769 0.0001982741 0.0001338459 0.0001460302 0.0001218403

[[50]]
[1] 1.245294e-04 1.095917e-04 1.692192e-04 1.190158e-04 1.509543e-04
[6] 4.881437e-05 7.827893e-05

[[51]]
[1] 8.847607e-05 4.260505e-05 9.775096e-05 7.211651e-05 6.976002e-05

[[52]]
[1] 5.200876e-05 4.260505e-05 6.461671e-05 1.208164e-04

[[53]]
[1] 6.530843e-05 9.877756e-05 7.825942e-05 9.775096e-05 6.461671e-05
[6] 1.098016e-04

[[54]]
[1] 1.275280e-04 2.299417e-04 1.621175e-04 1.381990e-04 1.380165e-04
[6] 1.460302e-04 7.211651e-05 8.749710e-05

[[55]]
[1] 9.569804e-05 1.218403e-04 6.976002e-05 8.749710e-05

[[56]]
[1] 8.333031e-05 1.208164e-04 1.098016e-04

[[57]]
[1] 0.0001731795 0.0001150417 0.0001155726 0.0001121332 0.0000764271
[6] 0.0000755279 0.0001320269

[[58]]
[1] 2.092546e-04 1.208318e-04 8.705329e-05 1.390484e-04 1.121332e-04
[6] 1.356813e-04 6.810787e-05

[[59]]
[1] 7.642710e-05 1.356813e-04 1.153320e-04 5.588948e-05 1.070876e-04

[[60]]
[1] 7.552790e-05 1.153320e-04 8.048614e-05 9.201600e-05 7.698649e-05

[[61]]
[1] 5.588948e-05 8.048614e-05 8.676092e-05 7.105006e-05 5.108714e-05

[[62]]
[1] 9.360890e-05 1.062678e-04 1.320269e-04 9.201600e-05 1.156307e-04
[6] 6.087272e-05

[[63]]
[1] 1.023839e-04 1.156307e-04 5.287764e-05 4.047452e-05 6.619029e-05
[6] 3.620195e-05 9.994772e-05

[[64]]
[1] 5.287764e-05 8.616137e-05 5.274538e-05 6.005288e-05

[[65]]
[1] 4.047452e-05 8.616137e-05 5.965942e-05 1.524056e-04

[[66]]
[1] 5.274538e-05 5.965942e-05

[[67]]
[1] 7.698649e-05 8.676092e-05 6.087272e-05 6.619029e-05 7.655740e-05

[[68]]
[1] 6.386761e-05 4.522313e-05 5.914874e-05 7.834800e-05 3.620195e-05
[6] 1.524056e-04

[[69]]
[1] 9.994772e-05 6.005288e-05 7.655740e-05

[[70]]
[1] 4.117989e-05 5.885227e-05 6.155251e-05 4.225974e-05

[[71]]
[1] 4.117989e-05 5.953357e-05 4.110606e-05

[[72]]
[1] 5.885227e-05 5.899804e-05 4.000195e-05 8.692110e-05 8.457300e-05

[[73]]
[1] 6.155251e-05 5.953357e-05 5.899804e-05 6.741263e-05

[[74]]
[1] 7.105006e-05 4.110606e-05 4.000195e-05 6.741263e-05 3.789103e-05

[[75]]
[1] 6.579843e-05 5.812114e-05 4.225974e-05 8.692110e-05 7.172077e-05
[6] 1.056880e-04 5.465069e-05

[[76]]
[1] 9.420908e-05 6.810787e-05 1.070876e-04 5.108714e-05 8.457300e-05
[6] 3.789103e-05 7.172077e-05

[[77]]
[1] 4.958860e-05 4.881437e-05 7.004105e-05 6.324110e-05

[[78]]
[1] 1.036058e-04 7.827893e-05 1.056880e-04 7.004105e-05 5.420721e-05

[[79]]
[1] 5.465069e-05 6.324110e-05 5.420721e-05</code></pre>
</div>
</div>
<p>We now need to assign weights to each neighboring polygon. We use equal weights (style=“W”), where each neighboring polygon is assigned a weight of 1 divided by the number of neighbors.</p>
<p>This means each neighboring county’s weight is calculated as 1/(# of neighbors), and these weights are then used to sum the weighted income values.</p>
<p>While this method is intuitive for summarizing neighbors’ values, it has a drawback: polygons at the edges of the study area may rely on fewer neighbors, potentially skewing the spatial autocorrelation results.</p>
<details>
<summary>
Note on <code>style</code> argument
</summary>
<div class="note-box">
<p>Note: For simplicity, we’ll use the style=“W” option in this example, but be aware that more robust options, such as style=“B”, are available.</p>
</div>
</details>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>rswm_q <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q, <span class="at">style=</span><span class="st">"W"</span>, <span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>rswm_q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 79 
Number of nonzero links: 438 
Percentage nonzero weights: 7.018106 
Average number of links: 5.544304 

Weights style: W 
Weights constants summary:
   n   nn S0      S1       S2
W 79 6241 79 29.8143 321.0615</code></pre>
</div>
</div>
<p>Setting the argument <code>zero.policy</code> to TRUE allows for lists of non-neighbors. This should be used with caution as users may not be aware of missing neighbors in their data however setting <code>zero,policy</code> to FALSE would return an error.</p>
<p>The code chunk below is implemented to check the weights of the first polygons eight neighbors type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>rswm_q<span class="sc">$</span>weights[<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.2 0.2 0.2 0.2 0.2</code></pre>
</div>
</div>
<p>Using the same method, we derive a row standardized distance weight matrix by using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>rswm_ids <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_q, <span class="at">glist=</span>ids, <span class="at">style=</span><span class="st">"B"</span>, <span class="at">zero.policy=</span><span class="cn">TRUE</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>rswm_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 79 
Number of nonzero links: 438 
Percentage nonzero weights: 7.018106 
Average number of links: 5.544304 

Weights style: B 
Weights constants summary:
   n   nn         S0           S1           S2
B 79 6241 0.07702966 4.057545e-05 0.0004441685</code></pre>
</div>
</div>
<p>We now compute the average neighbor Accident count value for each polygon. We often refer to these values as Spatially Lagged Values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>acc.lag <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(rswm_q, boundary_with_accident_count<span class="sc">$</span>accident_count)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>acc.lag</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   3.375000  42.750000 440.750000  10.800000 141.000000 115.333333
 [7]  12.500000  10.600000 222.500000 400.600000 351.714286 123.000000
[13]  10.800000  39.600000  30.714286  90.400000  58.375000   5.166667
[19] 162.428571  94.400000 239.600000 144.857143 299.600000 136.333333
[25]  84.333333  73.500000 206.400000  41.500000  72.142857  57.222222
[31]  40.800000 350.000000 116.333333 163.333333  76.333333 203.333333
[37]  27.833333  60.166667  53.833333 258.000000 119.166667 240.250000
[43] 157.400000 311.428571  34.333333 241.000000 366.800000 190.666667
[49] 212.000000 234.857143 324.200000 540.500000 444.500000  86.875000
[55] 261.750000 626.333333 112.571429 223.857143 115.200000 124.600000
[61] 120.200000 120.000000 290.428571 149.750000 348.000000 523.000000
[67] 135.800000 165.500000 291.000000 121.500000 125.333333 140.600000
[73] 133.250000  67.600000 190.285714 206.000000 138.250000 262.400000
[79] 390.666667</code></pre>
</div>
</div>
<p>We can retrieve the Accident count for each by using the code Chunk Below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>nb1 <span class="ot">&lt;-</span> wm_q[[<span class="dv">1</span>]] <span class="co">#Shows the accident counts for the neighboring districts of region 1</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>nb1 <span class="ot">&lt;-</span> boundary_with_accident_count<span class="sc">$</span>accident_count[nb1]</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>nb1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0  0  0  2  0  1  1 23</code></pre>
</div>
</div>
<div class="insights-box">
<p>A spatial lag with row-standardized weights means that each observation’s value is influenced by the average values of its neighboring observations. Specifically, the weights are standardized so that the sum of the weights for each observation equals one.</p>
<p>This approach ensures that the spatial lag is essentially the weighted average of the neighboring values.</p>
</div>
<p>We can append the spatially lagged Accident values onto the <code>boundary_with_accident_count</code> sf data-frame by using the code chunk shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>lag.list <span class="ot">&lt;-</span> <span class="fu">list</span>(boundary_with_accident_count<span class="sc">$</span>ADM2_EN.x, <span class="fu">lag.listw</span>(rswm_q, boundary_with_accident_count<span class="sc">$</span>accident_count))</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>lag.res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lag.list)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lag.res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ADM2_EN.x"</span>, <span class="st">"lag Accident Count"</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>boundary_with_accident_count <span class="ot">&lt;-</span> <span class="fu">left_join</span>(boundary_with_accident_count,lag.res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can gain further insight into this data-frame by implementing the head() function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(boundary_with_accident_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 22 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 660838.3 ymin: 1517063 xmax: 709544.6 ymax: 1542641
Projected CRS: WGS 84 / UTM zone 47N
  Shape_Leng   Shape_Area   ADM2_EN.x ADM2_TH ADM2_PCODE ADM2_REF ADM2ALT1EN
1 0.08541733 0.0004504685 Phra Nakhon  พระนคร     TH1001     &lt;NA&gt;       &lt;NA&gt;
2 0.13413177 0.0009501914       Dusit     ดุสิต     TH1002     &lt;NA&gt;       &lt;NA&gt;
3 0.67634217 0.0198588627   Nong Chok หนองจอก     TH1003     &lt;NA&gt;       &lt;NA&gt;
4 0.08588647 0.0003369561    Bang Rak   บางรัก     TH1004     &lt;NA&gt;       &lt;NA&gt;
5 0.30172202 0.0034149298   Bang Khen  บางเขน     TH1005     &lt;NA&gt;       &lt;NA&gt;
6 0.30869124 0.0023032680   Bang Kapi  บางกะปิ     TH1006     &lt;NA&gt;       &lt;NA&gt;
  ADM2ALT2EN ADM2ALT1TH ADM2ALT2TH ADM1_EN      ADM1_TH ADM1_PCODE  ADM0_EN
1       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Bangkok กรุงเทพมหานคร       TH10 Thailand
2       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Bangkok กรุงเทพมหานคร       TH10 Thailand
3       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Bangkok กรุงเทพมหานคร       TH10 Thailand
4       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Bangkok กรุงเทพมหานคร       TH10 Thailand
5       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Bangkok กรุงเทพมหานคร       TH10 Thailand
6       &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt; Bangkok กรุงเทพมหานคร       TH10 Thailand
    ADM0_TH ADM0_PCODE       date    validOn    validTo ADM2_EN.y
1 ประเทศไทย         TH 2019-02-18 2022-01-22 -001-11-30      &lt;NA&gt;
2 ประเทศไทย         TH 2019-02-18 2022-01-22 -001-11-30      &lt;NA&gt;
3 ประเทศไทย         TH 2019-02-18 2022-01-22 -001-11-30 Nong Chok
4 ประเทศไทย         TH 2019-02-18 2022-01-22 -001-11-30  Bang Rak
5 ประเทศไทย         TH 2019-02-18 2022-01-22 -001-11-30 Bang Khen
6 ประเทศไทย         TH 2019-02-18 2022-01-22 -001-11-30 Bang Kapi
  accident_count lag Accident Count                       geometry
1              0             3.3750 MULTIPOLYGON (((662263.2 15...
2              0            42.7500 MULTIPOLYGON (((664304.4 15...
3             60           440.7500 MULTIPOLYGON (((706774.6 15...
4              8            10.8000 MULTIPOLYGON (((664040.2 15...
5            126           141.0000 MULTIPOLYGON (((673966.4 15...
6             10           115.3333 MULTIPOLYGON (((676080.6 15...</code></pre>
</div>
</div>
<p>We now plot the observed Accident and Spatial Lag Accidents side by side for comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>acc_qtm <span class="ot">&lt;-</span> <span class="fu">qtm</span>(boundary_with_accident_count, <span class="st">"accident_count"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>lag_acc <span class="ot">&lt;-</span> <span class="fu">qtm</span>(boundary_with_accident_count, <span class="st">"lag Accident Count"</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(acc_qtm, lag_acc, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="insights-box">
<p>The use of spatial weights are highly useful for a variety of reasons.</p>
<ol type="1">
<li><p>They allow us to better understand and analyze the dependence between neighboring regions.</p></li>
<li><p>The help us understand how accidents are not isolated incidents and are often a part of bigger spatial patterns. This allows us to make better decisions with regards to policy developments, resource allocation and more in order to reduce the number of accidents.</p></li>
<li><p>These help us identify clusters and are crucial in identifying ‘spillover’ effects.</p></li>
</ol>
</div>
</section>
</section>
<section id="spatial-window-average" class="level3">
<h3 class="anchored" data-anchor-id="spatial-window-average">1.4.3.5 Spatial Window Average</h3>
<p>The spatial window average uses row-standardized weights and includes the diagonal element. To do this in R, we need to go back to the neighbors structure and add the diagonal element before assigning weights.</p>
<p>To add the diagonal element to the neighbour list, we use the include.self() function from the <strong>spdep</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>wm_qs <span class="ot">&lt;-</span> <span class="fu">include.self</span>(wm_q)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>wm_qs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 79 
Number of nonzero links: 517 
Percentage nonzero weights: 8.283929 
Average number of links: 6.544304 </code></pre>
</div>
</div>
<p>There is a difference in the key statistics shown above when compared to wm_q. The average number of links, the number of non-zero links as well as percentage of non-zero weights are all higher for wm_qs.</p>
<p>We look at the neighbor list of area [1] using the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>wm_qs[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  2  8 13 15 16 18 20 25</code></pre>
</div>
</div>
<p>This region has 9 neighbors.</p>
<p>We now implement the nb2listw() function in order to obtain weights.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>wm_qs <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_qs)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>wm_qs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 79 
Number of nonzero links: 517 
Percentage nonzero weights: 8.283929 
Average number of links: 6.544304 

Weights style: W 
Weights constants summary:
   n   nn S0       S1       S2
W 79 6241 79 24.99173 318.4378</code></pre>
</div>
</div>
<p>We now create the lag variable from our weight structure and <code>accident_count</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>lag_w_avg_acc <span class="ot">&lt;-</span> <span class="fu">lag.listw</span>(wm_qs, </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                             boundary_with_accident_count<span class="sc">$</span>accident_count)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>lag_w_avg_acc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   3.000000  38.000000 364.600000  10.333333 139.333333 100.285714
 [7]  16.111111   8.833333 191.571429 345.833333 423.500000 125.500000
[13]   9.000000  46.666667  27.125000  75.333333  55.000000   4.571429
[19] 198.000000  78.833333 245.166667 127.000000 249.666667 124.714286
[25]  75.571429  60.000000 174.833333  36.714286  64.125000  66.500000
[31]  36.166667 377.714286 106.000000 163.714286  86.000000 184.285714
[37]  28.714286  60.857143  47.000000 268.333333 106.571429 225.000000
[43] 205.333333 320.750000  33.250000 233.142857 319.000000 269.285714
[49] 181.000000 218.000000 312.333333 515.800000 457.571429 132.222222
[55] 228.000000 581.500000 119.625000 202.125000 115.833333 143.500000
[61] 110.000000 130.285714 270.125000 252.000000 355.400000 356.666667
[67] 127.166667 224.571429 233.750000 146.200000 114.500000 134.833333
[73] 112.800000  73.000000 199.875000 187.750000 277.600000 230.333333
[79] 320.500000</code></pre>
</div>
</div>
<p>We then proceed to convert the lag variable&nbsp;<code>listw</code>object into a data-frame by using as.data.frame().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>lag.list.wm_qs <span class="ot">&lt;-</span> <span class="fu">list</span>(boundary_with_accident_count<span class="sc">$</span>ADM2_EN.x, <span class="fu">lag.listw</span>(wm_qs, boundary_with_accident_count<span class="sc">$</span>accident_count))</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>lag_wm_qs.res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(lag.list.wm_qs)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lag_wm_qs.res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ADM2_EN.x"</span>, <span class="st">"lag_window_avg acc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>Note: The third command line on the code chunk above renames the field names of&nbsp;<em>lag_wm_q1.res</em>&nbsp;object into&nbsp;accident_count and&nbsp;<em>lag_window_avg acc</em>&nbsp;respectively.</p>
</div>
<p>We now append&nbsp;the lag_window_avg acc values onto the <code>boundary_with_accident_count</code> sf data.frame by using&nbsp;left_join()&nbsp;of&nbsp;<strong>dplyr</strong>&nbsp;package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>boundary_with_accident_count <span class="ot">&lt;-</span> <span class="fu">left_join</span>(boundary_with_accident_count, lag_wm_qs.res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To compare the values of lag accident count and Spatial window average,&nbsp;The kable() function&nbsp;of the Knitr package is used to prepare a table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>boundary_with_accident_count <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"ADM2_EN.x"</span>, </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"lag Accident Count"</span>, </span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"lag_window_avg acc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 23%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ADM2_EN.x</th>
<th style="text-align: right;">lag Accident Count</th>
<th style="text-align: right;">lag_window_avg acc</th>
<th style="text-align: left;">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Phra Nakhon</td>
<td style="text-align: right;">3.375000</td>
<td style="text-align: right;">3.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((662263.2 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dusit</td>
<td style="text-align: right;">42.750000</td>
<td style="text-align: right;">38.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((664304.4 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nong Chok</td>
<td style="text-align: right;">440.750000</td>
<td style="text-align: right;">364.600000</td>
<td style="text-align: left;">MULTIPOLYGON (((706774.6 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Rak</td>
<td style="text-align: right;">10.800000</td>
<td style="text-align: right;">10.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((664040.2 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Khen</td>
<td style="text-align: right;">141.000000</td>
<td style="text-align: right;">139.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((673966.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Kapi</td>
<td style="text-align: right;">115.333333</td>
<td style="text-align: right;">100.285714</td>
<td style="text-align: left;">MULTIPOLYGON (((676080.6 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pathum Wan</td>
<td style="text-align: right;">12.500000</td>
<td style="text-align: right;">16.111111</td>
<td style="text-align: left;">MULTIPOLYGON (((664236.5 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pom Prap Sattru Phai</td>
<td style="text-align: right;">10.600000</td>
<td style="text-align: right;">8.833333</td>
<td style="text-align: left;">MULTIPOLYGON (((663880.5 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phra Khanong</td>
<td style="text-align: right;">222.500000</td>
<td style="text-align: right;">191.571429</td>
<td style="text-align: left;">MULTIPOLYGON (((674748.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Min Buri</td>
<td style="text-align: right;">400.600000</td>
<td style="text-align: right;">345.833333</td>
<td style="text-align: left;">MULTIPOLYGON (((694735.5 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lat Krabang</td>
<td style="text-align: right;">351.714286</td>
<td style="text-align: right;">423.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((694497.3 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yan Nawa</td>
<td style="text-align: right;">123.000000</td>
<td style="text-align: right;">125.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((667818.3 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Samphanthawong</td>
<td style="text-align: right;">10.800000</td>
<td style="text-align: right;">9.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((663592.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phaya Thai</td>
<td style="text-align: right;">39.600000</td>
<td style="text-align: right;">46.666667</td>
<td style="text-align: left;">MULTIPOLYGON (((667624 1525…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Thon Buri</td>
<td style="text-align: right;">30.714286</td>
<td style="text-align: right;">27.125000</td>
<td style="text-align: left;">MULTIPOLYGON (((661364.9 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bangkok Yai</td>
<td style="text-align: right;">90.400000</td>
<td style="text-align: right;">75.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((660991.6 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Huai Khwang</td>
<td style="text-align: right;">58.375000</td>
<td style="text-align: right;">55.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((671695.6 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Khlong San</td>
<td style="text-align: right;">5.166667</td>
<td style="text-align: right;">4.571429</td>
<td style="text-align: left;">MULTIPOLYGON (((662113.2 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Taling Chan</td>
<td style="text-align: right;">162.428571</td>
<td style="text-align: right;">198.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((654587 1526…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bangkok Noi</td>
<td style="text-align: right;">94.400000</td>
<td style="text-align: right;">78.833333</td>
<td style="text-align: left;">MULTIPOLYGON (((659654.1 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Khun Thian</td>
<td style="text-align: right;">239.600000</td>
<td style="text-align: right;">245.166667</td>
<td style="text-align: left;">MULTIPOLYGON (((656541 1512…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phasi Charoen</td>
<td style="text-align: right;">144.857143</td>
<td style="text-align: right;">127.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((654370 1519…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Nong Khaem</td>
<td style="text-align: right;">299.600000</td>
<td style="text-align: right;">249.666667</td>
<td style="text-align: left;">MULTIPOLYGON (((647001.3 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rat Burana</td>
<td style="text-align: right;">136.333333</td>
<td style="text-align: right;">124.714286</td>
<td style="text-align: left;">MULTIPOLYGON (((661132.1 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Phlat</td>
<td style="text-align: right;">84.333333</td>
<td style="text-align: right;">75.571429</td>
<td style="text-align: left;">MULTIPOLYGON (((663052.9 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Din Daeng</td>
<td style="text-align: right;">73.500000</td>
<td style="text-align: right;">60.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((670238.2 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bueng Kum</td>
<td style="text-align: right;">206.400000</td>
<td style="text-align: right;">174.833333</td>
<td style="text-align: left;">MULTIPOLYGON (((678184.5 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sathon</td>
<td style="text-align: right;">41.500000</td>
<td style="text-align: right;">36.714286</td>
<td style="text-align: left;">MULTIPOLYGON (((667917.7 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Sue</td>
<td style="text-align: right;">72.142857</td>
<td style="text-align: right;">64.125000</td>
<td style="text-align: left;">MULTIPOLYGON (((666275.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chatuchak</td>
<td style="text-align: right;">57.222222</td>
<td style="text-align: right;">66.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((671471.4 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Kho Laem</td>
<td style="text-align: right;">40.800000</td>
<td style="text-align: right;">36.166667</td>
<td style="text-align: left;">MULTIPOLYGON (((664335.2 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Prawet</td>
<td style="text-align: right;">350.000000</td>
<td style="text-align: right;">377.714286</td>
<td style="text-align: left;">MULTIPOLYGON (((680695.6 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Khlong Toei</td>
<td style="text-align: right;">116.333333</td>
<td style="text-align: right;">106.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((673075.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Suan Luang</td>
<td style="text-align: right;">163.333333</td>
<td style="text-align: right;">163.714286</td>
<td style="text-align: left;">MULTIPOLYGON (((677751.8 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Chom Thong</td>
<td style="text-align: right;">76.333333</td>
<td style="text-align: right;">86.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((658696.5 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Don Mueang</td>
<td style="text-align: right;">203.333333</td>
<td style="text-align: right;">184.285714</td>
<td style="text-align: left;">MULTIPOLYGON (((674339.8 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ratchathewi</td>
<td style="text-align: right;">27.833333</td>
<td style="text-align: right;">28.714286</td>
<td style="text-align: left;">MULTIPOLYGON (((667199.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lat Phrao</td>
<td style="text-align: right;">60.166667</td>
<td style="text-align: right;">60.857143</td>
<td style="text-align: left;">MULTIPOLYGON (((673842.9 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vadhana</td>
<td style="text-align: right;">53.833333</td>
<td style="text-align: right;">47.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((668704.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Khae</td>
<td style="text-align: right;">258.000000</td>
<td style="text-align: right;">268.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((647693 1520…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lak Si</td>
<td style="text-align: right;">119.166667</td>
<td style="text-align: right;">106.571429</td>
<td style="text-align: left;">MULTIPOLYGON (((671045.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sai Mai</td>
<td style="text-align: right;">240.250000</td>
<td style="text-align: right;">225.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((679686.2 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Khan Na Yao</td>
<td style="text-align: right;">157.400000</td>
<td style="text-align: right;">205.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((680806.2 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Saphan Sung</td>
<td style="text-align: right;">311.428571</td>
<td style="text-align: right;">320.750000</td>
<td style="text-align: left;">MULTIPOLYGON (((685556.9 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wang Thonglang</td>
<td style="text-align: right;">34.333333</td>
<td style="text-align: right;">33.250000</td>
<td style="text-align: left;">MULTIPOLYGON (((671782.5 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Khlong Sam Wa</td>
<td style="text-align: right;">241.000000</td>
<td style="text-align: right;">233.142857</td>
<td style="text-align: left;">MULTIPOLYGON (((693668.9 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Na</td>
<td style="text-align: right;">366.800000</td>
<td style="text-align: right;">319.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((675501.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Thawi Watthana</td>
<td style="text-align: right;">190.666667</td>
<td style="text-align: right;">269.285714</td>
<td style="text-align: left;">MULTIPOLYGON (((650687.8 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Thung Khru</td>
<td style="text-align: right;">212.000000</td>
<td style="text-align: right;">181.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((660699.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Bon</td>
<td style="text-align: right;">234.857143</td>
<td style="text-align: right;">218.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((656343.6 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mueang Samut Prakan</td>
<td style="text-align: right;">324.200000</td>
<td style="text-align: right;">312.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((673201.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Bo</td>
<td style="text-align: right;">540.500000</td>
<td style="text-align: right;">515.800000</td>
<td style="text-align: left;">MULTIPOLYGON (((712294.1 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Phli</td>
<td style="text-align: right;">444.500000</td>
<td style="text-align: right;">457.571429</td>
<td style="text-align: left;">MULTIPOLYGON (((687139.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phra Pradaeng</td>
<td style="text-align: right;">86.875000</td>
<td style="text-align: right;">132.222222</td>
<td style="text-align: left;">MULTIPOLYGON (((670827.4 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Phra Samut Chedi</td>
<td style="text-align: right;">261.750000</td>
<td style="text-align: right;">228.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((669191.5 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Sao Thong</td>
<td style="text-align: right;">626.333333</td>
<td style="text-align: right;">581.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((695481.3 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mueang Nonthaburi</td>
<td style="text-align: right;">112.571429</td>
<td style="text-align: right;">119.625000</td>
<td style="text-align: left;">MULTIPOLYGON (((662112.2 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Kruai</td>
<td style="text-align: right;">223.857143</td>
<td style="text-align: right;">202.125000</td>
<td style="text-align: left;">MULTIPOLYGON (((654095.9 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bang Yai</td>
<td style="text-align: right;">115.200000</td>
<td style="text-align: right;">115.833333</td>
<td style="text-align: left;">MULTIPOLYGON (((649983.7 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Bua Thong</td>
<td style="text-align: right;">124.600000</td>
<td style="text-align: right;">143.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((649993.4 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sai Noi</td>
<td style="text-align: right;">120.200000</td>
<td style="text-align: right;">110.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((644817.9 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pak Kret</td>
<td style="text-align: right;">120.000000</td>
<td style="text-align: right;">130.285714</td>
<td style="text-align: left;">MULTIPOLYGON (((652378.8 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mueang Pathum Thani</td>
<td style="text-align: right;">290.428571</td>
<td style="text-align: right;">270.125000</td>
<td style="text-align: left;">MULTIPOLYGON (((672162.5 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Khlong Luang</td>
<td style="text-align: right;">149.750000</td>
<td style="text-align: right;">252.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((689473.3 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Thanyaburi</td>
<td style="text-align: right;">348.000000</td>
<td style="text-align: right;">355.400000</td>
<td style="text-align: left;">MULTIPOLYGON (((706757.7 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nong Suea</td>
<td style="text-align: right;">523.000000</td>
<td style="text-align: right;">356.666667</td>
<td style="text-align: left;">MULTIPOLYGON (((704086 1575…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lat Lum Kaeo</td>
<td style="text-align: right;">135.800000</td>
<td style="text-align: right;">127.166667</td>
<td style="text-align: left;">MULTIPOLYGON (((650538.8 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lam Luk Ka</td>
<td style="text-align: right;">165.500000</td>
<td style="text-align: right;">224.571429</td>
<td style="text-align: left;">MULTIPOLYGON (((706764.9 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sam Khok</td>
<td style="text-align: right;">291.000000</td>
<td style="text-align: right;">233.750000</td>
<td style="text-align: left;">MULTIPOLYGON (((665864.3 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mueang Nakhon Pathom</td>
<td style="text-align: right;">121.500000</td>
<td style="text-align: right;">146.200000</td>
<td style="text-align: left;">MULTIPOLYGON (((602747 1541…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Kamphaeng Saen</td>
<td style="text-align: right;">125.333333</td>
<td style="text-align: right;">114.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((612428.1 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nakhon Chai Si</td>
<td style="text-align: right;">140.600000</td>
<td style="text-align: right;">134.833333</td>
<td style="text-align: left;">MULTIPOLYGON (((627397.1 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Don Tum</td>
<td style="text-align: right;">133.250000</td>
<td style="text-align: right;">112.800000</td>
<td style="text-align: left;">MULTIPOLYGON (((620292.6 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bang Len</td>
<td style="text-align: right;">67.600000</td>
<td style="text-align: right;">73.000000</td>
<td style="text-align: left;">MULTIPOLYGON (((631987.6 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sam Phran</td>
<td style="text-align: right;">190.285714</td>
<td style="text-align: right;">199.875000</td>
<td style="text-align: left;">MULTIPOLYGON (((636176.3 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Phutthamonthon</td>
<td style="text-align: right;">206.000000</td>
<td style="text-align: right;">187.750000</td>
<td style="text-align: left;">MULTIPOLYGON (((637713.4 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mueang Samut Sakhon</td>
<td style="text-align: right;">138.250000</td>
<td style="text-align: right;">277.600000</td>
<td style="text-align: left;">MULTIPOLYGON (((646615.4 15…</td>
</tr>
<tr class="even">
<td style="text-align: left;">Krathum Baen</td>
<td style="text-align: right;">262.400000</td>
<td style="text-align: right;">230.333333</td>
<td style="text-align: left;">MULTIPOLYGON (((641549.1 15…</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ban Phaeo</td>
<td style="text-align: right;">390.666667</td>
<td style="text-align: right;">320.500000</td>
<td style="text-align: left;">MULTIPOLYGON (((625054.6 15…</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We now plot the lag accident count and w_ave_acc maps next to each other for comparison using the qtm() function of the tmap package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>w_avg_acc <span class="ot">&lt;-</span> <span class="fu">qtm</span>(boundary_with_accident_count, <span class="st">"lag_window_avg acc"</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(lag_acc, w_avg_acc, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(boundary_with_accident_count) <span class="sc">+</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"accident_count"</span>,</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal interval classification"</span>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>quantile <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(boundary_with_accident_count) <span class="sc">+</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"accident_count"</span>,</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">n =</span> <span class="dv">5</span>,</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal quantile classification"</span>)</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(equal, </span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>             quantile, </span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">asp=</span><span class="dv">1</span>, </span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="spatial-autocorrelation-morans-i-test." class="level2">
<h2 class="anchored" data-anchor-id="spatial-autocorrelation-morans-i-test.">1.4.4 Spatial Autocorrelation: Morans I test.</h2>
<p>The hypotheses for the test are as follows:</p>
<ul>
<li><p><strong><em>H0: Regions with similar number of accidents are randomly distributed.</em></strong></p></li>
<li><p><strong><em>H1: Regions with similar number of accidents are not randomly distributed and exhibit spatial clustering.</em></strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(boundary_with_accident_count<span class="sc">$</span>accident_count, </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span>rswm_q, </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  boundary_with_accident_count$accident_count  
weights: rswm_q    

Moran I statistic standard deviate = 3.7964, p-value = 7.34e-05
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.235764728      -0.012820513       0.004287482 </code></pre>
</div>
</div>
<p>From the output above, we can infer the following:</p>
<ul>
<li><p>The p-value (7.34e-05)&lt;0.05, indicating that the observed spatial autocorrelation is statistically significant.</p></li>
<li><p>Moran’s I statistic: The observed value of 0.236 indicates <strong>positive spatial autocorrelation</strong>, meaning that regions with similar number of accidents are more likely to be located near each other.</p></li>
</ul>
<p>Since Moran’s I Statistic is significantly greater than what we would expect in a randomly distributed region. There is significant evidence to reject H0 and conclude that there is indeed spatial clustering with regards to Accidents in the Bangkok Metropolitan Region.</p>
<section id="monte-carlo-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-morans-i">1.4.4.1 Monte Carlo Moran’s I</h3>
<p>We now implement the moran.mc() function of the spdep package. In this scenario, we will run 1000 simulations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>bperm<span class="ot">=</span> <span class="fu">moran.mc</span>(boundary_with_accident_count<span class="sc">$</span>accident_count, </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">listw=</span>rswm_q, </span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">nsim=</span><span class="dv">999</span>, </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">zero.policy =</span> <span class="cn">TRUE</span>, </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>bperm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  boundary_with_accident_count$accident_count 
weights: rswm_q  
number of simulations + 1: 1000 

statistic = 0.23576, observed rank = 1000, p-value = 0.001
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Based on the above output, p-value (0.001)&lt;0.05, thus we can reject the null hypothesis at a 5% significance level and conclude that there is indeed spatial clustering.</p>
</section>
<section id="visualizing-monte-carlo-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-monte-carlo-morans-i">1.4.4.2 Visualizing Monte Carlo Moran’s I</h3>
<p>We can visualize the test statistics obtained from the simulation above by implementing the hist() and abline() functions of R graphics.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Summary Statistics</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">The plot</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">ggplot method</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>We first calculate the mean and variance, and obtain the summary statistics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.01073838</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00437831</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bperm<span class="sc">$</span>res[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-0.20513 -0.05612 -0.01518 -0.01074  0.03086  0.23281 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm<span class="sc">$</span>res, </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">freq=</span><span class="cn">TRUE</span>, </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">breaks=</span><span class="dv">20</span>, </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Simulated Moran's I"</span>)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, </span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the above, we can infer that over half of all simulations indicate a negative value for Moran’s I statistic. Generally, a negative value indicates that&nbsp;<strong>dissimilar</strong>&nbsp;regions are located next to each other. (i.e: regions with dissimilar number of Accidents are located next to each other)</p>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<p>We can also make use of the ggplot2 R package to produce a plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">simulated_moran =</span> bperm<span class="sc">$</span>res)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> simulated_moran)) <span class="sc">+</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> (<span class="fu">max</span>(data<span class="sc">$</span>simulated_moran) <span class="sc">-</span> <span class="fu">min</span>(data<span class="sc">$</span>simulated_moran)) <span class="sc">/</span> <span class="dv">20</span>, </span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Simulated Moran's I"</span>, </span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Histogram of Simulated Moran's I"</span>) <span class="sc">+</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="local-morans-i">1.4.4.3 Local Morans I</h3>
<p>We implement the localmoran() function of spdep compute the local Moran’s I statistic. This function helps us compute li values, given a set of zi values and a listw object providing neighbor weighting information for the polygon associated with the zi values.</p>
<p>We compute local Moran’s I of <code>accident_count</code> at the district level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(boundary_with_accident_count<span class="sc">$</span>accident_count)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>localMI <span class="ot">&lt;-</span> <span class="fu">localmoran</span>(boundary_with_accident_count<span class="sc">$</span>accident_count, rswm_q)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(localMI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Ii          E.Ii      Var.Ii       Z.Ii Pr(z != E(Ii))
1  0.60429563 -0.0079097813 0.070446604  2.3065726    0.021078658
2  0.45651029 -0.0079097813 0.070446604  1.7497699    0.080158019
3 -0.65867321 -0.0031893365 0.060342196 -2.6684032    0.007621273
4  0.54837408 -0.0071586128 0.106462820  1.7025922    0.088644413
5  0.02048823 -0.0004311934 0.003869271  0.3363063    0.736639872
6  0.17288609 -0.0069766753 0.085295392  0.6158550    0.537990224</code></pre>
</div>
</div>
<div class="note-box">
<p><em>localmoran()</em> function returns a matrix of values whose columns are:</p>
<ul>
<li><p>Ii: the local Moran’s I statistics</p></li>
<li><p>E.Ii: the expectation of local moran statistic under the randomisation hypothesis</p></li>
<li><p>Var.Ii: the variance of local moran statistic under the randomisation hypothesis</p></li>
<li><p>Z.Ii:the standard deviate of local moran statistic</p></li>
<li><p>Pr(): the p-value of local moran statistic</p></li>
</ul>
</div>
<p>We now use the printCoefmat() to display the content of the local Moran matrix that we created above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printCoefmat</span>(<span class="fu">data.frame</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  localMI[fips,], </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names=</span>boundary_with_accident_count<span class="sc">$</span>ADM2_EN.x[fips]),</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              Ii        E.Ii      Var.Ii        Z.Ii
Phra Nakhon           6.0430e-01 -7.9098e-03  7.0447e-02  2.3066e+00
Dusit                 4.5651e-01 -7.9098e-03  7.0447e-02  1.7498e+00
Pom Prap Sattru Phai  5.7718e-01 -7.9098e-03  1.1755e-01  1.7065e+00
Samphanthawong        5.7643e-01 -7.9098e-03  1.1755e-01  1.7044e+00
Bangkok Yai           2.7767e-01 -7.9098e-03  1.1755e-01  8.3295e-01
Nong Khaem           -5.0752e-01 -7.9098e-03  1.1755e-01 -1.4572e+00
Khlong San            5.9394e-01 -7.8138e-03  9.5450e-02  1.9477e+00
Bangkok Noi           2.6106e-01 -7.8138e-03  1.1613e-01  7.8898e-01
Thon Buri             4.9558e-01 -7.7185e-03  7.9701e-02  1.7828e+00
Phasi Charoen         7.2382e-02 -7.7185e-03  7.9701e-02  2.8373e-01
Phra Khanong         -2.1018e-01 -7.3429e-03  8.9740e-02 -6.7710e-01
Din Daeng             3.2865e-01 -7.3429e-03  1.3835e-01  9.0331e-01
Vadhana               3.9977e-01 -7.3429e-03  8.9740e-02  1.3590e+00
Bang Rak              5.4837e-01 -7.1586e-03  1.0646e-01  1.7026e+00
Sathon                4.3876e-01 -7.1586e-03  8.7504e-02  1.5074e+00
Bang Sue              3.2934e-01 -7.1586e-03  7.3961e-02  1.2373e+00
Bang Kapi             1.7289e-01 -6.9767e-03  8.5295e-02  6.1586e-01
Bang Kho Laem         4.2715e-01 -6.7082e-03  9.9809e-02  1.3733e+00
Bueng Kum            -1.4140e-01 -6.3583e-03  9.4637e-02 -4.3898e-01
Bang Phlat            2.5840e-01 -5.8512e-03  7.1616e-02  9.8744e-01
Nong Suea            -1.1495e+00 -5.7687e-03  2.2361e-01 -2.4187e+00
Thung Khru           -1.5046e-01 -5.6055e-03  8.3495e-02 -5.0131e-01
Huai Khwang           3.3009e-01 -5.4446e-03  4.8612e-02  1.5219e+00
Wang Thonglang        3.9902e-01 -5.2861e-03  1.3487e-01  1.1009e+00
Lak Si                1.3769e-01 -5.2077e-03  6.3782e-02  5.6584e-01
Don Tum               9.4804e-02 -5.2077e-03  9.8330e-02  3.1894e-01
Ratchathewi           4.0649e-01 -4.9761e-03  6.0959e-02  1.6665e+00
Khlong Toei           1.3206e-01 -4.2420e-03  5.2005e-02  5.9770e-01
Pathum Wan            4.1399e-01 -4.1719e-03  3.7296e-02  2.1653e+00
Bang Kruai           -1.5533e-01 -3.8297e-03  3.9701e-02 -7.6037e-01
Rat Burana            7.0045e-02 -3.5022e-03  4.2967e-02  3.5481e-01
Sai Noi               1.0630e-01 -3.2507e-03  4.8535e-02  4.9727e-01
Nong Chok            -6.5867e-01 -3.1893e-03  6.0342e-02 -2.6684e+00
Phutthamonthon       -9.9194e-02 -3.1893e-03  3.3083e-02 -5.2782e-01
Sam Khok             -2.9599e-01 -3.0683e-03  7.8458e-02 -1.0458e+00
Lat Phrao             2.3647e-01 -2.8911e-03  3.5491e-02  1.2706e+00
Don Mueang           -8.3944e-02 -2.6075e-03  3.2019e-02 -4.5455e-01
Krathum Baen         -2.1123e-01 -2.6075e-03  3.8957e-02 -1.0570e+00
Min Buri             -4.9826e-01 -2.4982e-03  3.7327e-02 -2.5660e+00
Bang Na              -3.8999e-01 -2.0842e-03  3.1155e-02 -2.1977e+00
Phaya Thai            2.3471e-01 -1.9866e-03  2.9698e-02  1.3735e+00
Kamphaeng Saen        7.3445e-02 -1.9866e-03  5.0854e-02  3.3450e-01
Lat Lum Kaeo          5.2453e-02 -1.8913e-03  2.8277e-02  3.2317e-01
Phra Samut Chedi     -1.5870e-01 -1.4915e-03  2.8267e-02 -9.3503e-01
Bang Bon             -1.0360e-01 -1.2133e-03  1.2611e-02 -9.1175e-01
Bang Len              1.4226e-01 -1.2133e-03  1.8152e-02  1.0649e+00
Nakhon Chai Si        3.1698e-02 -9.9768e-04  1.4930e-02  2.6759e-01
Ban Phaeo            -2.8097e-01 -8.6565e-04  2.2184e-02 -1.8806e+00
Bang Yai              5.0958e-02 -6.0283e-04  9.0244e-03  5.4276e-01
Bang Khen             2.0488e-02 -4.3119e-04  3.8693e-03  3.3631e-01
Mueang Pathum Thani  -1.0470e-01 -3.8742e-04  4.0301e-03 -1.6432e+00
Yan Nawa              2.4924e-02 -2.0371e-04  3.0508e-03  4.5494e-01
Chom Thong            4.0971e-02 -1.2158e-04  1.4967e-03  1.0622e+00
Chatuchak             3.5183e-02 -6.0530e-05  4.7609e-04  1.6152e+00
Sai Mai              -6.5785e-04 -4.2214e-08  8.0124e-07 -7.3488e-01
Suan Luang           -3.8712e-05 -7.6848e-07  9.4613e-06 -1.2336e-02
Mueang Nonthaburi    -5.4655e-03 -6.2488e-06  6.5027e-05 -6.7699e-01
Khlong Sam Wa         3.7824e-02 -1.3683e-04  1.6844e-03  9.2494e-01
Pak Kret             -2.7988e-02 -2.2332e-04  2.7488e-03 -5.2957e-01
Bang Bua Thong       -6.6869e-02 -1.5866e-03  2.3728e-02 -4.2380e-01
Mueang Nakhon Pathom -7.8933e-02 -1.9026e-03  3.6044e-02 -4.0574e-01
Mueang Samut Prakan   3.2339e-01 -2.2990e-03  3.4358e-02  1.7571e+00
Sam Phran             6.0701e-02 -3.0827e-03  3.1981e-02  3.5667e-01
Bang Khun Thian       1.8656e-01 -3.4537e-03  5.1556e-02  8.3683e-01
Bang Khae             3.3266e-01 -7.0892e-03  1.0544e-01  1.0463e+00
Thanyaburi            9.2497e-01 -1.4248e-02  2.6658e-01  1.8191e+00
Saphan Sung           7.4410e-01 -1.4378e-02  1.4747e-01  1.9751e+00
Bang Bo               2.1695e+00 -1.8681e-02  3.4795e-01  3.7095e+00
Khan Na Yao          -4.4722e-02 -2.3052e-02  3.3734e-01 -3.7310e-02
Taling Chan          -1.2591e-02 -2.3382e-02  2.3763e-01  2.2136e-02
Bang Sao Thong        2.9810e+00 -2.3382e-02  5.8570e-01  3.9257e+00
Phra Pradaeng        -5.8509e-01 -3.1998e-02  2.7807e-01 -1.0489e+00
Bang Phli             2.3769e+00 -4.0427e-02  4.7760e-01  3.4978e+00
Prawet                1.6089e+00 -4.2186e-02  4.9747e-01  2.3410e+00
Lam Luk Ka            1.0605e-02 -5.0323e-02  5.8839e-01  7.9431e-02
Khlong Luang         -1.6589e-01 -7.2197e-02  1.2714e+00 -8.3095e-02
Thawi Watthana        3.4609e-01 -9.7330e-02  1.0817e+00  4.2635e-01
Mueang Samut Sakhon  -4.0011e-01 -1.3165e-01  2.1698e+00 -1.8225e-01
Lat Krabang           3.2578e+00 -1.6980e-01  1.4670e+00  2.8299e+00
                     Pr.z....E.Ii..
Phra Nakhon                  0.0211
Dusit                        0.0802
Pom Prap Sattru Phai         0.0879
Samphanthawong               0.0883
Bangkok Yai                  0.4049
Nong Khaem                   0.1451
Khlong San                   0.0514
Bangkok Noi                  0.4301
Thon Buri                    0.0746
Phasi Charoen                0.7766
Phra Khanong                 0.4983
Din Daeng                    0.3664
Vadhana                      0.1741
Bang Rak                     0.0886
Sathon                       0.1317
Bang Sue                     0.2160
Bang Kapi                    0.5380
Bang Kho Laem                0.1697
Bueng Kum                    0.6607
Bang Phlat                   0.3234
Nong Suea                    0.0156
Thung Khru                   0.6162
Huai Khwang                  0.1280
Wang Thonglang               0.2709
Lak Si                       0.5715
Don Tum                      0.7498
Ratchathewi                  0.0956
Khlong Toei                  0.5500
Pathum Wan                   0.0304
Bang Kruai                   0.4470
Rat Burana                   0.7227
Sai Noi                      0.6190
Nong Chok                    0.0076
Phutthamonthon               0.5976
Sam Khok                     0.2957
Lat Phrao                    0.2039
Don Mueang                   0.6494
Krathum Baen                 0.2905
Min Buri                     0.0103
Bang Na                      0.0280
Phaya Thai                   0.1696
Kamphaeng Saen               0.7380
Lat Lum Kaeo                 0.7466
Phra Samut Chedi             0.3498
Bang Bon                     0.3619
Bang Len                     0.2869
Nakhon Chai Si               0.7890
Ban Phaeo                    0.0600
Bang Yai                     0.5873
Bang Khen                    0.7366
Mueang Pathum Thani          0.1003
Yan Nawa                     0.6492
Chom Thong                   0.2882
Chatuchak                    0.1063
Sai Mai                      0.4624
Suan Luang                   0.9902
Mueang Nonthaburi            0.4984
Khlong Sam Wa                0.3550
Pak Kret                     0.5964
Bang Bua Thong               0.6717
Mueang Nakhon Pathom         0.6849
Mueang Samut Prakan          0.0789
Sam Phran                    0.7213
Bang Khun Thian              0.4027
Bang Khae                    0.2954
Thanyaburi                   0.0689
Saphan Sung                  0.0483
Bang Bo                      0.0002
Khan Na Yao                  0.9702
Taling Chan                  0.9823
Bang Sao Thong               0.0001
Phra Pradaeng                0.2942
Bang Phli                    0.0005
Prawet                       0.0192
Lam Luk Ka                   0.9367
Khlong Luang                 0.9338
Thawi Watthana               0.6698
Mueang Samut Sakhon          0.8554
Lat Krabang                  0.0047</code></pre>
</div>
</div>
</section>
<section id="mapping-the-local-morans-i" class="level3">
<h3 class="anchored" data-anchor-id="mapping-the-local-morans-i">1.4.4.4 Mapping the local Moran’s I</h3>
<p>Before we map the local Moran’s I map, it is wise to append the local Moran’s data-frame (<code>localMI</code>) onto our SpatialPolygonDataFrame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>bmr.localMI <span class="ot">&lt;-</span> <span class="fu">cbind</span>(boundary_with_accident_count,localMI) <span class="sc">%&gt;%</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Pr.Ii =</span> Pr.z....E.Ii..)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now make use of the tmap package and its choropleth mapping functions to plot the local Moran’s I values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bmr.localMI) <span class="sc">+</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-103-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="insights-box">
<p>Interpreting Moran Value:</p>
<ul>
<li><p>Values lesser than 0 indicate negative spatial autocorrelation. (i.e: high accident areas are near low accident areas.)</p></li>
<li><p>Value equal to 0 indicates random spatial distribution (No spatial autocorrelation).</p></li>
<li><p>Values greater than 0 indicate spatial autocorrelation.</p></li>
</ul>
</div>
</section>
<section id="mapping-local-morans-i-p-values" class="level3">
<h3 class="anchored" data-anchor-id="mapping-local-morans-i-p-values">1.4.4.5 Mapping Local Moran’s I p-values</h3>
<p>The Choropleth reveals the presence of both positive, as well as negative I values. This indicates that there are varying levels of spatial autocorrelation, however, we must examine the p-values for these I values to check for statistical significance.</p>
<p>We use the tmap package to draw a choropleth map of Moran’s I p-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bmr.localMI) <span class="sc">+</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the above we can infer that generally the local moran value ranges from -1 to 1. The biggest stand outs are:</p>
<ol type="1">
<li><p>Nong Suea, at the top right corner of the above map, seems to be absolutely dissimilar to its neighbors as indicated by its local Moran Value being of the highest magnitude. From our earlier analysis, we infer that this region actually has significantly fewer accidents than its neighbors.</p></li>
<li><p>The South-East region of the Bangkok Metropolitan Region has very high local Moran Values, indicating that the districts all showcase similar characteristics. They exhibit spatial clustering.</p></li>
</ol>
</section>
<section id="mapping-both-local-morans-i-values-and-p-values" class="level3">
<h3 class="anchored" data-anchor-id="mapping-both-local-morans-i-values-and-p-values">1.4.4.6 Mapping both local Moran’s I values and p-values</h3>
<p>In the interest of easier analysis and interpretation, we plot the two maps next to each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>localMI.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(bmr.localMI) <span class="sc">+</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Ii"</span>, </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>, </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local moran statistics"</span>) <span class="sc">+</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>pvalue.map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(bmr.localMI) <span class="sc">+</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"Pr.Ii"</span>, </span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">breaks=</span><span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-Blues"</span>, </span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Moran's I p-values"</span>) <span class="sc">+</span></span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(localMI.map, pvalue.map, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-105-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="hot-and-cold-spot-areas" class="level2">
<h2 class="anchored" data-anchor-id="hot-and-cold-spot-areas">1.4.5 Hot and Cold Spot Areas</h2>
<section id="getis-and-ords-g-statistics" class="level3">
<h3 class="anchored" data-anchor-id="getis-and-ords-g-statistics">1.4.5.1 Getis and Ord’s G-Statistics</h3>
<p>An alternative spatial statistic used to detect spatial anomalies is the <strong>Getis-Ord G-statistic</strong> (Getis and Ord, 1972; Ord and Getis, 1995). This method examines spatial relationships within a defined proximity to identify clusters of high or low values. Statistically significant <strong>hotspots</strong> are areas where high values are spatially clustered, meaning that not only do these areas have high values, but their neighboring areas also exhibit similarly high values.</p>
<p>The analysis involves three key steps:</p>
<ol type="1">
<li><p><strong>Deriving the spatial weight matrix</strong>: This defines the spatial relationships between areas, specifying which locations are considered neighbors based on proximity.</p></li>
<li><p><strong>Computing the Gi statistic</strong>: This step calculates the G-statistic for each location, identifying regions where values are significantly higher or lower than expected.</p></li>
<li><p><strong>Mapping the Gi statistics</strong>: The results are visualized to reveal spatial patterns of high-value clusters (hotspots) and low-value clusters (cold spots).</p></li>
</ol>
<p>This approach is useful for identifying localized patterns of spatial clustering and detecting significant anomalies in the data.</p>
</section>
<section id="deriving-distance-based-weight-matrix" class="level3">
<h3 class="anchored" data-anchor-id="deriving-distance-based-weight-matrix">1.4.5.2 Deriving Distance Based Weight Matrix</h3>
<p>We start by defining a new set of neighbors. While the spatial autocorrelation considered units which shared borders, for Getis-Ord, we will define the neighbors based on distance.</p>
<div class="insights-box">
<p>There are two types of distance-based proximity matrices:</p>
<ol type="1">
<li><p>Fixed Distance Weight Matrix</p></li>
<li><p>Adaptive Distance Weight Matrix</p></li>
</ol>
</div>
<p>Before creating our connectivity graph, we need to assign a point to each polygon. This requires more than simply running st_centroid() on the us.bound spatial object. Specifically, we need to extract the coordinates into a separate data frame. We have already done this earlier and stored them under the name <code>coords</code>.</p>
<p>Mapping functions apply a specific operation to each element of a vector and return a vector of the same length. In our case, the input vector will be the geometry column from us.bound, and the function we’ll apply is st_centroid(). We’ll use the map_dbl variation from the <strong>purrr</strong> package, which is designed to return numeric (double) values.</p>
<p>To extract the longitude values, we’ll map the st_centroid() function over the geometry column and use double bracket notation [[]] with 1 to access the first element of each centroid, which corresponds to the longitude.</p>
<p>For more detailed information, you can refer to the map documentation <a href="https://rdocumentation.org/packages/purrr/versions/1.0.2/topics/map">here</a>.</p>
<section id="determine-the-cut-off-distance" class="level4">
<h4 class="anchored" data-anchor-id="determine-the-cut-off-distance">1.4.5.2.1 Determine the Cut-off Distance</h4>
<p>To determine the upper limit for the distance band, we follow these steps:</p>
<ol type="1">
<li><p><strong>Find the k-nearest neighbors</strong>: Use the <code>knearneigh()</code> function from the <strong>spdep</strong> package. This function returns a matrix that contains the indices of points corresponding to the k-nearest neighbors for each observation.</p></li>
<li><p><strong>Convert to a neighbors list</strong>: Take the k-nearest neighbors object returned by <code>knearneigh()</code> and convert it into a neighbors list (class <code>nb</code>) by using the <code>knn2nb()</code> function. This generates a list of integer vectors, where each vector contains the region numbers corresponding to its neighbors.</p></li>
<li><p><strong>Calculate neighbor distances</strong>: Use the <code>nbdists()</code> function from <strong>spdep</strong> to calculate the distances between neighbors. The function returns the lengths of neighbor relationship edges in the units of the coordinates (e.g., kilometers if the coordinates are geographic).</p></li>
<li><p><strong>Flatten the distance list</strong>: The distances returned by <code>nbdists()</code> are stored in a list. Use the <code>unlist()</code> function to remove the list structure and return a single vector of distances.</p></li>
</ol>
<p>This process helps identify the upper limit for a distance band by analyzing the distances between neighboring regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">knn2nb</span>(<span class="fu">knearneigh</span>(coords))</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>k1dists <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">nbdists</span>(k1, coords, <span class="at">longlat =</span> <span class="cn">FALSE</span>))</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(k1dists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1390    2805    4986    6259    8476   16797 </code></pre>
</div>
</div>
<p>From the above output, we can infer that the largest first-nearest neighbor distance is just under 17000M.<br>
Using this as the upper threshold gives certainty that all units will have&nbsp;<em>at least</em>&nbsp;one neighbor.</p>
</section>
<section id="computing-fixed-distance-weight-matrix" class="level4">
<h4 class="anchored" data-anchor-id="computing-fixed-distance-weight-matrix">1.4.5.2.2 Computing fixed distance weight matrix</h4>
<p>We implement the dnearneigh() function of the spdep package to compute the distance weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>wm_d62 <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(coords, <span class="dv">0</span>, <span class="dv">17000</span>, <span class="at">longlat =</span> <span class="cn">FALSE</span>)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>wm_d62</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 79 
Number of nonzero links: 1766 
Percentage nonzero weights: 28.29675 
Average number of links: 22.35443 </code></pre>
</div>
</div>
<p>After this, we implement the nb2listw() function to convert the nb object into spatial weights object.</p>
<p>On average, each region has approximately 22.3neighbors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>wm62_lw <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(wm_d62, <span class="at">style =</span> <span class="st">'B'</span>)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wm62_lw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Characteristics of weights list object:
Neighbour list object:
Number of regions: 79 
Number of nonzero links: 1766 
Percentage nonzero weights: 28.29675 
Average number of links: 22.35443 
Link number distribution:

 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 19 20 21 22 23 25 26 27 29 31 32 
 3  5  3  6  1  2  1  2  2  1  1  1  1  1  3  1  1  1  2  1  2  1  1  2  2  1 
33 34 35 36 37 38 39 40 41 42 
 1  1  5  1  4  4  8  4  1  2 
3 least connected regions:
66 71 79 with 1 link
2 most connected regions:
14 37 with 42 links

Weights style: B 
Weights constants summary:
   n   nn   S0   S1     S2
B 79 6241 1766 3532 226656</code></pre>
</div>
</div>
</section>
</section>
<section id="computing-gi-statistics-using-fixed-distance" class="level3">
<h3 class="anchored" data-anchor-id="computing-gi-statistics-using-fixed-distance">1.4.5.3 Computing Gi statistics using Fixed Distance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">order</span>(boundary_with_accident_count<span class="sc">$</span>accident_count)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>gi.fixed <span class="ot">&lt;-</span> <span class="fu">localG</span>(boundary_with_accident_count<span class="sc">$</span>accident_count, wm62_lw)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>gi.fixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -3.35336397 -3.12912595  2.66840322 -3.40300611 -1.55553377 -1.60535680
 [7] -3.49157140 -3.33512452 -2.30441253  1.39585137  2.02857406 -3.14674976
[13] -3.17369454 -3.11393349 -2.81776564 -2.72683627 -2.88374141 -3.09409303
[19] -3.12869158 -2.97426998 -1.24486361 -2.45871841 -0.73868252 -3.41408938
[25] -2.89311199 -3.10698762 -1.21501813 -3.40300611 -3.97875100 -3.49579305
[31] -3.68769474  0.40369815 -2.86023380 -2.45892382 -2.82195856 -0.92940375
[37] -3.00458192 -2.79839385 -3.02803442 -2.34863826 -2.70055541 -0.22060572
[43] -0.64115983  0.20224677 -3.19200023  1.40767563 -2.13429423 -2.10096499
[49] -2.78620527 -1.47043641  1.55439452  2.25397760  3.05249557 -3.47654632
[55] -0.01782564  4.36180044 -2.68397915 -2.21092597  0.65770388 -0.78671988
[61] -0.20919415 -1.51459191 -0.54373150  0.45951200  2.18029716  1.04197980
[67] -0.32317456  0.39447801  1.04576806 -0.64165535 -0.63894290 -0.13934645
[73] -0.31893930 -0.81293378 -1.00959192  0.67569728 -0.47712106  2.54803258
[79]  3.18220373
attr(,"internals")
               Gi      E(Gi)        V(Gi)       Z(Gi) Pr(z != E(Gi))
 [1,] 0.272139227 0.51282051 0.0051513761 -3.35336397   7.983565e-04
 [2,] 0.288233482 0.51282051 0.0051513761 -3.12912595   1.753271e-03
 [3,] 0.136391769 0.05128205 0.0010173148  2.66840322   7.621273e-03
 [4,] 0.255432270 0.50000000 0.0051650300 -3.40300611   6.664879e-04
 [5,] 0.180171073 0.28205128 0.0042896392 -1.55553377   1.198190e-01
 [6,] 0.333924168 0.44871795 0.0051132094 -1.60535680   1.084153e-01
 [7,] 0.247971563 0.50000000 0.0052102341 -3.49157140   4.801881e-04
 [8,] 0.273448329 0.51282051 0.0051513761 -3.33512452   8.526121e-04
 [9,] 0.296456086 0.46153846 0.0051319328 -2.30441253   2.119950e-02
[10,] 0.241985442 0.16666667 0.0029115761  1.39585137   1.627593e-01
[11,] 0.224129353 0.12820513 0.0022360158  2.02857406   4.250169e-02
[12,] 0.258016812 0.48717949 0.0053035095 -3.14674976   1.650962e-03
[13,] 0.272139227 0.50000000 0.0051547652 -3.17369454   1.505120e-03
[14,] 0.313468692 0.53846154 0.0052205800 -3.11393349   1.846111e-03
[15,] 0.284889094 0.48717949 0.0051539569 -2.81776564   4.835909e-03
[16,] 0.278838749 0.47435897 0.0051412089 -2.72683627   6.394476e-03
[17,] 0.292251891 0.50000000 0.0051899304 -2.88374141   3.929813e-03
[18,] 0.290720062 0.51282051 0.0051526678 -3.09409303   1.974156e-03
[19,] 0.183188452 0.41025641 0.0052672775 -3.12869158   1.755865e-03
[20,] 0.261070466 0.47435897 0.0051424981 -2.97426998   2.936866e-03
[21,] 0.109258240 0.17948718 0.0031826485 -1.24486361   2.131819e-01
[22,] 0.260782502 0.43589744 0.0050725786 -2.45871841   1.394339e-02
[23,] 0.198059449 0.24358974 0.0037991399 -0.73868252   4.600998e-01
[24,] 0.203309875 0.44871795 0.0051668746 -3.41408938   6.399558e-04
[25,] 0.278947774 0.48717949 0.0051803995 -2.89311199   3.814453e-03
[26,] 0.302696456 0.52564103 0.0051489035 -3.10698762   1.890043e-03
[27,] 0.287300486 0.37179487 0.0048360434 -1.21501813   2.243592e-01
[28,] 0.255432270 0.50000000 0.0051650300 -3.40300611   6.664879e-04
[29,] 0.214054554 0.50000000 0.0051650300 -3.97875100   6.927825e-05
[30,] 0.219772515 0.47435897 0.0053037027 -3.49579305   4.726551e-04
[31,] 0.222076621 0.48717949 0.0051679573 -3.68769474   2.262949e-04
[32,] 0.348255907 0.32051282 0.0047227618  0.40369815   6.864347e-01
[33,] 0.268196569 0.47435897 0.0051953627 -2.86023380   4.233288e-03
[34,] 0.270124805 0.44871795 0.0052752059 -2.45892382   1.393542e-02
[35,] 0.244120853 0.44871795 0.0052565120 -2.82195856   4.773134e-03
[36,] 0.139284608 0.19230769 0.0032547762 -0.92940375   3.526799e-01
[37,] 0.322498456 0.53846154 0.0051664346 -3.00458192   2.659461e-03
[38,] 0.247349276 0.44871795 0.0051780488 -2.79839385   5.135745e-03
[39,] 0.282434515 0.50000000 0.0051624800 -3.02803442   2.461500e-03
[40,] 0.181588505 0.34615385 0.0049095816 -2.34863826   1.884220e-02
[41,] 0.138865303 0.32051282 0.0045243141 -2.70055541   6.922381e-03
[42,] 0.179613165 0.19230769 0.0033113077 -0.22060572   8.253994e-01
[43,] 0.251734311 0.29487179 0.0045266509 -0.64115983   5.214188e-01
[44,] 0.295476190 0.28205128 0.0044061520  0.20224677   8.397238e-01
[45,] 0.269990738 0.50000000 0.0051923603 -3.19200023   1.412912e-03
[46,] 0.228125000 0.15384615 0.0027843582  1.40767563   1.592271e-01
[47,] 0.246087091 0.39743590 0.0050286269 -2.13429423   3.281870e-02
[48,] 0.123152307 0.25641026 0.0040229869 -2.10096499   3.564404e-02
[49,] 0.144135802 0.33333333 0.0046111018 -2.78620527   5.332909e-03
[50,] 0.174530498 0.26923077 0.0041477249 -1.47043641   1.414436e-01
[51,] 0.137752297 0.07692308 0.0015314471  1.55439452   1.200903e-01
[52,] 0.078208290 0.02564103 0.0005439157  2.25397760   2.419758e-02
[53,] 0.259036145 0.11538462 0.0022146771  3.05249557   2.269471e-03
[54,] 0.169802258 0.42307692 0.0053074689 -3.47654632   5.079165e-04
[55,] 0.114558287 0.11538462 0.0021488926 -0.01782564   9.857780e-01
[56,] 0.193237100 0.05128205 0.0010591808  4.36180044   1.289965e-05
[57,] 0.205586331 0.39743590 0.0051093231 -2.68397915   7.275164e-03
[58,] 0.217455164 0.37179487 0.0048731182 -2.21092597   2.704096e-02
[59,] 0.174321909 0.14102564 0.0025628920  0.65770388   5.107284e-01
[60,] 0.067540006 0.10256410 0.0019819543 -0.78671988   4.314459e-01
[61,] 0.032644852 0.03846154 0.0007731295 -0.20919415   8.342967e-01
[62,] 0.104971080 0.19230769 0.0033250748 -1.51459191   1.298758e-01
[63,] 0.078550319 0.10256410 0.0019505280 -0.54373150   5.866262e-01
[64,] 0.036267748 0.02564103 0.0005348167  0.45951200   6.458665e-01
[65,] 0.100309499 0.03846154 0.0008046729  2.18029716   2.923544e-02
[66,] 0.029702206 0.01282051 0.0002624904  1.04197980   2.974210e-01
[67,] 0.052627500 0.06410256 0.0012607702 -0.32317456   7.465630e-01
[68,] 0.064076731 0.05128205 0.0010519939  0.39447801   6.932282e-01
[69,] 0.067548747 0.03846154 0.0007736300  1.04576806   2.956681e-01
[70,] 0.010752688 0.02564103 0.0005383798 -0.64165535   5.210970e-01
[71,] 0.002402356 0.01282051 0.0002658629 -0.63894290   5.228601e-01
[72,] 0.046816770 0.05128205 0.0010268471 -0.13934645   8.891764e-01
[73,] 0.041142416 0.05128205 0.0010107147 -0.31893930   7.497725e-01
[74,] 0.006984324 0.02564103 0.0005266952 -0.81293378   4.162560e-01
[75,] 0.018554918 0.05128205 0.0010508100 -1.00959192   3.126908e-01
[76,] 0.117669813 0.08974359 0.0017081266  0.67569728   4.992329e-01
[77,] 0.014813596 0.02564103 0.0005149838 -0.47712106   6.332759e-01
[78,] 0.175209043 0.07692308 0.0014878977  2.54803258   1.083324e-02
[79,] 0.064849332 0.01282051 0.0002673203  3.18220373   1.461590e-03
attr(,"cluster")
 [1] Low  Low  Low  Low  Low  Low  Low  Low  Low  Low  High Low  Low  Low  Low 
[16] Low  Low  Low  High Low  High Low  Low  Low  Low  Low  Low  Low  Low  Low 
[31] Low  High Low  High Low  Low  Low  Low  Low  High Low  Low  High High Low 
[46] High Low  High Low  Low  High High High High Low  High High Low  Low  High
[61] Low  High Low  High High Low  Low  High Low  High Low  Low  Low  Low  High
[76] Low  High Low  Low 
Levels: Low High
attr(,"gstari")
[1] FALSE
attr(,"call")
localG(x = boundary_with_accident_count$accident_count, listw = wm62_lw)
attr(,"class")
[1] "localG"</code></pre>
</div>
</div>
<p>The output of the <code>localG()</code> function is a vector containing G or G* values, with the following attributes: - <code>"gstari"</code>: Indicates whether the G* version of the statistic was used (<code>TRUE</code> or <code>FALSE</code>). - <code>"call"</code>: Stores the function call. - <code>"class"</code>: Set to <code>"localG"</code>, identifying the object type.</p>
<p>The Gi statistic is represented as a Z-score, where larger values signify stronger clustering. The sign of the value indicates the type of cluster: positive values point to high-value clusters (hotspots), while negative values indicate low-value clusters (cold spots).</p>
<p>To merge the Gi values with their corresponding geographic data in the BMR spatial dataframe, use the following code to join the results to the <code>boundary_with_accident_count</code> sf object. This allows for the spatial visualization of clusters within the geographic data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>bmr.gi <span class="ot">&lt;-</span> <span class="fu">cbind</span>(boundary_with_accident_count, <span class="fu">as.matrix</span>(gi.fixed)) <span class="sc">%&gt;%</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">gstat_fixed =</span> as.matrix.gi.fixed.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="note-box">
<p>the code chunk above actually performs&nbsp;<strong>three</strong>&nbsp;tasks. First, it convert the output vector (i.e.&nbsp;<em>gi.fixed</em>) into r matrix object by using&nbsp;<em>as.matrix()</em>. Next,&nbsp;<em>cbind()</em>&nbsp;is used to join bmr@data and&nbsp;<em>gi.fixed</em>&nbsp;matrix to produce a new SpatialPolygonDataFrame called&nbsp;<em>bmr.gi</em>. Lastly, the field name of the gi values is renamed to&nbsp;<em>gstat_fixed</em>&nbsp;by using&nbsp;<em>rename()</em>.</p>
</div>
<p>We can now map the Gi values derived using the fixed-distance weight matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>acc_count <span class="ot">&lt;-</span> <span class="fu">qtm</span>(boundary_with_accident_count, <span class="st">"accident_count"</span>)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>Gimap <span class="ot">&lt;-</span><span class="fu">tm_shape</span>(bmr.gi) <span class="sc">+</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"gstat_fixed"</span>, </span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">style =</span> <span class="st">"pretty"</span>,</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">palette=</span><span class="st">"-RdBu"</span>,</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">"local Gi"</span>) <span class="sc">+</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(acc_count, Gimap, <span class="at">asp=</span><span class="dv">1</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex01_files/figure-html/unnamed-chunk-111-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the above plot, we can infer that ‘hot spots’ tend to be neighboring regions and likewise for the cold spots too.&nbsp;We see more high value (hot) clusters in the South East region of the Bangkok Metropolitan Region- Near Samut Prakan. The Central Area, near Bangkok and Nonthaburi showcase more ‘cold spots’.</p>
<p>Districts Bang Phli, Bang Sao Thong, Bang Bo, Sinakharin, and Suwinthawong seem to be highly linked to each other based on accidents, all in the South-East region of the Bangkok Metropolitan Region.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>1.5 Conclusion</h1>
<p>From all our analysis, we determine that the South East region of Bangkok Metropolitan Region seems to be a hotspot for accidents and needs to be further examined in order to reduce the rate of accidents in the region.</p>
<p>Speeding fines and laws need to be tightened in order to reduce the number of speeding incidents in the region. It is responsible for over 80% of all road accidents in the region.</p>
<p>Highways in the South-East Region specifically see incidents of drivers going off the road in curvy areas and this is another thing that must be looked at. Barriers and signage must be strengthened in the area.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>